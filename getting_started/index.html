<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>快速上手 - Firmament Autopilot</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "\u5feb\u901f\u4e0a\u624b";
    var mkdocs_page_input_path = "getting_started.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Firmament Autopilot</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">概述</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">快速上手</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#_2">硬件连接</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_3">编译环境</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_4">编译固件</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#fmt-fmu">编译FMT FMU固件</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fmt-io">编译FMT IO固件</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_5">固件下载</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#fmt-fmu_1">下载FMT FMU固件</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fmt-io_1">下载FMT IO固件</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#px4">刷回PX4固件</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_6">代码调试</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#console">Console打印</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ulog">ULOG日志</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#jtag">JTAG调试</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../device/">设备和驱动</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../module/">组件</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../mbd/">基于模型设计</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../interface/">模型接口定义</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../custom_model/">设计新模型</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../contribute/">贡献</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Firmament Autopilot</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>快速上手</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/FirmamentPilot/doc_src/edit/master/docs/getting_started.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="_1">快速上手</h1>
<h2 id="_2">硬件连接</h2>
<p><img alt="hardware" src="../img/hardware.png" /></p>
<p>硬件连接如图所示:</p>
<ul>
<li><code>TELEM 2</code>: 默认作为控制台<strong>Console</strong>的输出，默认波特率<em>57600</em>。如果在<strong>Mavlink Console</strong>中输入任意字符，则<strong>Console</strong>将被自动映射到<strong>Mavlink Console</strong>上。</li>
<li><code>TELEM 1</code>: 默认作为<strong>Mavlink</strong>的输出口，默认波特率<em>57600</em>。如果<strong>USB</strong>连接的话，则<strong>Mavlink</strong>则自动换到到<strong>USB</strong>设备上输出。</li>
<li><code>GPS</code>: 连接GPS模块，默认波特率<em>9600</em>。</li>
<li><code>RC</code>: 连接遥控器的<em>PPM</em>信号,目前最多支持8路PPM信号。</li>
<li><code>SB</code>: 连接遥控器的<em>SBUS</em>信号，目前还未支持。</li>
<li><code>MAIN OUT</code>: 支持最多8路PWM输出信号 (也可改为捕获输入信号)。</li>
<li><code>AUX OUT</code>: 支持最多6路PWM输出信号 (也可改为捕获输入信号)。</li>
<li><code>其它</code>：其它接口暂时还未支持。</li>
</ul>
<h2 id="_3">编译环境</h2>
<p>支持在Windows/Linux/Mac环境下编译，需要用到的工具链如下：</p>
<ul>
<li><strong>编译器</strong>: <a href="https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-rm/downloads"><em>arm-none-eabi- toolchain</em></a> (推荐版本: <code>7-2018-q2-update</code>，其它版本未测试)</li>
<li><strong>编译工具</strong>：<a href="https://sourceforge.net/projects/scons/files/scons/2.3.6/"><em>Scons</em></a> (推荐版本：<code>v2.3.6</code>)，同时<em>Scons</em>需要用到<em>python2.7.x</em></li>
<li><strong>编辑器</strong>：推荐<em>VS Code</em>。使用<em>VS Code</em>打开<code>FMT_Firmware/fmt_fmu</code>或者<code>FMT_Firmware/fmt_io</code>目录即可打开项目工程。</li>
<li><strong>USB驱动</strong>：下载 <a href="https://www.st.com/en/development-tools/stsw-stm32102.html">STM32 USB驱动</a> (For windows)</li>
</ul>
<h2 id="_4">编译固件</h2>
<p>在配置好了编译环境后，首先需要配置系统的环境变量。以Windows系统为例，进入<em>Environment Variables</em>界面，添加一个<code>RTT_EXEC_PATH</code>的环境变量，并且将其<em>Value</em>设置为<em>arm-none-eabi- toolchain</em>的下载地址，比如<code>D:\gcc-arm-none-eabi-7-2018-q2-update-win32\bin</code>。</p>
<p>同时，在命令行窗口中输入<code>scons --version</code>和<code>python --version</code>查看版本是否正常。完成以上步骤后，可以开始编译FMT固件。</p>
<h3 id="fmt-fmu">编译<strong>FMT FMU</strong>固件</h3>
<pre><code>cd FMT_Firmware/fmt_fmu/target/pixhawk
scons -j4
</code></pre>

<p>编译完成后，固件<code>fmt_fmu.bin</code>将生成在<em>build</em>目录下。</p>
<h3 id="fmt-io">编译<strong>FMT IO</strong>固件</h3>
<pre><code>cd FMT_Firmware/fmt_io/project
scons -j4
</code></pre>

<p>编译完成后，固件<code>fmt_io.bin</code>将生成在<em>build</em>目录下。</p>
<h2 id="_5">固件下载</h2>
<p>FMT包含FMU (Flight Management Uinit) 固件和IO (Input/Output)固件，需要分别进行下载。FMT使用pixhawk内置的bootloader进行固件的下载，所以在下载了FMT的固件后，也能够很方便的刷回PX4或者APM的固件。</p>
<h3 id="fmt-fmu_1">下载FMT FMU固件</h3>
<p>目前有两种方式下载FMU固件: 通过uploader.py脚本下载或者通过QGroundControl (QGC)下载。</p>
<ul>
<li>
<p><strong>uploader.py脚本：</strong>
将飞控连接usb线插入PC，然后在<code>fmt_fmu/target/pixhawk</code>目录中执行<code>python uploader.py</code>。脚本将自动找到对应端口并开始下载位于<em>build</em>目录下的<code>fmt_fmu.bin</code>固件。</p>
</li>
<li>
<p><strong>QGC地面站：</strong>
进入<em>Firmware Setup</em>页面，然后使用usb线连接飞控和PC。这时会弹出选择固件的界面，选择<code>Advanced Settings</code>，然后在下拉框中选择<code>Custom firmware file</code>，然后选择编译的<code>fmt_fmu.bin</code>固件即可开始下载。</p>
</li>
</ul>
<p><img alt="qgc_download" src="../img/qgc_download.png" /></p>
<p>固件下载成功后，可以使用串口(<strong>TELEM 2, baudrate: 57600</strong>)或者QGC的<strong>Mavlink Console</strong>连接控制台(console)，如下图所示为飞控开机打印的信息：</p>
<p><img alt="console" src="../img/console.png" /></p>
<p>除此之外，还可以在VS Code中运行<code>fmt_fmu/target/pixhawk/mavlink_shell.py</code>脚本来连接console。</p>
<h3 id="fmt-io_1">下载FMT IO固件</h3>
<p>协处理器IO的固件通过FMU的文件系统进行下载。首先需要连接将编译的<code>fmt_io.bin</code>固件放到sd卡上，可以通过读卡器拷贝。而更方便的方式是通过QGC的FTP功能进行文件上传 (<em>Widget-&gt;Onboard Files</em>)。</p>
<p>文件上传后，进入控制台(console)，输入如下指令:</p>
<pre><code>fmtio upload $path/fmt_io.bin
</code></pre>

<p>其中<code>$path</code>为存放<em>fmt_io.bin</em>的路径，如果是放在根目录，则可以省略，直接输入<code>uploader</code>即可。</p>
<p><strong>注意：</strong>如果是第一次下载IO固件，在输入<code>upload</code>指令后，需要手动按一下位于<strong>Pixhawk</strong>右侧的IO复位按钮，使得IO进入bootloader程序。</p>
<p>下载完成后，在控制台输入<code>fmtio hello</code>指令，如果IO固件更新成功，应该看到IO发来的如下消息：</p>
<pre><code class="shell">msh /&gt;fmtio hello
msh /&gt;[IO]:Hello, this is FMT IO!
</code></pre>

<h3 id="px4">刷回PX4固件</h3>
<p>首先同样利用<strong>QGC</strong>地面站下载PX4/APM的固件到FMU。 PX4在上电会检查IO的固件版本并进行更新。但是由于目前FMT IO还不识别PX4的重启指令，故无法重启进入bootloader模式，所以需要手动进行IO固件的下载，目前有两种方法：</p>
<ol>
<li>按住安全开关 (safety switch)， 然后给飞控上电，这时候IO将会停留在bootloader中，这时候再按照之前的步骤刷新PX4/APM的固件到FMU。当FMU固件更新成功后，IO固件也将自动进行更新。</li>
<li>在刷了FMU固件后，进入nsh的控制台，输入指令<code>px4io forceupdate 14662 /etc/extras/px4_io-v2_default.bin</code>，在输入完指令后，立马按下IO的复位键，则可以开始IO固件的烧写。</li>
</ol>
<h2 id="_6">代码调试</h2>
<p>FMT提供了丰富的调试手段，常用的比如通过console打印，log日志记录以及jtag连接进行单独调试。</p>
<h3 id="console">Console打印</h3>
<p>在FMU中可以调用<code>console_printf()</code>函数进行打印，用法类似<code>printf()</code>。信息将被打印显示在<em>console</em>设备上，支持中断上下文中打印。</p>
<h3 id="ulog">ULOG日志</h3>
<p>ULOG为rt-thread提供的文字日志系统，支持不同level等级的日志信息输出，比如<em>Error</em>,<em>Warning</em>,<em>Info</em>,<em>Debug</em>等，对应的函数接口为：</p>
<pre><code>ulog_e(TAG, ...)    // Error
ulog_w(TAG, ...)    // Warning
ulog_i(TAG, ...)    // Info
ulog_d(TAG, ...)    // Debug
</code></pre>

<p>FMT支持将ulog日志输出到多个后端，比如<em>console</em>和<em>file system</em>。比如这条代码</p>
<pre><code>ulog_e(&quot;Test&quot;, &quot;Hello, this is %s&quot;, &quot;FMT&quot;);
</code></pre>

<p>将在<em>console</em>打印如下信息，并且这条信息将被记录到<code>log/session_x/ulog.txt</code>中</p>
<pre><code>[1770] E/Test: Hello, this is FMT
</code></pre>

<h3 id="jtag">JTAG调试</h3>
<p>TO BE ADD</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../device/" class="btn btn-neutral float-right" title="设备和驱动">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href=".." class="btn btn-neutral" title="概述"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/FirmamentPilot/doc_src/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href=".." style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../device/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
