{"config":{"lang":["en"],"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"\u6982\u8ff0 Firmament\u6982\u8ff0 Firmament (FMT) \u662f\u4e00\u6b3e\u4e13\u4e3a\u57fa\u4e8e\u6a21\u578b\u5f00\u53d1 (MBD, Model Based Design) \u800c\u8bbe\u8ba1\u7684\u5f00\u6e90\u98de\u63a7\u7cfb\u7edf\u3002FMT\u4e3b\u8981\u5305\u62ec\u4e24\u90e8\u5206\uff1a FMT Firmware \uff1a\u5d4c\u5165\u5f0f\u98de\u63a7\u7cfb\u7edf\u3002\u63d0\u4f9b\u5b89\u5168\u7a33\u5b9a\u7684\u5d4c\u5165\u5f0f\u529f\u80fd\u4ee5\u53ca\u9488\u5bf9MBD\u5f00\u53d1\u800c\u9700\u8981\u7684\u529f\u80fd\u6a21\u5757\u548c\u7cfb\u7edf\u6846\u67b6\u3002 FMT Model \uff1a\u57fa\u4e8e\u6a21\u578b\u8bbe\u8ba1\u7684\u7b97\u6cd5\u6a21\u5757\u3002\u53ef\u4ee5\u76f4\u63a5\u751f\u6210C/C++\u6e90\u7801\u5e76\u5d4c\u5165\u98de\u63a7\u7cfb\u7edf\u4e2d\u3002\u9664\u6b64\u4e4b\u5916\uff0cFMT Model\u8fd8\u63d0\u4f9b\u5f3a\u5927\u7684\u4eff\u771f\u529f\u80fd\uff0c\u5982\u6a21\u578b\u5728\u73af\u4eff\u771f (MIL)\uff0c\u786c\u4ef6\u5728\u73af\u4eff\u771f (HIL) \u548c\u5f00\u73af\u4eff\u771f (Open Loop Simulation)\u3002 FMT Firmware FMT Firmware\u4e3b\u8981\u7528C\u8bed\u8a00\u7f16\u5199\uff0c\u4ee3\u7801\u7b80\u6d01\u6613\u7528\u3002\u9ad8\u5ea6\u6a21\u5757\u5316\u7684\u67b6\u6784\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u4ee3\u7801\u79fb\u690d\u548c\u7b97\u6cd5\u6a21\u5757\u66ff\u6362\u53d8\u5f97\u7b80\u5355\u3002FMT\u98de\u63a7\u57fa\u4e8ePixhawk V2\u7684\u786c\u4ef6\u8fdb\u884c\u5f00\u53d1\uff0c\u5305\u62ecFMU(stm32F427)\u548cIO(stm32F103)\u4e24\u4e2a\u90e8\u5206\u7684\u56fa\u4ef6\u3002FMT\u652f\u6301Mavlink 1.0/2.0\uff0c\u6240\u4ee5\u53ef\u4ee5\u652f\u6301\u4e3b\u6d41\u7684\u5730\u9762\u7ad9\uff0c\u5982QGC\u7b49\u3002\u9664\u6b64\u4e4b\u5916\uff0cFMT\u4e0e\u5176\u5b83\u4e3b\u8981\u5f00\u6e90\u98de\u63a7\u7684\u4e3b\u8981\u533a\u522b\u4e4b\u4e00\u5728\u4e8e\u5176\u9ad8\u5ea6\u5951\u5408MBD\u7684\u5f00\u53d1\u6a21\u5f0f\uff0c\u80fd\u591f\u57fa\u4e8eSimulink\u5feb\u901f\u8bbe\u8ba1\uff0c\u90e8\u7f72\u548c\u9a8c\u8bc1\u4f60\u7684\u7b97\u6cd5\u6a21\u5757\u3002 FMT Model FMT Model\u4e3aSimulink\u7f16\u5199\u7684\u7b97\u6cd5\u6a21\u5757\uff0c\u5bf9\u4e8e\u98de\u63a7\u7cfb\u7edf\u6765\u8bf4\uff0c\u4e3b\u8981\u5305\u542b\u5bfc\u822a\u7cfb\u7edf(INS)\uff0c\u98de\u884c\u7ba1\u7406\u7cfb\u7edf(FMS)\u548c\u63a7\u5236\u7cfb\u7edf(Controller)\u4e09\u5927\u7b97\u6cd5\u6a21\u5757\u3002FMT Model\u901a\u8fc7Simulink Embedded Coder\u751f\u6210C/C++\u4ee3\u7801\uff0c\u53ea\u9700\u7b80\u5355copy\u5230FMT Firmware\u76f8\u5173\u6a21\u5757\u4e2d\uff0c\u5373\u53ef\u5b8c\u6210\u7b97\u6cd5\u7684\u5d4c\u5165\uff0c\u800c\u65e0\u9700\u4fee\u6539\u98de\u63a7\u7684\u4ee3\u7801 (\u53ea\u8981\u9075\u5faaFMT Model Interface\u6807\u51c6)\u3002FMT Model\u8fd8\u5305\u542b\u65e0\u4eba\u673a\u7684\u7269\u7406\u6a21\u578b(Plant)\uff0c\u4ece\u800c\u53ef\u4ee5\u652f\u6301\u6a21\u578b\u5728\u73af\u4eff\u771f(MIL)\u548c\u786c\u4ef6\u5728\u73af\u4eff\u771f(HIL)\uff0c\u5176\u5b83\u6a21\u578b\uff0c\u5982\u56fa\u5b9a\u7ffc\uff0cVTOL\u7b49\u6a21\u578b\u4e5f\u4f1a\u9010\u6e10\u652f\u6301 (\u6b22\u8fce\u5927\u5bb6\u8d21\u732e\uff01)\u3002\u7ed3\u5408\u98de\u63a7\u7cfb\u7edf\u7684\u5b9e\u65f6\u65e5\u5fd7\u529f\u80fd\uff0c\u53ef\u4ee5\u5c06\u65e5\u5fd7\u6570\u636e\u5bfc\u5165\u6a21\u578b\u8fdb\u884c\u5f00\u73af\u4eff\u771f(Open Loop Simulation)\uff0c\u5f97\u5230\u548c\u5728\u786c\u4ef6\u4e0a\u8fd0\u884c\u5b8c\u5168\u4e00\u81f4\u7684\u4eff\u771f\u7ed3\u679c\u3002 Firmament\u67b6\u6784 FMT\u91c7\u7528 \u5206\u5c42\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u4f7f\u5f97\u5c42\u4e0e\u5c42\uff0c\u6a21\u5757\u4e0e\u6a21\u5757\u4e4b\u95f4\u53bb\u8026\u5408\uff0c\u5404\u4e2a\u6a21\u5757\u53ef\u4ee5\u5355\u72ec\u52a0\u8f7d\u6216\u5220\u9664 \u3002 FMT\u67b6\u6784\u5982\u4e0b\u56fe\u6240\u793a\u3002 \u5b83\u5177\u4f53\u5305\u62ec\u4ee5\u4e0b\u90e8\u5206\uff1a \u5185\u6838\u5c42 (RTOS): \u5185\u6838\u5c42\u91c7\u7528\u5b9e\u65f6\u64cd\u4f5c\u7cfb\u7edfRT-Thread,\u63d0\u4f9b\u4e86\u4f8b\u5982\u591a\u7ebf\u7a0b\u53ca\u5176\u8c03\u5ea6\u3001\u4fe1\u53f7\u91cf\u3001\u90ae\u7bb1\u3001\u6d88\u606f\u961f\u5217\u3001\u5185\u5b58\u7ba1\u7406\u3001\u5b9a\u65f6\u5668\u7b49\uff1bDFS \u662f RT-Thread \u63d0\u4f9b\u7684\u865a\u62df\u6587\u4ef6\u7cfb\u7edf\u7ec4\u4ef6\uff0c\u5168\u79f0\u4e3a Device File System, \u63d0\u4f9b\u6807\u51c6POSIX\u63a5\u53e3\u3002MSH\u4e3aRT-Thread\u63d0\u4f9b\u7684\u547d\u4ee4\u884c\u7cfb\u7edf\u7ec4\u4ef6\uff0cFMT\u57fa\u4e8eMSH\u8fdb\u4e00\u6b65\u5c01\u88c5\uff0c\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u6307\u4ee4\u3002Library\u5219\u5305\u542b\u4e00\u4e9b\u4e09\u65b9\u5e93\uff0c\u5982Mavlink, STIM32 Standard Library\u7b49\u3002 \u9a71\u52a8\u5c42 (Driver): \u9a71\u52a8\u5c42\u63d0\u4f9b\u4e86Pixhawk\u677f\u8f7d\u548c\u5916\u6269\u7684\u5916\u8bbe\u9a71\u52a8\u652f\u6301\uff0c\u5982IMU, GPS, \u78c1\u529b\u8ba1\uff0c\u6c14\u538b\u8ba1\uff0cSD\u5361\uff0cUSB\u4ee5\u53ca\u901a\u4fe1\u603b\u7ebf\uff0c\u5982I2C\uff0cSPI\uff0cDMA\u7b49\u3002 \u786c\u4ef6\u62bd\u8c61\u5c42 (HAL)\uff1a \u5728Driver\u5c42\u4e4b\u4e0a\u7684HAL\u4e3a\u4e0a\u5c42\u63d0\u4f9b\u7edf\u4e00\u7684\u8bbe\u5907\u63a5\u53e3 (rt_read, rt_write, rt_control)\uff0c\u8fd9\u6837\u5f53\u66ff\u6362\u4e0d\u540c\u7684\u9a71\u52a8\u8bbe\u5907\u6216\u8005\u79fb\u690d\u5230\u4e0d\u540c\u786c\u4ef6\u4e0a\u65f6\uff0c\u4e0a\u5c42\u5c06\u4e0d\u9700\u8981\u6216\u8005\u53ea\u9700\u505a\u5f88\u5c11\u7684\u6539\u52a8\u5373\u53ef\u3002\u4e00\u4e9b\u4e0e\u786c\u4ef6\u65e0\u5173\u7684\u9a71\u52a8\u903b\u8f91\u4e5f\u53ef\u4ee5\u90fd\u653e\u5728HAL\u5c42\u4e2d\u5b9e\u73b0\uff0c\u8fd9\u6837\u5c31\u7b80\u5316\u4e86\u9a71\u52a8\u7684\u5f00\u53d1\u96be\u5ea6\u3002 \u6a21\u5757\u5c42 (Module)\uff1a\u6a21\u5757\u5c42\u63d0\u4f9bFMT\u7cfb\u7edf\u7684\u57fa\u7840\u529f\u80fd\u6a21\u5757\uff0c\u7cfb\u7edf\u7684\u5927\u90e8\u5206\u529f\u80fd\u5728\u8fd9\u5c42\u5b9e\u73b0\uff0c\u5e76\u63d0\u4f9b\u7ed9Task\u5c42\u8fdb\u884c\u7ec4\u5408\uff0c\u8c03\u7528\u3002\u6bd4\u5982\u8de8\u8fdb\u7a0b\u901a\u4fe1\u6a21\u5757uMCN\u63d0\u4f9b\u57fa\u4e8e\u53d1\u5e03/\u8ba2\u9605\u6a21\u5f0f\u7684\u5b89\u5168\u8de8\u8fdb\u7a0b\u901a\u4fe1\u673a\u5236\u3002log\u6a21\u5757\u63d0\u4f9b\u4e86\u4e8c\u8fdb\u5236\u65e5\u5fd7 (blog)\u548c\u6587\u5b57\u65e5\u5fd7 (ulog)\u7684\u529f\u80fd\u3002blog\u63d0\u4f9b\u529f\u80fd\u5f3a\u5927\u7684\u6570\u636e\u8bb0\u5f55\u529f\u80fd\uff0c\u5728\u4e0d\u5f71\u54cd\u9ad8\u4f18\u5148\u7ea7\u4efb\u52a1\u7684\u524d\u63d0\u4e0b\u5b9e\u65f6\u8bb0\u5f55\u7b97\u6cd5\u6a21\u5757\u7684\u8f93\u5165/\u8f93\u5165\u6570\u636e\uff0c\u4f9bSimulink\u6a21\u578b\u8fdb\u884c\u5f00\u73af\u4eff\u771f\u3002param\u53c2\u6570\u6a21\u5757\u63d0\u4f9b\u65b9\u4fbf\u7684\u53c2\u6570\u529f\u80fd\uff0c\u652f\u6301\u547d\u4ee4\u884c/\u5730\u9762\u7ad9\u5728\u7ebf\u8c03\u53c2\uff0c\u5e76\u4e14\u53c2\u6570\u5c06\u88ab\u8bb0\u5f55\u5230blog\u65e5\u5fd7\u4e2d\uff0c\u4f9b\u4eff\u771f\u6a21\u5757\u8bfb\u53d6\u3002\u7b97\u6cd5\u6a21\u5757INS, FMS, Controller\u4e3aFMT Model\u751f\u6210\u7684C/C++\u6e90\u6587\u4ef6\uff0c\u53ea\u8981\u6a21\u5757\u7b26\u5408FMT Model Interface\u7684\u6807\u51c6\uff0c\u5219\u53ef\u4ee5\u76f4\u63a5\u5d4c\u5165\u5230FMT\u98de\u63a7\u4e2d\uff0c\u800c\u65e0\u9700\u505a\u4efb\u4f55\u4fee\u6539\u3002Plant\u6a21\u5757\u4e3a\u65e0\u4eba\u673a\u7684\u7269\u7406\u6a21\u578b (\u4e5f\u53ef\u4ee5\u662f\u5176\u5b83\u5bf9\u8c61\u6a21\u578b)\uff0c\u540c\u6837\u4e3aFMT Model\u751f\u6210\u3002\u5b83\u4e3b\u8981\u662f\u4e3a\u4e86\u652f\u6301HIL Internal\u4eff\u771f\u6a21\u5f0f\uff0c\u5373\u65e0\u4eba\u673a\u6a21\u578b (\u5305\u62ec\u4f20\u611f\u5668\u6a21\u578b)\u8dd1\u5728\u98de\u63a7\u4e0a\u800c\u975e\u5916\u90e8\u7684\u5b9e\u65f6PC\u3002 \u4efb\u52a1\u5c42 (Task)\uff1a \u6bcf\u4e2aTask\u4e3a\u4e00\u4e2a\u5355\u72ec\u7684\u7ebf\u7a0b (\u5185\u90e8\u53ef\u4ee5\u521b\u5efa\u5b50\u7ebf\u7a0b) \u5b9e\u73b0\u72ec\u7acb\u7684\u529f\u80fd\u3002\u6bd4\u5982\u6700\u91cd\u8981\u7684Vehicle\u4efb\u52a1\uff0c\u5c06\u9009\u62e9\u9002\u5408\u88ab\u63a7\u5bf9\u8c61\u7684INS\uff0cFMS\u548cController\u7ec4\u4ef6\uff0c\u8d1f\u8d23\u5468\u671f\u6027\u8fd0\u884c\u6a21\u578b\u5e76\u91c7\u96c6\u548c\u53d1\u5e03\u6a21\u578b\u7684\u8f93\u5165/\u8f93\u51fa\u6570\u636e\uff0c\u56e0\u6b64Vehicle\u4efb\u52a1\u5177\u6709\u6700\u9ad8\u4f18\u5148\u7ea7\uff0c\u4ee5\u4fdd\u8bc1\u88ab\u63a7\u5bf9\u8c61\u7684\u7a33\u5b9a\u3002FMT IO\u4efb\u52a1\u8d1f\u8d23\u8ddfIO\u534f\u5904\u7406\u5668\u8fdb\u884c\u901a\u4fe1\uff0cIO\u5c06\u63d0\u4f9bRC\u548cMotor\u7b49\u76f8\u5173\u7684\u529f\u80fd\u3002Logger\u4efb\u52a1\u8d1f\u8d23\u5c06\u91c7\u96c6blog\u548culog\u7684\u65e5\u5fd7\u6570\u636e\u5e76\u5b58\u50a8\u5230\u5bf9\u5e94\u7684\u5b58\u50a8\u8bbe\u5907\uff0c\u5982SD\u5361\u3002Communication\u4efb\u52a1\u4f7f\u7528mavproxy\u6a21\u5757\u7684\u63a5\u53e3\u63d0\u4f9bmavlink\u901a\u4fe1\u76f8\u5173\u7684\u529f\u80fd\u3002Status\u4efb\u52a1\u7684\u4e3b\u8981\u529f\u80fd\u662f\u663e\u793a\u5f53\u524d\u7cfb\u7edf\u7684\u72b6\u6001\uff0c\u53ef\u4ee5\u901a\u8fc7LED\uff0c\u8702\u9e23\u5668\u548c\u63a7\u5236\u53f0\u7b49\u8fdb\u884c\u663e\u793a\u3002 \u5e94\u7528\u5c42 (App) (TODO) : \u5e94\u7528\u5c42\u91c7\u7528\u52a8\u6001\u52a0\u8f7d\u7684\u6a21\u5f0f\uff0c\u4f7f\u7528FMT\u63d0\u4f9b\u7684SDK\u5b9e\u73b0\u4e00\u4e9b\u590d\u6742\u7684\u4efb\u52a1\u529f\u80fd\uff0c\u6bd4\u5982\u89c6\u89c9\u907f\u969c\uff0c\u8def\u5f84\u89c4\u5212\u7b49\u3002 \u5c55\u671b \u9664\u4e86\u65e0\u4eba\u673a\u4ee5\u5916\uff0cFMT\u4e5f\u53ef\u4ee5\u88ab\u7528\u4e8e\u65e0\u4eba\u8f66\uff0c\u65e0\u4eba\u8239\u548c\u673a\u5668\u4eba\u7b49\u65e0\u4eba\u63a7\u5236\u7cfb\u7edf\u3002\u53ea\u9700\u5f00\u53d1\u5bf9\u5e94\u7684\u7b97\u6cd5\u6a21\u5757 (INS, FMS\u548cController)\uff0c\u4e5f\u53ef\u4eceFMT Model\u4e2d\u5df2\u6709\u7684\u6a21\u578b\u5e93\u4e2d\u9009\u62e9\u9002\u7528\u7684\u6a21\u578b\u6216\u8005\u8fdb\u884c\u9002\u5f53\u4fee\u6539\u3002\u5f80\u540e\u671f\u671b\u5e7f\u5927\u5f00\u53d1\u8005\u53ef\u4ee5\u8d21\u732e\u65b0\u7684\u6a21\u578b\u5e93\uff0c\u4f7f\u5f97FMT Model\u7684\u6a21\u578b\u5e93\u9010\u6b65\u58ee\u5927\uff0c\u4ee5\u652f\u6301\u5404\u79cd\u7b97\u6cd5\u548c\u4e0d\u540c\u7684Vehicle\u3002","title":"\u6982\u8ff0"},{"location":"#_1","text":"","title":"\u6982\u8ff0"},{"location":"#firmament","text":"Firmament (FMT) \u662f\u4e00\u6b3e\u4e13\u4e3a\u57fa\u4e8e\u6a21\u578b\u5f00\u53d1 (MBD, Model Based Design) \u800c\u8bbe\u8ba1\u7684\u5f00\u6e90\u98de\u63a7\u7cfb\u7edf\u3002FMT\u4e3b\u8981\u5305\u62ec\u4e24\u90e8\u5206\uff1a FMT Firmware \uff1a\u5d4c\u5165\u5f0f\u98de\u63a7\u7cfb\u7edf\u3002\u63d0\u4f9b\u5b89\u5168\u7a33\u5b9a\u7684\u5d4c\u5165\u5f0f\u529f\u80fd\u4ee5\u53ca\u9488\u5bf9MBD\u5f00\u53d1\u800c\u9700\u8981\u7684\u529f\u80fd\u6a21\u5757\u548c\u7cfb\u7edf\u6846\u67b6\u3002 FMT Model \uff1a\u57fa\u4e8e\u6a21\u578b\u8bbe\u8ba1\u7684\u7b97\u6cd5\u6a21\u5757\u3002\u53ef\u4ee5\u76f4\u63a5\u751f\u6210C/C++\u6e90\u7801\u5e76\u5d4c\u5165\u98de\u63a7\u7cfb\u7edf\u4e2d\u3002\u9664\u6b64\u4e4b\u5916\uff0cFMT Model\u8fd8\u63d0\u4f9b\u5f3a\u5927\u7684\u4eff\u771f\u529f\u80fd\uff0c\u5982\u6a21\u578b\u5728\u73af\u4eff\u771f (MIL)\uff0c\u786c\u4ef6\u5728\u73af\u4eff\u771f (HIL) \u548c\u5f00\u73af\u4eff\u771f (Open Loop Simulation)\u3002","title":"Firmament\u6982\u8ff0"},{"location":"#fmt-firmware","text":"FMT Firmware\u4e3b\u8981\u7528C\u8bed\u8a00\u7f16\u5199\uff0c\u4ee3\u7801\u7b80\u6d01\u6613\u7528\u3002\u9ad8\u5ea6\u6a21\u5757\u5316\u7684\u67b6\u6784\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u4ee3\u7801\u79fb\u690d\u548c\u7b97\u6cd5\u6a21\u5757\u66ff\u6362\u53d8\u5f97\u7b80\u5355\u3002FMT\u98de\u63a7\u57fa\u4e8ePixhawk V2\u7684\u786c\u4ef6\u8fdb\u884c\u5f00\u53d1\uff0c\u5305\u62ecFMU(stm32F427)\u548cIO(stm32F103)\u4e24\u4e2a\u90e8\u5206\u7684\u56fa\u4ef6\u3002FMT\u652f\u6301Mavlink 1.0/2.0\uff0c\u6240\u4ee5\u53ef\u4ee5\u652f\u6301\u4e3b\u6d41\u7684\u5730\u9762\u7ad9\uff0c\u5982QGC\u7b49\u3002\u9664\u6b64\u4e4b\u5916\uff0cFMT\u4e0e\u5176\u5b83\u4e3b\u8981\u5f00\u6e90\u98de\u63a7\u7684\u4e3b\u8981\u533a\u522b\u4e4b\u4e00\u5728\u4e8e\u5176\u9ad8\u5ea6\u5951\u5408MBD\u7684\u5f00\u53d1\u6a21\u5f0f\uff0c\u80fd\u591f\u57fa\u4e8eSimulink\u5feb\u901f\u8bbe\u8ba1\uff0c\u90e8\u7f72\u548c\u9a8c\u8bc1\u4f60\u7684\u7b97\u6cd5\u6a21\u5757\u3002","title":"FMT Firmware"},{"location":"#fmt-model","text":"FMT Model\u4e3aSimulink\u7f16\u5199\u7684\u7b97\u6cd5\u6a21\u5757\uff0c\u5bf9\u4e8e\u98de\u63a7\u7cfb\u7edf\u6765\u8bf4\uff0c\u4e3b\u8981\u5305\u542b\u5bfc\u822a\u7cfb\u7edf(INS)\uff0c\u98de\u884c\u7ba1\u7406\u7cfb\u7edf(FMS)\u548c\u63a7\u5236\u7cfb\u7edf(Controller)\u4e09\u5927\u7b97\u6cd5\u6a21\u5757\u3002FMT Model\u901a\u8fc7Simulink Embedded Coder\u751f\u6210C/C++\u4ee3\u7801\uff0c\u53ea\u9700\u7b80\u5355copy\u5230FMT Firmware\u76f8\u5173\u6a21\u5757\u4e2d\uff0c\u5373\u53ef\u5b8c\u6210\u7b97\u6cd5\u7684\u5d4c\u5165\uff0c\u800c\u65e0\u9700\u4fee\u6539\u98de\u63a7\u7684\u4ee3\u7801 (\u53ea\u8981\u9075\u5faaFMT Model Interface\u6807\u51c6)\u3002FMT Model\u8fd8\u5305\u542b\u65e0\u4eba\u673a\u7684\u7269\u7406\u6a21\u578b(Plant)\uff0c\u4ece\u800c\u53ef\u4ee5\u652f\u6301\u6a21\u578b\u5728\u73af\u4eff\u771f(MIL)\u548c\u786c\u4ef6\u5728\u73af\u4eff\u771f(HIL)\uff0c\u5176\u5b83\u6a21\u578b\uff0c\u5982\u56fa\u5b9a\u7ffc\uff0cVTOL\u7b49\u6a21\u578b\u4e5f\u4f1a\u9010\u6e10\u652f\u6301 (\u6b22\u8fce\u5927\u5bb6\u8d21\u732e\uff01)\u3002\u7ed3\u5408\u98de\u63a7\u7cfb\u7edf\u7684\u5b9e\u65f6\u65e5\u5fd7\u529f\u80fd\uff0c\u53ef\u4ee5\u5c06\u65e5\u5fd7\u6570\u636e\u5bfc\u5165\u6a21\u578b\u8fdb\u884c\u5f00\u73af\u4eff\u771f(Open Loop Simulation)\uff0c\u5f97\u5230\u548c\u5728\u786c\u4ef6\u4e0a\u8fd0\u884c\u5b8c\u5168\u4e00\u81f4\u7684\u4eff\u771f\u7ed3\u679c\u3002","title":"FMT Model"},{"location":"#firmament_1","text":"FMT\u91c7\u7528 \u5206\u5c42\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u4f7f\u5f97\u5c42\u4e0e\u5c42\uff0c\u6a21\u5757\u4e0e\u6a21\u5757\u4e4b\u95f4\u53bb\u8026\u5408\uff0c\u5404\u4e2a\u6a21\u5757\u53ef\u4ee5\u5355\u72ec\u52a0\u8f7d\u6216\u5220\u9664 \u3002 FMT\u67b6\u6784\u5982\u4e0b\u56fe\u6240\u793a\u3002 \u5b83\u5177\u4f53\u5305\u62ec\u4ee5\u4e0b\u90e8\u5206\uff1a \u5185\u6838\u5c42 (RTOS): \u5185\u6838\u5c42\u91c7\u7528\u5b9e\u65f6\u64cd\u4f5c\u7cfb\u7edfRT-Thread,\u63d0\u4f9b\u4e86\u4f8b\u5982\u591a\u7ebf\u7a0b\u53ca\u5176\u8c03\u5ea6\u3001\u4fe1\u53f7\u91cf\u3001\u90ae\u7bb1\u3001\u6d88\u606f\u961f\u5217\u3001\u5185\u5b58\u7ba1\u7406\u3001\u5b9a\u65f6\u5668\u7b49\uff1bDFS \u662f RT-Thread \u63d0\u4f9b\u7684\u865a\u62df\u6587\u4ef6\u7cfb\u7edf\u7ec4\u4ef6\uff0c\u5168\u79f0\u4e3a Device File System, \u63d0\u4f9b\u6807\u51c6POSIX\u63a5\u53e3\u3002MSH\u4e3aRT-Thread\u63d0\u4f9b\u7684\u547d\u4ee4\u884c\u7cfb\u7edf\u7ec4\u4ef6\uff0cFMT\u57fa\u4e8eMSH\u8fdb\u4e00\u6b65\u5c01\u88c5\uff0c\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u6307\u4ee4\u3002Library\u5219\u5305\u542b\u4e00\u4e9b\u4e09\u65b9\u5e93\uff0c\u5982Mavlink, STIM32 Standard Library\u7b49\u3002 \u9a71\u52a8\u5c42 (Driver): \u9a71\u52a8\u5c42\u63d0\u4f9b\u4e86Pixhawk\u677f\u8f7d\u548c\u5916\u6269\u7684\u5916\u8bbe\u9a71\u52a8\u652f\u6301\uff0c\u5982IMU, GPS, \u78c1\u529b\u8ba1\uff0c\u6c14\u538b\u8ba1\uff0cSD\u5361\uff0cUSB\u4ee5\u53ca\u901a\u4fe1\u603b\u7ebf\uff0c\u5982I2C\uff0cSPI\uff0cDMA\u7b49\u3002 \u786c\u4ef6\u62bd\u8c61\u5c42 (HAL)\uff1a \u5728Driver\u5c42\u4e4b\u4e0a\u7684HAL\u4e3a\u4e0a\u5c42\u63d0\u4f9b\u7edf\u4e00\u7684\u8bbe\u5907\u63a5\u53e3 (rt_read, rt_write, rt_control)\uff0c\u8fd9\u6837\u5f53\u66ff\u6362\u4e0d\u540c\u7684\u9a71\u52a8\u8bbe\u5907\u6216\u8005\u79fb\u690d\u5230\u4e0d\u540c\u786c\u4ef6\u4e0a\u65f6\uff0c\u4e0a\u5c42\u5c06\u4e0d\u9700\u8981\u6216\u8005\u53ea\u9700\u505a\u5f88\u5c11\u7684\u6539\u52a8\u5373\u53ef\u3002\u4e00\u4e9b\u4e0e\u786c\u4ef6\u65e0\u5173\u7684\u9a71\u52a8\u903b\u8f91\u4e5f\u53ef\u4ee5\u90fd\u653e\u5728HAL\u5c42\u4e2d\u5b9e\u73b0\uff0c\u8fd9\u6837\u5c31\u7b80\u5316\u4e86\u9a71\u52a8\u7684\u5f00\u53d1\u96be\u5ea6\u3002 \u6a21\u5757\u5c42 (Module)\uff1a\u6a21\u5757\u5c42\u63d0\u4f9bFMT\u7cfb\u7edf\u7684\u57fa\u7840\u529f\u80fd\u6a21\u5757\uff0c\u7cfb\u7edf\u7684\u5927\u90e8\u5206\u529f\u80fd\u5728\u8fd9\u5c42\u5b9e\u73b0\uff0c\u5e76\u63d0\u4f9b\u7ed9Task\u5c42\u8fdb\u884c\u7ec4\u5408\uff0c\u8c03\u7528\u3002\u6bd4\u5982\u8de8\u8fdb\u7a0b\u901a\u4fe1\u6a21\u5757uMCN\u63d0\u4f9b\u57fa\u4e8e\u53d1\u5e03/\u8ba2\u9605\u6a21\u5f0f\u7684\u5b89\u5168\u8de8\u8fdb\u7a0b\u901a\u4fe1\u673a\u5236\u3002log\u6a21\u5757\u63d0\u4f9b\u4e86\u4e8c\u8fdb\u5236\u65e5\u5fd7 (blog)\u548c\u6587\u5b57\u65e5\u5fd7 (ulog)\u7684\u529f\u80fd\u3002blog\u63d0\u4f9b\u529f\u80fd\u5f3a\u5927\u7684\u6570\u636e\u8bb0\u5f55\u529f\u80fd\uff0c\u5728\u4e0d\u5f71\u54cd\u9ad8\u4f18\u5148\u7ea7\u4efb\u52a1\u7684\u524d\u63d0\u4e0b\u5b9e\u65f6\u8bb0\u5f55\u7b97\u6cd5\u6a21\u5757\u7684\u8f93\u5165/\u8f93\u5165\u6570\u636e\uff0c\u4f9bSimulink\u6a21\u578b\u8fdb\u884c\u5f00\u73af\u4eff\u771f\u3002param\u53c2\u6570\u6a21\u5757\u63d0\u4f9b\u65b9\u4fbf\u7684\u53c2\u6570\u529f\u80fd\uff0c\u652f\u6301\u547d\u4ee4\u884c/\u5730\u9762\u7ad9\u5728\u7ebf\u8c03\u53c2\uff0c\u5e76\u4e14\u53c2\u6570\u5c06\u88ab\u8bb0\u5f55\u5230blog\u65e5\u5fd7\u4e2d\uff0c\u4f9b\u4eff\u771f\u6a21\u5757\u8bfb\u53d6\u3002\u7b97\u6cd5\u6a21\u5757INS, FMS, Controller\u4e3aFMT Model\u751f\u6210\u7684C/C++\u6e90\u6587\u4ef6\uff0c\u53ea\u8981\u6a21\u5757\u7b26\u5408FMT Model Interface\u7684\u6807\u51c6\uff0c\u5219\u53ef\u4ee5\u76f4\u63a5\u5d4c\u5165\u5230FMT\u98de\u63a7\u4e2d\uff0c\u800c\u65e0\u9700\u505a\u4efb\u4f55\u4fee\u6539\u3002Plant\u6a21\u5757\u4e3a\u65e0\u4eba\u673a\u7684\u7269\u7406\u6a21\u578b (\u4e5f\u53ef\u4ee5\u662f\u5176\u5b83\u5bf9\u8c61\u6a21\u578b)\uff0c\u540c\u6837\u4e3aFMT Model\u751f\u6210\u3002\u5b83\u4e3b\u8981\u662f\u4e3a\u4e86\u652f\u6301HIL Internal\u4eff\u771f\u6a21\u5f0f\uff0c\u5373\u65e0\u4eba\u673a\u6a21\u578b (\u5305\u62ec\u4f20\u611f\u5668\u6a21\u578b)\u8dd1\u5728\u98de\u63a7\u4e0a\u800c\u975e\u5916\u90e8\u7684\u5b9e\u65f6PC\u3002 \u4efb\u52a1\u5c42 (Task)\uff1a \u6bcf\u4e2aTask\u4e3a\u4e00\u4e2a\u5355\u72ec\u7684\u7ebf\u7a0b (\u5185\u90e8\u53ef\u4ee5\u521b\u5efa\u5b50\u7ebf\u7a0b) \u5b9e\u73b0\u72ec\u7acb\u7684\u529f\u80fd\u3002\u6bd4\u5982\u6700\u91cd\u8981\u7684Vehicle\u4efb\u52a1\uff0c\u5c06\u9009\u62e9\u9002\u5408\u88ab\u63a7\u5bf9\u8c61\u7684INS\uff0cFMS\u548cController\u7ec4\u4ef6\uff0c\u8d1f\u8d23\u5468\u671f\u6027\u8fd0\u884c\u6a21\u578b\u5e76\u91c7\u96c6\u548c\u53d1\u5e03\u6a21\u578b\u7684\u8f93\u5165/\u8f93\u51fa\u6570\u636e\uff0c\u56e0\u6b64Vehicle\u4efb\u52a1\u5177\u6709\u6700\u9ad8\u4f18\u5148\u7ea7\uff0c\u4ee5\u4fdd\u8bc1\u88ab\u63a7\u5bf9\u8c61\u7684\u7a33\u5b9a\u3002FMT IO\u4efb\u52a1\u8d1f\u8d23\u8ddfIO\u534f\u5904\u7406\u5668\u8fdb\u884c\u901a\u4fe1\uff0cIO\u5c06\u63d0\u4f9bRC\u548cMotor\u7b49\u76f8\u5173\u7684\u529f\u80fd\u3002Logger\u4efb\u52a1\u8d1f\u8d23\u5c06\u91c7\u96c6blog\u548culog\u7684\u65e5\u5fd7\u6570\u636e\u5e76\u5b58\u50a8\u5230\u5bf9\u5e94\u7684\u5b58\u50a8\u8bbe\u5907\uff0c\u5982SD\u5361\u3002Communication\u4efb\u52a1\u4f7f\u7528mavproxy\u6a21\u5757\u7684\u63a5\u53e3\u63d0\u4f9bmavlink\u901a\u4fe1\u76f8\u5173\u7684\u529f\u80fd\u3002Status\u4efb\u52a1\u7684\u4e3b\u8981\u529f\u80fd\u662f\u663e\u793a\u5f53\u524d\u7cfb\u7edf\u7684\u72b6\u6001\uff0c\u53ef\u4ee5\u901a\u8fc7LED\uff0c\u8702\u9e23\u5668\u548c\u63a7\u5236\u53f0\u7b49\u8fdb\u884c\u663e\u793a\u3002 \u5e94\u7528\u5c42 (App) (TODO) : \u5e94\u7528\u5c42\u91c7\u7528\u52a8\u6001\u52a0\u8f7d\u7684\u6a21\u5f0f\uff0c\u4f7f\u7528FMT\u63d0\u4f9b\u7684SDK\u5b9e\u73b0\u4e00\u4e9b\u590d\u6742\u7684\u4efb\u52a1\u529f\u80fd\uff0c\u6bd4\u5982\u89c6\u89c9\u907f\u969c\uff0c\u8def\u5f84\u89c4\u5212\u7b49\u3002","title":"Firmament\u67b6\u6784"},{"location":"#_2","text":"\u9664\u4e86\u65e0\u4eba\u673a\u4ee5\u5916\uff0cFMT\u4e5f\u53ef\u4ee5\u88ab\u7528\u4e8e\u65e0\u4eba\u8f66\uff0c\u65e0\u4eba\u8239\u548c\u673a\u5668\u4eba\u7b49\u65e0\u4eba\u63a7\u5236\u7cfb\u7edf\u3002\u53ea\u9700\u5f00\u53d1\u5bf9\u5e94\u7684\u7b97\u6cd5\u6a21\u5757 (INS, FMS\u548cController)\uff0c\u4e5f\u53ef\u4eceFMT Model\u4e2d\u5df2\u6709\u7684\u6a21\u578b\u5e93\u4e2d\u9009\u62e9\u9002\u7528\u7684\u6a21\u578b\u6216\u8005\u8fdb\u884c\u9002\u5f53\u4fee\u6539\u3002\u5f80\u540e\u671f\u671b\u5e7f\u5927\u5f00\u53d1\u8005\u53ef\u4ee5\u8d21\u732e\u65b0\u7684\u6a21\u578b\u5e93\uff0c\u4f7f\u5f97FMT Model\u7684\u6a21\u578b\u5e93\u9010\u6b65\u58ee\u5927\uff0c\u4ee5\u652f\u6301\u5404\u79cd\u7b97\u6cd5\u548c\u4e0d\u540c\u7684Vehicle\u3002","title":"\u5c55\u671b"},{"location":"contribute/","text":"","title":"\u8d21\u732e"},{"location":"device/","text":"\u8bbe\u5907\u548c\u9a71\u52a8 \u5bf9\u4e8e\u4e0d\u540c\u7684\u5d4c\u5165\u5f0f\u5e73\u53f0\u90fd\u5305\u62ec\u4e00\u4e9b I/O (Input/Output, \u8f93\u5165/\u8f93\u51fa) \u8bbe\u5907\uff0c\u4f8b\u5982\u98de\u63a7\u786c\u4ef6\u5e73\u53f0\u4e0a\u7684\u4e32\u53e3\u901a\u4fe1\u3001\u60ef\u6027\u4f20\u611f\u539f\u4ef6\u3001USB \u4ee5\u53ca SD \u5361\u7b49\u3002\u8fd9\u4e9b\u8bbe\u5907\u4e3a\u4e0a\u5c42\u5e94\u7528\u63d0\u4f9b\u76f8\u5173\u786c\u4ef6\u7684 I/O \u529f\u80fd\u3002 \u672c\u7ae0\u4e3b\u8981\u4ecb\u7ecd Firmament \u7684 I/O \u8bbe\u5907\u548c\u9a71\u52a8\u6846\u67b6\uff0c\u5305\u62ec\u5982\u4f55\u8bbf\u95ee I/O \u8bbe\u5907\u4ee5\u53ca\u5982\u4f55\u5411 Firmament \u7cfb\u7edf\u4e2d\u6dfb\u52a0\u65b0\u7684I/O\u8bbe\u5907\u6216\u8005\u9a71\u52a8\u3002 \u8bbe\u5907\u548c\u9a71\u52a8\u6846\u67b6 Firmament \u7684 I/O \u8bbe\u5907\u6a21\u578b\u6846\u67b6\u5982\u4e0b\u56fe\u6240\u793a\u3002\u5b83\u4f4d\u4e8e\u786c\u4ef6\u548c\u4e0a\u5c42\u5e94\u7528\u4e4b\u95f4\uff0c\u5171\u5206\u6210\u4e09\u5c42\uff0c\u4ece\u4e0a\u5230\u4e0b\u5206\u522b\u662f I/O \u8bbe\u5907\u7ba1\u7406\u5c42\u3001\u786c\u4ef6\u62bd\u8c61\u5c42 (HAL)\u548c\u8bbe\u5907\u9a71\u52a8\u5c42\u3002 \u4e0a\u5c42\u5e94\u7528\u901a\u8fc7 I/O \u8bbe\u5907\u7ba1\u7406\u63a5\u53e3\u83b7\u5f97\u6b63\u786e\u7684\u8bbe\u5907\u53e5\u67c4\uff0c\u7136\u540e\u901a\u8fc7\u8fd9\u4e2a\u8bbe\u5907\u53e5\u67c4\u6765\u4e0e\u5bf9\u5e94\u7684\u8bbe\u5907\u8fdb\u884c\u6570\u636e\uff08\u6216\u63a7\u5236\uff09\u4ea4\u4e92\u3002 I/O \u8bbe\u5907\u7ba1\u7406\u5c42\u4e3a RT-Thread \u63d0\u4f9b\u7684 \u8bbe\u5907\u8bbf\u95ee\u63a5\u53e3 \u3002\u4e0a\u5c42\u5e94\u7528\u901a\u8fc7 I/O \u8bbe\u5907\u5c42\u63d0\u4f9b\u7684\u6807\u51c6\u63a5\u53e3\u8bbf\u95ee\u5e95\u5c42\u8bbe\u5907\u3002\u8fd9\u91cc\u7684\u5e95\u5c42\u8bbe\u5907\u65e2\u53ef\u4ee5\u662f \u901a\u7528\u8bbe\u5907 \u3001 \u666e\u901a\u8bbe\u5907 \u6216\u8005 \u865a\u62df\u8bbe\u5907 \u3002 \u786c\u4ef6\u62bd\u8c61\u5c42\u662f\u5bf9\u5e73\u53f0\u901a\u7528\u8bbe\u5907\u9a71\u52a8\u7684\u62bd\u8c61\uff0c\u76ee\u7684\u662f\u4e3a\u4e0d\u540c\u578b\u53f7\u7684\u786c\u4ef6\u8bbe\u5907\u63d0\u4f9b\u7edf\u4e00\u7684 API \u63a5\u53e3\u3002\u5c06\u4e0e\u786c\u4ef6\u65e0\u5173\u7684\u9a71\u52a8\u903b\u8f91\u653e\u5728\u8be5\u5c42\u5b9e\u73b0\uff0c\u4ece\u800c\u7b80\u5316\u9a71\u52a8\u5f00\u53d1\u7684\u96be\u5ea6\u3002\u540c\u65f6\uff0c\u8fd9\u79cd\u65b9\u5f0f\u4f7f\u5f97\u8bbe\u5907\u7684\u786c\u4ef6\u64cd\u4f5c\u76f8\u5173\u7684\u4ee3\u7801\u80fd\u591f\u72ec\u7acb\u4e8e\u4e0a\u5c42\u800c\u5b58\u5728\uff0c\u66f4\u6362/\u5347\u7ea7\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u7684\u5347\u7ea7\u6216\u8005\u79fb\u690d\u5230\u5176\u5b83\u786c\u4ef6\u5e73\u53f0\u66f4\u5c06\u4e0d\u4f1a\u5bf9\u4e0a\u5c42\u5e94\u7528\u4ea7\u751f\u5f71\u54cd\uff0c\u4ece\u800c\u964d\u4f4e\u4e86\u4ee3\u7801\u7684\u8026\u5408\u6027\u3001\u590d\u6742\u6027\uff0c\u63d0\u9ad8\u4e86\u7cfb\u7edf\u7684\u53ef\u9760\u6027\u548c\u53ef\u79fb\u690d\u6027\u3002 \u8bbe\u5907\u9a71\u52a8\u5c42\u63d0\u4f9b\u786c\u4ef6\u8bbe\u5907\u7684\u9a71\u52a8\u7a0b\u5e8f\uff0c\u4e0e\u786c\u4ef6\u76f4\u63a5\u6253\u4ea4\u9053\u3002\u9a71\u52a8\u8bbe\u5907\u8981\u80fd\u591f\u88ab\u4e0a\u5c42\u5e94\u7528\u4f7f\u7528\uff0c\u9996\u5148\u9700\u8981\u5c06\u81ea\u5df1\u6ce8\u518c\u4e3a\u901a\u7528\u8bbe\u5907\u6216\u8005\u666e\u901a\u8bbe\u5907\u3002 \u901a\u7528\u8bbe\u5907 \u901a\u7528\u8bbe\u5907\u662f\u6307\u5305\u542b\u4e86\u786c\u4ef6\u62bd\u8c61\u5c42\u548c\u8bbe\u5907\u9a71\u52a8\u5c42\u7684 I/O \u8bbe\u5907, \u5176\u4e00\u822c\u4e3a\u5404\u786c\u4ef6\u5e73\u53f0\u6240\u5171\u6709\u7684\u786c\u4ef6\u8bbe\u5907\u3002\u5bf9\u4e8e Pixhawk \u6765\u8bf4\uff0c\u901a\u7528\u8bbe\u5907\u4e00\u822c\u5305\u62ec\u4e32\u53e3\u3001PIN\u3001I2C\u3001SPI\u3001USB\u3001SD \u5361\u3001\u7535\u673a\u3001RC\u3001ADC\u3001\u52a0\u901f\u5ea6\u8ba1\u3001\u9640\u87ba\u4eea\u3001\u78c1\u529b\u8ba1\u3001GPS \u3001\u6c14\u538b\u8ba1\u3001\u5b9a\u65f6\u5668\u548c\u7cfb\u7edf\u65f6\u949f\u7b49\u3002 \u901a\u7528\u8bbe\u5907\u7531\u5e95\u5c42\u9a71\u52a8\u7a0b\u5e8f\u8fdb\u884c\u6ce8\u518c\uff0c\u7136\u540e\u5728\u62bd\u8c61\u5c42\u4e2d\u518d\u6ce8\u518c\u4e3a\u7cfb\u7edf\u8bbe\u5907\u3002\u901a\u7528\u8bbe\u5907\u7684\u64cd\u4f5c\u65b9\u6cd5\u7684\u6620\u5c04\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u5176\u4e2d driver_ops \u4e3a\u786c\u4ef6\u62bd\u8c61\u5c42\u5b9a\u4e49\u7684\u5404\u4e2a\u8bbe\u5907\u9a71\u52a8\u7684\u529f\u80fd\u51fd\u6570 (operation functions)\u3002 \u9a71\u52a8\u7a0b\u5e8f\u9700\u8981\u5b9e\u73b0\u5bf9\u5e94\u7684\u529f\u80fd\u51fd\u6570\uff0c\u5e76\u5c06\u5176\u6ce8\u518c\u4e3a\u5bf9\u5e94\u7684\u901a\u7528\u8bbe\u5907\u3002 \u666e\u901a\u8bbe\u5907 \u666e\u901a\u8bbe\u5907\u662f\u6307\u4e0d\u5305\u542b\u786c\u4ef6\u62bd\u8c61\u5c42\uff0c\u7531\u9a71\u52a8\u5c42\u76f4\u63a5\u5411\u7cfb\u7edf\u6ce8\u518c\u4e3a\u7cfb\u7edf\u8bbe\u5907\u3002\u666e\u901a\u8bbe\u5907\u6ca1\u6709\u4e0e\u4e4b\u5bf9\u5e94\u7684\u786c\u4ef6\u62bd\u8c61\u5c42\u7684\u901a\u7528\u8bbe\u5907\uff0c\u6240\u4ee5\u666e\u901a\u8bbe\u5907\u4e00\u822c\u7528\u4e8e\u67d0\u4e2a\u5d4c\u5165\u5f0f\u5e73\u53f0\u6240\u7279\u6709\u7684\u786c\u4ef6\uff0c\u6bd4\u5982 Pixhawk \u4e0a\u7684\u4e09\u8272 LED \u706f\u3002\u666e\u901a\u8bbe\u5907\u7684\u64cd\u4f5c\u65b9\u6cd5\u7684\u6620\u5c04\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u865a\u62df\u8bbe\u5907 \u865a\u62df\u8bbe\u5907\u662f\u4e00\u79cd\u6bd4\u8f83\u7279\u6b8a\u7684\u8bbe\u5907\uff0c\u5177\u6709\u5f88\u5927\u7684\u7075\u6d3b\u6027\u3002\u5408\u7406\u5229\u7528\u597d\u865a\u62df\u8bbe\u5907\uff0c\u53ef\u4ee5\u5927\u5927\u4f18\u5316\u7cfb\u7edf\u67b6\u6784\u5e76\u7b80\u5316\u4e0a\u5c42\u5e94\u7528\u7684\u5f00\u53d1\u590d\u6742\u5ea6\u3002 \u4e0d\u540c\u4e8e\u901a\u7528\u8bbe\u5907\u548c\u666e\u901a\u8bbe\u5907\uff0c\u865a\u62df\u8bbe\u5907\u6784\u5efa\u4e8e\u901a\u7528\u8bbe\u5907\u6216\u8005\u5176\u5b83\u6a21\u5757\u63d0\u4f9b\u7684\u63a5\u53e3\u51fd\u6570\u4e4b\u4e0a\u3002 \u865a\u62df\u8bbe\u5907\u7684\u64cd\u4f5c\u65b9\u6cd5\u7684\u6620\u5c04\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff1a Firmament \u4e2d\u5305\u542b\u4e86\u8bb8\u591a\u7684\u865a\u62df\u8bbe\u5907\uff0c\u6bd4\u5982 mav_console \u8bbe\u5907\u63d0\u4f9b\u4e86\u5c06\u63a7\u5236\u53f0\u6d88\u606f\u5c01\u88c5\u4e3a mavlink \u534f\u8bae\u5305\u8fdb\u884c\u53d1\u9001\u7684\u529f\u80fd\u3002mav_console \u5728 HAL \u5c42\u5c06\u6570\u636e\u5c01\u88c5\u4e3a mavlink \u6570\u636e\u5305\uff08 MAVLINK_MSG_ID_SERIAL_CONTROL \uff09\uff0c \u7136\u540e\u901a\u8fc7 serial \u6216\u8005 usb \u8bbe\u5907\u8fdb\u884c\u6570\u636e\u53d1\u9001\u3002 \u8bbf\u95ee I/O \u8bbe\u5907 \u5f53\u8bbe\u5907\u88ab\u6ce8\u518c\u5230\u7cfb\u7edf\u540e\uff0c\u4e0a\u5c42\u5e94\u7528\u5c31\u53ef\u4ee5\u901a\u8fc7 I/O \u8bbe\u5907\u7ba1\u7406\u63a5\u53e3\u6765\u8bbf\u95ee\u8be5\u8bbe\u5907\uff08\u901a\u7528\u8bbe\u5907\uff0c\u666e\u901a\u8bbe\u5907\u6216\u8005\u865a\u62df\u8bbe\u5907\uff09\u3002 \u9996\u5148\u901a\u8fc7\u8bbe\u5907\u540d\u79f0\u6765\u83b7\u53d6\u8bbe\u5907\u53e5\u67c4\uff0c\u8fdb\u800c\u53ef\u4ee5\u64cd\u4f5c\u8bbe\u5907\u3002\u67e5\u627e\u8bbe\u5907\u51fd\u6570\u5982\u4e0b\u6240\u793a\uff1a rt_device_t rt_device_find(const char* name); \u83b7\u5f97\u8bbe\u5907\u8bbe\u5907\u53e5\u67c4\u540e\uff0c\u53ef\u4ee5\u6253\u5f00\u548c\u5173\u95ed\u8bbe\u5907\u3002\u6253\u5f00\u8bbe\u5907\u65f6\uff0c\u4f1a\u68c0\u6d4b\u8bbe\u5907\u662f\u5426\u5df2\u7ecf\u521d\u59cb\u5316\uff0c\u6ca1\u6709\u521d\u59cb\u5316\u5219\u4f1a\u9ed8\u8ba4\u8c03\u7528\u521d\u59cb\u5316\u63a5\u53e3\u521d\u59cb\u5316\u8bbe\u5907\u3002\u901a\u8fc7\u5982\u4e0b\u51fd\u6570\u6253\u5f00\u8bbe\u5907\uff1a rt_err_t rt_device_open(rt_device_t dev, rt_uint16_t oflags); \u4e0a\u5c42\u5e94\u7528\u6253\u5f00\u8bbe\u5907\u5b8c\u6210\u8bfb\u5199\u7b49\u64cd\u4f5c\u540e\uff0c\u5982\u679c\u4e0d\u9700\u8981\u518d\u5bf9\u8bbe\u5907\u8fdb\u884c\u64cd\u4f5c\u5219\u53ef\u4ee5\u5173\u95ed\u8bbe\u5907\uff0c\u8fdb\u800c\u91ca\u653e\u8bbe\u5907\u8d44\u6e90\u3002\u901a\u8fc7\u5982\u4e0b\u51fd\u6570\u5b8c\u6210\uff1a rt_err_t rt_device_close(rt_device_t dev); \u4ece\u8bbe\u5907\u4e2d\u8bfb/\u5199\u6570\u636e\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u51fd\u6570\u5b8c\u6210\uff1a rt_size_t rt_device_read(rt_device_t dev, rt_off_t pos,void* buffer, rt_size_t size); rt_size_t rt_device_write(rt_device_t dev, rt_off_t pos,const void* buffer, rt_size_t size); \u5176\u4e2d pos \u6839\u636e\u4e0d\u540c\u7684\u8bbe\u5907\u6709\u4e0d\u540c\u7684\u610f\u4e49\uff0c\u5177\u4f53\u542b\u4e49\u8bf7\u67e5\u770b\u5bf9\u5e94\u8bbe\u5907\u7684\u5934\u6587\u4ef6\u5b9a\u4e49\u3002 \u901a\u8fc7\u8bbe\u5907\u63a7\u5236\u51fd\u6570\uff0c\u4e0a\u5c42\u53ef\u4ee5\u5bf9\u8bbe\u5907\u8fdb\u884c\u63a7\u5236\uff0c\u901a\u8fc7\u5982\u4e0b\u51fd\u6570\u5b8c\u6210\uff1a rt_err_t rt_device_control(rt_device_t dev, rt_uint8_t cmd, void* arg); \u5176\u4e2d cmd \u6839\u636e\u4e0d\u540c\u7684\u8bbe\u5907\u6709\u4e0d\u540c\u7684\u610f\u4e49\uff0c\u5177\u4f53\u542b\u4e49\u8bf7\u67e5\u770b\u5bf9\u5e94\u8bbe\u5907\u7684\u5934\u6587\u4ef6\u5b9a\u4e49\u3002 \u6dfb\u52a0 I/O \u8bbe\u5907 \u8981\u6dfb\u52a0\u4e00\u4e2a I/O \u8bbe\u5907\u5230 Firmament\u4e2d\uff0c\u9996\u5148\u8981\u8003\u8651\u8981\u6dfb\u52a0\u8bbe\u5907\u7684\u7c7b\u578b\uff0c\u662f\u901a\u7528\u8bbe\u5907\u3001\u666e\u901a\u8bbe\u5907\u8fd8\u662f\u865a\u62df\u8bbe\u5907\uff1f\u4e0d\u540c\u8bbe\u5907\u7684\u6dfb\u52a0\u65b9\u5f0f\u4f1a\u7565\u6709\u4e0d\u540c\u3002\u8fd9\u91cc\u4ee5\u6dfb\u52a0\u4e00\u4e2a\u52a0\u901f\u5ea6\u8ba1\u6765\u6f14\u793a\u5982\u4f55\u6dfb\u52a0\u8bbe\u5907\u5230\u7cfb\u7edf\u4e2d\u3002 \u56e0\u4e3a\u52a0\u901f\u5ea6\u8ba1\u8bbe\u5907\u4e3a\u5404\u4e2a\u98de\u63a7\u5e73\u53f0\u5171\u6709\u7684\u8bbe\u5907\uff0c\u6240\u4ee5\u53ef\u4ee5\u786e\u5b9a\u5176\u4e3a\u901a\u7528\u8bbe\u5907\u3002Firmament \u5df2\u7ecf\u5b9e\u73b0\u4e86\u52a0\u901f\u5ea6\u8ba1\u786c\u4ef6\u62bd\u8c61\u5c42\u7684\u903b\u8f91 (\u5982\u679c\u6ca1\u6709\u5219\u9700\u8981\u81ea\u5df1\u5b9e\u73b0)\uff0c\u6240\u6709\u53ea\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a\u9a71\u52a8\u7a0b\u5e8f\uff0c\u5e76\u5b9e\u73b0 accel.h \u4e2d\u6240\u5b9a\u4e49\u7684 driver_ops \u9a71\u52a8\u529f\u80fd\u51fd\u6570\uff0c\u7136\u540e\u6ce8\u518c\u4e3a accel \u901a\u7528\u8bbe\u5907\u5373\u53ef\u5b8c\u6210\u8bbe\u5907\u7684\u6dfb\u52a0\u3002 \u52a0\u901f\u5ea6\u8ba1\u7684\u9a71\u52a8\u529f\u80fd\u51fd\u6570\u5b9a\u4e49\u5982\u4e0b\uff1a /* accel driver opeations */ struct accel_ops { rt_err_t (*accel_config)(accel_dev_t accel, const struct accel_configure* cfg); rt_err_t (*accel_control)(accel_dev_t accel, int cmd, void* arg); rt_size_t (*accel_read)(accel_dev_t accel, rt_off_t pos, void* data, rt_size_t size); }; \u9a71\u52a8\u9996\u5148\u9700\u8981\u5b9e\u73b0 accel_config \u51fd\u6570\u6765\u914d\u7f6e\u52a0\u901f\u5ea6\u8ba1\u7684\u53c2\u6570\uff0c\u5176\u4e2d accel_configure \u4e2d\u914d\u7f6e\u53c2\u6570\u5982\u4e0b\uff1a struct accel_configure { rt_uint32_t sample_rate_hz; rt_uint16_t dlpf_freq_hz; rt_uint32_t acc_range_g; }; \u5176\u4e2d sample_rate_hz \u4e3a\u91c7\u6837\u9891\u7387\uff0c dlpf_freq_hz \u4e3a\u786c\u4ef6\u4f4e\u901a\u6ee4\u6ce2\u622a\u81f3\u9891\u7387\uff0c acc_range_g \u4e3a\u52a0\u901f\u5ea6\u7684\u6d4b\u91cf\u8303\u56f4 \u3002 mpu6000.c \u4e2d\u7684\u914d\u7f6e\u51fd\u6570\u5b9e\u73b0\u5982\u4e0b\uff1a static rt_err_t accel_config(accel_dev_t accel, const struct accel_configure* cfg) { rt_err_t ret = RT_EOK; if (cfg == RT_NULL) { return RT_EINVAL; } ret |= _set_accel_range(cfg- acc_range_g); ret |= _set_sample_rate(cfg- sample_rate_hz); ret |= _set_dlpf_filter(cfg- dlpf_freq_hz); accel- config = *cfg; return ret; } \u7b2c\u4e8c\u4e2a\u8981\u5b9e\u73b0\u7684\u51fd\u6570\u662f accel_control \uff0c\u8be5\u51fd\u6570\u53ef\u4ee5\u7528\u6765\u7ed9\u9a71\u52a8\u8bbe\u5907\u4f20\u8f93\u4e00\u4e9b\u6307\u4ee4\u3002\u76ee\u524d accel \u8fd8\u6ca1\u6709\u5b9a\u4e49\u76f8\u5173\u7684\u6307\u4ee4\uff0c\u6240\u4ee5\u9a71\u52a8\u51fd\u6570\u76f4\u63a5\u8fd4\u56de\u6210\u529f\u5373\u53ef: static rt_err_t accel_control(accel_dev_t accel, int cmd, void* arg) { return RT_EOK; } \u6700\u540e\u4e00\u4e2a\u8981\u5b9e\u73b0\u7684\u51fd\u6570\u662f accel_read \uff0c\u8be5\u51fd\u6570\u5176\u7528\u6765\u8bfb\u53d6\u52a0\u901f\u5ea6\u8ba1\u7684\u6570\u636e\u3002\u8fd9\u91cc\u7684\u5b9a\u4e49 pos \u6709\u4e24\u4e2a\uff0c\u5206\u522b\u4e3a\u8bfb\u53d6\u52a0\u901f\u5ea6\u8ba1\u539f\u59cb\u6570\u636e\u548c\u6807\u51c6\u5316\u5355\u4f4d ( m/s 2 ) \u6570\u636e\u3002 /* accel read pos */ #define ACCEL_RD_RAW 1 #define ACCEL_RD_SCALE 2 mpu6000 \u7684\u8bfb\u53d6\u52a0\u901f\u5ea6\u8ba1\u6570\u636e\u51fd\u6570\u5b9e\u73b0\u5982\u4e0b\uff1a static rt_size_t accel_read(accel_dev_t accel, rt_off_t pos, void* data, rt_size_t size) { if (data == RT_NULL) { return 0; } if (pos == ACCEL_RD_RAW) { if (mpu6000_acc_read_raw(((int16_t*)data)) != RT_EOK) { return 0; } } else if (pos == ACCEL_RD_SCALE) { if (mpu6000_acc_read_m_s2(((float*)data)) != RT_EOK) { return 0; } } else { DRV_DBG( accel unknow read pos:%d\\n , pos); return 0; } return size; } \u9a71\u52a8\u7684\u529f\u80fd\u51fd\u6570\u5b9e\u73b0\u540e\uff0c\u5728\u9a71\u52a8\u7684\u521d\u59cb\u5316\u51fd\u6570\u4e2d\u8c03\u7528 hal_accel_register \u51fd\u6570\u5c06\u81ea\u5df1\u6ce8\u518c\u4e3a accel \u8bbe\u5907\uff1a rt_err_t mpu6000_drv_init(char* spi_device_name) { rt_err_t ret = RT_EOK; static struct accel_device accel_dev = { .ops = _accel_ops, .config = ACCEL_CONFIG_DEFAULT, .bus_type = GYRO_SPI_BUS_TYPE }; static struct gyro_device gyro_dev = { .ops = _gyro_ops, .config = GYRO_CONFIG_DEFAULT, .bus_type = GYRO_SPI_BUS_TYPE }; spi_device = rt_device_find(spi_device_name); if (spi_device == RT_NULL) { DRV_DBG( spi device %s not found!\\r\\n , spi_device_name); return RT_EEMPTY; } /* config spi */ { struct rt_spi_configuration cfg; cfg.data_width = 8; cfg.mode = RT_SPI_MODE_3 | RT_SPI_MSB; /* SPI Compatible Modes 3 */ cfg.max_hz = 3000000; struct rt_spi_device* spi_device_t = (struct rt_spi_device*)spi_device; spi_device_t- config.data_width = cfg.data_width; spi_device_t- config.mode = cfg.mode RT_SPI_MODE_MASK; spi_device_t- config.max_hz = cfg.max_hz; ret |= rt_spi_configure(spi_device_t, cfg); } /* driver internal init */ ret |= _init(); /* register gyro hal device */ ret |= hal_gyro_register( gyro_dev, gyro0 , RT_DEVICE_FLAG_RDWR, RT_NULL); /* register accel hal device */ ret |= hal_accel_register( accel_dev, accel0 , RT_DEVICE_FLAG_RDWR, RT_NULL); return ret; } \u5176\u4e2d accel0 \u4e3a\u8bbe\u5907\u540d\u79f0\uff0c\u4e0a\u5c42\u5e94\u7528\u901a\u8fc7\u8be5\u540d\u79f0\u6765\u83b7\u53d6\u8bbe\u5907\u53e5\u67c4\u3002 mpu6000 \u5305\u62ec\u4e00\u4e2a\u9640\u87ba\u4eea\u548c\u4e00\u4e2a\u52a0\u901f\u5ea6\u8ba1\uff0c\u6240\u4ee5\u8fd9\u91cc\u9664\u4e86\u6ce8\u518c\u52a0\u901f\u5ea6\u8ba1\u8bbe\u5907\u5916\uff0c\u8fd8\u6ce8\u518c\u4e86\u4e00\u4e2a\u9640\u87ba\u4eea\u8bbe\u5907\u3002 \u6ce8\u610f\uff1aFirmament \u9ed8\u8ba4\u4f7f\u7528 gyro0 \u548c accel0 \u4f5c\u4e3a\u7cfb\u7edf\u7684\u4e3b IMU\uff0c gyro1 \u548c accel1 \u4f5c\u4e3a\u526f IMU\u3002 \u6240\u4ee5\u5982\u679c\u8981\u4f7f\u7528\u67d0\u4e2a IMU \u8bbe\u5907\u4f5c\u4e3a\u4e3b IMU\uff0c\u5c06\u5176\u6ce8\u518c\u4e3a gyro0 \u548c accel0 \u5373\u53ef\u3002","title":"\u9a71\u52a8\u548c\u8bbe\u5907"},{"location":"device/#_1","text":"\u5bf9\u4e8e\u4e0d\u540c\u7684\u5d4c\u5165\u5f0f\u5e73\u53f0\u90fd\u5305\u62ec\u4e00\u4e9b I/O (Input/Output, \u8f93\u5165/\u8f93\u51fa) \u8bbe\u5907\uff0c\u4f8b\u5982\u98de\u63a7\u786c\u4ef6\u5e73\u53f0\u4e0a\u7684\u4e32\u53e3\u901a\u4fe1\u3001\u60ef\u6027\u4f20\u611f\u539f\u4ef6\u3001USB \u4ee5\u53ca SD \u5361\u7b49\u3002\u8fd9\u4e9b\u8bbe\u5907\u4e3a\u4e0a\u5c42\u5e94\u7528\u63d0\u4f9b\u76f8\u5173\u786c\u4ef6\u7684 I/O \u529f\u80fd\u3002 \u672c\u7ae0\u4e3b\u8981\u4ecb\u7ecd Firmament \u7684 I/O \u8bbe\u5907\u548c\u9a71\u52a8\u6846\u67b6\uff0c\u5305\u62ec\u5982\u4f55\u8bbf\u95ee I/O \u8bbe\u5907\u4ee5\u53ca\u5982\u4f55\u5411 Firmament \u7cfb\u7edf\u4e2d\u6dfb\u52a0\u65b0\u7684I/O\u8bbe\u5907\u6216\u8005\u9a71\u52a8\u3002","title":"\u8bbe\u5907\u548c\u9a71\u52a8"},{"location":"device/#_2","text":"Firmament \u7684 I/O \u8bbe\u5907\u6a21\u578b\u6846\u67b6\u5982\u4e0b\u56fe\u6240\u793a\u3002\u5b83\u4f4d\u4e8e\u786c\u4ef6\u548c\u4e0a\u5c42\u5e94\u7528\u4e4b\u95f4\uff0c\u5171\u5206\u6210\u4e09\u5c42\uff0c\u4ece\u4e0a\u5230\u4e0b\u5206\u522b\u662f I/O \u8bbe\u5907\u7ba1\u7406\u5c42\u3001\u786c\u4ef6\u62bd\u8c61\u5c42 (HAL)\u548c\u8bbe\u5907\u9a71\u52a8\u5c42\u3002 \u4e0a\u5c42\u5e94\u7528\u901a\u8fc7 I/O \u8bbe\u5907\u7ba1\u7406\u63a5\u53e3\u83b7\u5f97\u6b63\u786e\u7684\u8bbe\u5907\u53e5\u67c4\uff0c\u7136\u540e\u901a\u8fc7\u8fd9\u4e2a\u8bbe\u5907\u53e5\u67c4\u6765\u4e0e\u5bf9\u5e94\u7684\u8bbe\u5907\u8fdb\u884c\u6570\u636e\uff08\u6216\u63a7\u5236\uff09\u4ea4\u4e92\u3002 I/O \u8bbe\u5907\u7ba1\u7406\u5c42\u4e3a RT-Thread \u63d0\u4f9b\u7684 \u8bbe\u5907\u8bbf\u95ee\u63a5\u53e3 \u3002\u4e0a\u5c42\u5e94\u7528\u901a\u8fc7 I/O \u8bbe\u5907\u5c42\u63d0\u4f9b\u7684\u6807\u51c6\u63a5\u53e3\u8bbf\u95ee\u5e95\u5c42\u8bbe\u5907\u3002\u8fd9\u91cc\u7684\u5e95\u5c42\u8bbe\u5907\u65e2\u53ef\u4ee5\u662f \u901a\u7528\u8bbe\u5907 \u3001 \u666e\u901a\u8bbe\u5907 \u6216\u8005 \u865a\u62df\u8bbe\u5907 \u3002 \u786c\u4ef6\u62bd\u8c61\u5c42\u662f\u5bf9\u5e73\u53f0\u901a\u7528\u8bbe\u5907\u9a71\u52a8\u7684\u62bd\u8c61\uff0c\u76ee\u7684\u662f\u4e3a\u4e0d\u540c\u578b\u53f7\u7684\u786c\u4ef6\u8bbe\u5907\u63d0\u4f9b\u7edf\u4e00\u7684 API \u63a5\u53e3\u3002\u5c06\u4e0e\u786c\u4ef6\u65e0\u5173\u7684\u9a71\u52a8\u903b\u8f91\u653e\u5728\u8be5\u5c42\u5b9e\u73b0\uff0c\u4ece\u800c\u7b80\u5316\u9a71\u52a8\u5f00\u53d1\u7684\u96be\u5ea6\u3002\u540c\u65f6\uff0c\u8fd9\u79cd\u65b9\u5f0f\u4f7f\u5f97\u8bbe\u5907\u7684\u786c\u4ef6\u64cd\u4f5c\u76f8\u5173\u7684\u4ee3\u7801\u80fd\u591f\u72ec\u7acb\u4e8e\u4e0a\u5c42\u800c\u5b58\u5728\uff0c\u66f4\u6362/\u5347\u7ea7\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u7684\u5347\u7ea7\u6216\u8005\u79fb\u690d\u5230\u5176\u5b83\u786c\u4ef6\u5e73\u53f0\u66f4\u5c06\u4e0d\u4f1a\u5bf9\u4e0a\u5c42\u5e94\u7528\u4ea7\u751f\u5f71\u54cd\uff0c\u4ece\u800c\u964d\u4f4e\u4e86\u4ee3\u7801\u7684\u8026\u5408\u6027\u3001\u590d\u6742\u6027\uff0c\u63d0\u9ad8\u4e86\u7cfb\u7edf\u7684\u53ef\u9760\u6027\u548c\u53ef\u79fb\u690d\u6027\u3002 \u8bbe\u5907\u9a71\u52a8\u5c42\u63d0\u4f9b\u786c\u4ef6\u8bbe\u5907\u7684\u9a71\u52a8\u7a0b\u5e8f\uff0c\u4e0e\u786c\u4ef6\u76f4\u63a5\u6253\u4ea4\u9053\u3002\u9a71\u52a8\u8bbe\u5907\u8981\u80fd\u591f\u88ab\u4e0a\u5c42\u5e94\u7528\u4f7f\u7528\uff0c\u9996\u5148\u9700\u8981\u5c06\u81ea\u5df1\u6ce8\u518c\u4e3a\u901a\u7528\u8bbe\u5907\u6216\u8005\u666e\u901a\u8bbe\u5907\u3002","title":"\u8bbe\u5907\u548c\u9a71\u52a8\u6846\u67b6"},{"location":"device/#_3","text":"\u901a\u7528\u8bbe\u5907\u662f\u6307\u5305\u542b\u4e86\u786c\u4ef6\u62bd\u8c61\u5c42\u548c\u8bbe\u5907\u9a71\u52a8\u5c42\u7684 I/O \u8bbe\u5907, \u5176\u4e00\u822c\u4e3a\u5404\u786c\u4ef6\u5e73\u53f0\u6240\u5171\u6709\u7684\u786c\u4ef6\u8bbe\u5907\u3002\u5bf9\u4e8e Pixhawk \u6765\u8bf4\uff0c\u901a\u7528\u8bbe\u5907\u4e00\u822c\u5305\u62ec\u4e32\u53e3\u3001PIN\u3001I2C\u3001SPI\u3001USB\u3001SD \u5361\u3001\u7535\u673a\u3001RC\u3001ADC\u3001\u52a0\u901f\u5ea6\u8ba1\u3001\u9640\u87ba\u4eea\u3001\u78c1\u529b\u8ba1\u3001GPS \u3001\u6c14\u538b\u8ba1\u3001\u5b9a\u65f6\u5668\u548c\u7cfb\u7edf\u65f6\u949f\u7b49\u3002 \u901a\u7528\u8bbe\u5907\u7531\u5e95\u5c42\u9a71\u52a8\u7a0b\u5e8f\u8fdb\u884c\u6ce8\u518c\uff0c\u7136\u540e\u5728\u62bd\u8c61\u5c42\u4e2d\u518d\u6ce8\u518c\u4e3a\u7cfb\u7edf\u8bbe\u5907\u3002\u901a\u7528\u8bbe\u5907\u7684\u64cd\u4f5c\u65b9\u6cd5\u7684\u6620\u5c04\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u5176\u4e2d driver_ops \u4e3a\u786c\u4ef6\u62bd\u8c61\u5c42\u5b9a\u4e49\u7684\u5404\u4e2a\u8bbe\u5907\u9a71\u52a8\u7684\u529f\u80fd\u51fd\u6570 (operation functions)\u3002 \u9a71\u52a8\u7a0b\u5e8f\u9700\u8981\u5b9e\u73b0\u5bf9\u5e94\u7684\u529f\u80fd\u51fd\u6570\uff0c\u5e76\u5c06\u5176\u6ce8\u518c\u4e3a\u5bf9\u5e94\u7684\u901a\u7528\u8bbe\u5907\u3002","title":"\u901a\u7528\u8bbe\u5907"},{"location":"device/#_4","text":"\u666e\u901a\u8bbe\u5907\u662f\u6307\u4e0d\u5305\u542b\u786c\u4ef6\u62bd\u8c61\u5c42\uff0c\u7531\u9a71\u52a8\u5c42\u76f4\u63a5\u5411\u7cfb\u7edf\u6ce8\u518c\u4e3a\u7cfb\u7edf\u8bbe\u5907\u3002\u666e\u901a\u8bbe\u5907\u6ca1\u6709\u4e0e\u4e4b\u5bf9\u5e94\u7684\u786c\u4ef6\u62bd\u8c61\u5c42\u7684\u901a\u7528\u8bbe\u5907\uff0c\u6240\u4ee5\u666e\u901a\u8bbe\u5907\u4e00\u822c\u7528\u4e8e\u67d0\u4e2a\u5d4c\u5165\u5f0f\u5e73\u53f0\u6240\u7279\u6709\u7684\u786c\u4ef6\uff0c\u6bd4\u5982 Pixhawk \u4e0a\u7684\u4e09\u8272 LED \u706f\u3002\u666e\u901a\u8bbe\u5907\u7684\u64cd\u4f5c\u65b9\u6cd5\u7684\u6620\u5c04\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff1a","title":"\u666e\u901a\u8bbe\u5907"},{"location":"device/#_5","text":"\u865a\u62df\u8bbe\u5907\u662f\u4e00\u79cd\u6bd4\u8f83\u7279\u6b8a\u7684\u8bbe\u5907\uff0c\u5177\u6709\u5f88\u5927\u7684\u7075\u6d3b\u6027\u3002\u5408\u7406\u5229\u7528\u597d\u865a\u62df\u8bbe\u5907\uff0c\u53ef\u4ee5\u5927\u5927\u4f18\u5316\u7cfb\u7edf\u67b6\u6784\u5e76\u7b80\u5316\u4e0a\u5c42\u5e94\u7528\u7684\u5f00\u53d1\u590d\u6742\u5ea6\u3002 \u4e0d\u540c\u4e8e\u901a\u7528\u8bbe\u5907\u548c\u666e\u901a\u8bbe\u5907\uff0c\u865a\u62df\u8bbe\u5907\u6784\u5efa\u4e8e\u901a\u7528\u8bbe\u5907\u6216\u8005\u5176\u5b83\u6a21\u5757\u63d0\u4f9b\u7684\u63a5\u53e3\u51fd\u6570\u4e4b\u4e0a\u3002 \u865a\u62df\u8bbe\u5907\u7684\u64cd\u4f5c\u65b9\u6cd5\u7684\u6620\u5c04\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff1a Firmament \u4e2d\u5305\u542b\u4e86\u8bb8\u591a\u7684\u865a\u62df\u8bbe\u5907\uff0c\u6bd4\u5982 mav_console \u8bbe\u5907\u63d0\u4f9b\u4e86\u5c06\u63a7\u5236\u53f0\u6d88\u606f\u5c01\u88c5\u4e3a mavlink \u534f\u8bae\u5305\u8fdb\u884c\u53d1\u9001\u7684\u529f\u80fd\u3002mav_console \u5728 HAL \u5c42\u5c06\u6570\u636e\u5c01\u88c5\u4e3a mavlink \u6570\u636e\u5305\uff08 MAVLINK_MSG_ID_SERIAL_CONTROL \uff09\uff0c \u7136\u540e\u901a\u8fc7 serial \u6216\u8005 usb \u8bbe\u5907\u8fdb\u884c\u6570\u636e\u53d1\u9001\u3002","title":"\u865a\u62df\u8bbe\u5907"},{"location":"device/#io","text":"\u5f53\u8bbe\u5907\u88ab\u6ce8\u518c\u5230\u7cfb\u7edf\u540e\uff0c\u4e0a\u5c42\u5e94\u7528\u5c31\u53ef\u4ee5\u901a\u8fc7 I/O \u8bbe\u5907\u7ba1\u7406\u63a5\u53e3\u6765\u8bbf\u95ee\u8be5\u8bbe\u5907\uff08\u901a\u7528\u8bbe\u5907\uff0c\u666e\u901a\u8bbe\u5907\u6216\u8005\u865a\u62df\u8bbe\u5907\uff09\u3002 \u9996\u5148\u901a\u8fc7\u8bbe\u5907\u540d\u79f0\u6765\u83b7\u53d6\u8bbe\u5907\u53e5\u67c4\uff0c\u8fdb\u800c\u53ef\u4ee5\u64cd\u4f5c\u8bbe\u5907\u3002\u67e5\u627e\u8bbe\u5907\u51fd\u6570\u5982\u4e0b\u6240\u793a\uff1a rt_device_t rt_device_find(const char* name); \u83b7\u5f97\u8bbe\u5907\u8bbe\u5907\u53e5\u67c4\u540e\uff0c\u53ef\u4ee5\u6253\u5f00\u548c\u5173\u95ed\u8bbe\u5907\u3002\u6253\u5f00\u8bbe\u5907\u65f6\uff0c\u4f1a\u68c0\u6d4b\u8bbe\u5907\u662f\u5426\u5df2\u7ecf\u521d\u59cb\u5316\uff0c\u6ca1\u6709\u521d\u59cb\u5316\u5219\u4f1a\u9ed8\u8ba4\u8c03\u7528\u521d\u59cb\u5316\u63a5\u53e3\u521d\u59cb\u5316\u8bbe\u5907\u3002\u901a\u8fc7\u5982\u4e0b\u51fd\u6570\u6253\u5f00\u8bbe\u5907\uff1a rt_err_t rt_device_open(rt_device_t dev, rt_uint16_t oflags); \u4e0a\u5c42\u5e94\u7528\u6253\u5f00\u8bbe\u5907\u5b8c\u6210\u8bfb\u5199\u7b49\u64cd\u4f5c\u540e\uff0c\u5982\u679c\u4e0d\u9700\u8981\u518d\u5bf9\u8bbe\u5907\u8fdb\u884c\u64cd\u4f5c\u5219\u53ef\u4ee5\u5173\u95ed\u8bbe\u5907\uff0c\u8fdb\u800c\u91ca\u653e\u8bbe\u5907\u8d44\u6e90\u3002\u901a\u8fc7\u5982\u4e0b\u51fd\u6570\u5b8c\u6210\uff1a rt_err_t rt_device_close(rt_device_t dev); \u4ece\u8bbe\u5907\u4e2d\u8bfb/\u5199\u6570\u636e\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u51fd\u6570\u5b8c\u6210\uff1a rt_size_t rt_device_read(rt_device_t dev, rt_off_t pos,void* buffer, rt_size_t size); rt_size_t rt_device_write(rt_device_t dev, rt_off_t pos,const void* buffer, rt_size_t size); \u5176\u4e2d pos \u6839\u636e\u4e0d\u540c\u7684\u8bbe\u5907\u6709\u4e0d\u540c\u7684\u610f\u4e49\uff0c\u5177\u4f53\u542b\u4e49\u8bf7\u67e5\u770b\u5bf9\u5e94\u8bbe\u5907\u7684\u5934\u6587\u4ef6\u5b9a\u4e49\u3002 \u901a\u8fc7\u8bbe\u5907\u63a7\u5236\u51fd\u6570\uff0c\u4e0a\u5c42\u53ef\u4ee5\u5bf9\u8bbe\u5907\u8fdb\u884c\u63a7\u5236\uff0c\u901a\u8fc7\u5982\u4e0b\u51fd\u6570\u5b8c\u6210\uff1a rt_err_t rt_device_control(rt_device_t dev, rt_uint8_t cmd, void* arg); \u5176\u4e2d cmd \u6839\u636e\u4e0d\u540c\u7684\u8bbe\u5907\u6709\u4e0d\u540c\u7684\u610f\u4e49\uff0c\u5177\u4f53\u542b\u4e49\u8bf7\u67e5\u770b\u5bf9\u5e94\u8bbe\u5907\u7684\u5934\u6587\u4ef6\u5b9a\u4e49\u3002","title":"\u8bbf\u95ee I/O \u8bbe\u5907"},{"location":"device/#io_1","text":"\u8981\u6dfb\u52a0\u4e00\u4e2a I/O \u8bbe\u5907\u5230 Firmament\u4e2d\uff0c\u9996\u5148\u8981\u8003\u8651\u8981\u6dfb\u52a0\u8bbe\u5907\u7684\u7c7b\u578b\uff0c\u662f\u901a\u7528\u8bbe\u5907\u3001\u666e\u901a\u8bbe\u5907\u8fd8\u662f\u865a\u62df\u8bbe\u5907\uff1f\u4e0d\u540c\u8bbe\u5907\u7684\u6dfb\u52a0\u65b9\u5f0f\u4f1a\u7565\u6709\u4e0d\u540c\u3002\u8fd9\u91cc\u4ee5\u6dfb\u52a0\u4e00\u4e2a\u52a0\u901f\u5ea6\u8ba1\u6765\u6f14\u793a\u5982\u4f55\u6dfb\u52a0\u8bbe\u5907\u5230\u7cfb\u7edf\u4e2d\u3002 \u56e0\u4e3a\u52a0\u901f\u5ea6\u8ba1\u8bbe\u5907\u4e3a\u5404\u4e2a\u98de\u63a7\u5e73\u53f0\u5171\u6709\u7684\u8bbe\u5907\uff0c\u6240\u4ee5\u53ef\u4ee5\u786e\u5b9a\u5176\u4e3a\u901a\u7528\u8bbe\u5907\u3002Firmament \u5df2\u7ecf\u5b9e\u73b0\u4e86\u52a0\u901f\u5ea6\u8ba1\u786c\u4ef6\u62bd\u8c61\u5c42\u7684\u903b\u8f91 (\u5982\u679c\u6ca1\u6709\u5219\u9700\u8981\u81ea\u5df1\u5b9e\u73b0)\uff0c\u6240\u6709\u53ea\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a\u9a71\u52a8\u7a0b\u5e8f\uff0c\u5e76\u5b9e\u73b0 accel.h \u4e2d\u6240\u5b9a\u4e49\u7684 driver_ops \u9a71\u52a8\u529f\u80fd\u51fd\u6570\uff0c\u7136\u540e\u6ce8\u518c\u4e3a accel \u901a\u7528\u8bbe\u5907\u5373\u53ef\u5b8c\u6210\u8bbe\u5907\u7684\u6dfb\u52a0\u3002 \u52a0\u901f\u5ea6\u8ba1\u7684\u9a71\u52a8\u529f\u80fd\u51fd\u6570\u5b9a\u4e49\u5982\u4e0b\uff1a /* accel driver opeations */ struct accel_ops { rt_err_t (*accel_config)(accel_dev_t accel, const struct accel_configure* cfg); rt_err_t (*accel_control)(accel_dev_t accel, int cmd, void* arg); rt_size_t (*accel_read)(accel_dev_t accel, rt_off_t pos, void* data, rt_size_t size); }; \u9a71\u52a8\u9996\u5148\u9700\u8981\u5b9e\u73b0 accel_config \u51fd\u6570\u6765\u914d\u7f6e\u52a0\u901f\u5ea6\u8ba1\u7684\u53c2\u6570\uff0c\u5176\u4e2d accel_configure \u4e2d\u914d\u7f6e\u53c2\u6570\u5982\u4e0b\uff1a struct accel_configure { rt_uint32_t sample_rate_hz; rt_uint16_t dlpf_freq_hz; rt_uint32_t acc_range_g; }; \u5176\u4e2d sample_rate_hz \u4e3a\u91c7\u6837\u9891\u7387\uff0c dlpf_freq_hz \u4e3a\u786c\u4ef6\u4f4e\u901a\u6ee4\u6ce2\u622a\u81f3\u9891\u7387\uff0c acc_range_g \u4e3a\u52a0\u901f\u5ea6\u7684\u6d4b\u91cf\u8303\u56f4 \u3002 mpu6000.c \u4e2d\u7684\u914d\u7f6e\u51fd\u6570\u5b9e\u73b0\u5982\u4e0b\uff1a static rt_err_t accel_config(accel_dev_t accel, const struct accel_configure* cfg) { rt_err_t ret = RT_EOK; if (cfg == RT_NULL) { return RT_EINVAL; } ret |= _set_accel_range(cfg- acc_range_g); ret |= _set_sample_rate(cfg- sample_rate_hz); ret |= _set_dlpf_filter(cfg- dlpf_freq_hz); accel- config = *cfg; return ret; } \u7b2c\u4e8c\u4e2a\u8981\u5b9e\u73b0\u7684\u51fd\u6570\u662f accel_control \uff0c\u8be5\u51fd\u6570\u53ef\u4ee5\u7528\u6765\u7ed9\u9a71\u52a8\u8bbe\u5907\u4f20\u8f93\u4e00\u4e9b\u6307\u4ee4\u3002\u76ee\u524d accel \u8fd8\u6ca1\u6709\u5b9a\u4e49\u76f8\u5173\u7684\u6307\u4ee4\uff0c\u6240\u4ee5\u9a71\u52a8\u51fd\u6570\u76f4\u63a5\u8fd4\u56de\u6210\u529f\u5373\u53ef: static rt_err_t accel_control(accel_dev_t accel, int cmd, void* arg) { return RT_EOK; } \u6700\u540e\u4e00\u4e2a\u8981\u5b9e\u73b0\u7684\u51fd\u6570\u662f accel_read \uff0c\u8be5\u51fd\u6570\u5176\u7528\u6765\u8bfb\u53d6\u52a0\u901f\u5ea6\u8ba1\u7684\u6570\u636e\u3002\u8fd9\u91cc\u7684\u5b9a\u4e49 pos \u6709\u4e24\u4e2a\uff0c\u5206\u522b\u4e3a\u8bfb\u53d6\u52a0\u901f\u5ea6\u8ba1\u539f\u59cb\u6570\u636e\u548c\u6807\u51c6\u5316\u5355\u4f4d ( m/s 2 ) \u6570\u636e\u3002 /* accel read pos */ #define ACCEL_RD_RAW 1 #define ACCEL_RD_SCALE 2 mpu6000 \u7684\u8bfb\u53d6\u52a0\u901f\u5ea6\u8ba1\u6570\u636e\u51fd\u6570\u5b9e\u73b0\u5982\u4e0b\uff1a static rt_size_t accel_read(accel_dev_t accel, rt_off_t pos, void* data, rt_size_t size) { if (data == RT_NULL) { return 0; } if (pos == ACCEL_RD_RAW) { if (mpu6000_acc_read_raw(((int16_t*)data)) != RT_EOK) { return 0; } } else if (pos == ACCEL_RD_SCALE) { if (mpu6000_acc_read_m_s2(((float*)data)) != RT_EOK) { return 0; } } else { DRV_DBG( accel unknow read pos:%d\\n , pos); return 0; } return size; } \u9a71\u52a8\u7684\u529f\u80fd\u51fd\u6570\u5b9e\u73b0\u540e\uff0c\u5728\u9a71\u52a8\u7684\u521d\u59cb\u5316\u51fd\u6570\u4e2d\u8c03\u7528 hal_accel_register \u51fd\u6570\u5c06\u81ea\u5df1\u6ce8\u518c\u4e3a accel \u8bbe\u5907\uff1a rt_err_t mpu6000_drv_init(char* spi_device_name) { rt_err_t ret = RT_EOK; static struct accel_device accel_dev = { .ops = _accel_ops, .config = ACCEL_CONFIG_DEFAULT, .bus_type = GYRO_SPI_BUS_TYPE }; static struct gyro_device gyro_dev = { .ops = _gyro_ops, .config = GYRO_CONFIG_DEFAULT, .bus_type = GYRO_SPI_BUS_TYPE }; spi_device = rt_device_find(spi_device_name); if (spi_device == RT_NULL) { DRV_DBG( spi device %s not found!\\r\\n , spi_device_name); return RT_EEMPTY; } /* config spi */ { struct rt_spi_configuration cfg; cfg.data_width = 8; cfg.mode = RT_SPI_MODE_3 | RT_SPI_MSB; /* SPI Compatible Modes 3 */ cfg.max_hz = 3000000; struct rt_spi_device* spi_device_t = (struct rt_spi_device*)spi_device; spi_device_t- config.data_width = cfg.data_width; spi_device_t- config.mode = cfg.mode RT_SPI_MODE_MASK; spi_device_t- config.max_hz = cfg.max_hz; ret |= rt_spi_configure(spi_device_t, cfg); } /* driver internal init */ ret |= _init(); /* register gyro hal device */ ret |= hal_gyro_register( gyro_dev, gyro0 , RT_DEVICE_FLAG_RDWR, RT_NULL); /* register accel hal device */ ret |= hal_accel_register( accel_dev, accel0 , RT_DEVICE_FLAG_RDWR, RT_NULL); return ret; } \u5176\u4e2d accel0 \u4e3a\u8bbe\u5907\u540d\u79f0\uff0c\u4e0a\u5c42\u5e94\u7528\u901a\u8fc7\u8be5\u540d\u79f0\u6765\u83b7\u53d6\u8bbe\u5907\u53e5\u67c4\u3002 mpu6000 \u5305\u62ec\u4e00\u4e2a\u9640\u87ba\u4eea\u548c\u4e00\u4e2a\u52a0\u901f\u5ea6\u8ba1\uff0c\u6240\u4ee5\u8fd9\u91cc\u9664\u4e86\u6ce8\u518c\u52a0\u901f\u5ea6\u8ba1\u8bbe\u5907\u5916\uff0c\u8fd8\u6ce8\u518c\u4e86\u4e00\u4e2a\u9640\u87ba\u4eea\u8bbe\u5907\u3002 \u6ce8\u610f\uff1aFirmament \u9ed8\u8ba4\u4f7f\u7528 gyro0 \u548c accel0 \u4f5c\u4e3a\u7cfb\u7edf\u7684\u4e3b IMU\uff0c gyro1 \u548c accel1 \u4f5c\u4e3a\u526f IMU\u3002 \u6240\u4ee5\u5982\u679c\u8981\u4f7f\u7528\u67d0\u4e2a IMU \u8bbe\u5907\u4f5c\u4e3a\u4e3b IMU\uff0c\u5c06\u5176\u6ce8\u518c\u4e3a gyro0 \u548c accel0 \u5373\u53ef\u3002","title":"\u6dfb\u52a0 I/O \u8bbe\u5907"},{"location":"getting_started/","text":"\u5feb\u901f\u4e0a\u624b \u786c\u4ef6\u8fde\u63a5 \u786c\u4ef6\u8fde\u63a5\u5982\u56fe\u6240\u793a: TELEM 2 : \u9ed8\u8ba4\u4f5c\u4e3a\u63a7\u5236\u53f0 Console \u7684\u8f93\u51fa\uff0c\u9ed8\u8ba4\u6ce2\u7279\u7387 57600 \u3002\u5982\u679c\u5728 Mavlink Console \u4e2d\u8f93\u5165\u4efb\u610f\u5b57\u7b26\uff0c\u5219 Console \u5c06\u88ab\u81ea\u52a8\u6620\u5c04\u5230 Mavlink Console \u4e0a\u3002 TELEM 1 : \u9ed8\u8ba4\u4f5c\u4e3a Mavlink \u7684\u8f93\u51fa\u53e3\uff0c\u9ed8\u8ba4\u6ce2\u7279\u7387 57600 \u3002\u5982\u679c USB \u8fde\u63a5\u7684\u8bdd\uff0c\u5219 Mavlink \u5219\u81ea\u52a8\u6362\u5230\u5230 USB \u8bbe\u5907\u4e0a\u8f93\u51fa\u3002 GPS : \u8fde\u63a5GPS\u6a21\u5757\uff0c\u9ed8\u8ba4\u6ce2\u7279\u7387 9600 \u3002 RC : \u8fde\u63a5\u9065\u63a7\u5668\u7684 PPM \u4fe1\u53f7,\u76ee\u524d\u6700\u591a\u652f\u63018\u8defPPM\u4fe1\u53f7\u3002 SB : \u8fde\u63a5\u9065\u63a7\u5668\u7684 SBUS \u4fe1\u53f7\uff0c\u76ee\u524d\u8fd8\u672a\u652f\u6301\u3002 MAIN OUT : \u652f\u6301\u6700\u591a8\u8defPWM\u8f93\u51fa\u4fe1\u53f7 (\u4e5f\u53ef\u6539\u4e3a\u6355\u83b7\u8f93\u5165\u4fe1\u53f7)\u3002 AUX OUT : \u652f\u6301\u6700\u591a6\u8defPWM\u8f93\u51fa\u4fe1\u53f7 (\u4e5f\u53ef\u6539\u4e3a\u6355\u83b7\u8f93\u5165\u4fe1\u53f7)\u3002 \u5176\u5b83 \uff1a\u5176\u5b83\u63a5\u53e3\u6682\u65f6\u8fd8\u672a\u652f\u6301\u3002 \u7f16\u8bd1\u73af\u5883 \u652f\u6301\u5728Windows/Linux/Mac\u73af\u5883\u4e0b\u7f16\u8bd1\uff0c\u9700\u8981\u7528\u5230\u7684\u5de5\u5177\u94fe\u5982\u4e0b\uff1a \u7f16\u8bd1\u5668 : arm-none-eabi- toolchain (\u63a8\u8350\u7248\u672c: 7-2018-q2-update \uff0c\u5176\u5b83\u7248\u672c\u672a\u6d4b\u8bd5) \u7f16\u8bd1\u5de5\u5177 \uff1a Scons (\u63a8\u8350\u7248\u672c\uff1a v2.3.6 )\uff0c\u540c\u65f6 Scons \u9700\u8981\u7528\u5230 python2.7.x \u7f16\u8f91\u5668 \uff1a\u63a8\u8350 VS Code \u3002\u4f7f\u7528 VS Code \u6253\u5f00 FMT_Firmware/fmt_fmu \u6216\u8005 FMT_Firmware/fmt_io \u76ee\u5f55\u5373\u53ef\u6253\u5f00\u9879\u76ee\u5de5\u7a0b\u3002 USB\u9a71\u52a8 \uff1a\u4e0b\u8f7d STM32 USB\u9a71\u52a8 (For windows) \u7f16\u8bd1\u56fa\u4ef6 \u5728\u914d\u7f6e\u597d\u4e86\u7f16\u8bd1\u73af\u5883\u540e\uff0c\u9996\u5148\u9700\u8981\u914d\u7f6e\u7cfb\u7edf\u7684\u73af\u5883\u53d8\u91cf\u3002\u4ee5Windows\u7cfb\u7edf\u4e3a\u4f8b\uff0c\u8fdb\u5165 Environment Variables \u754c\u9762\uff0c\u6dfb\u52a0\u4e00\u4e2a RTT_EXEC_PATH \u7684\u73af\u5883\u53d8\u91cf\uff0c\u5e76\u4e14\u5c06\u5176 Value \u8bbe\u7f6e\u4e3a arm-none-eabi- toolchain \u7684\u4e0b\u8f7d\u5730\u5740\uff0c\u6bd4\u5982 D:\\gcc-arm-none-eabi-7-2018-q2-update-win32\\bin \u3002 \u540c\u65f6\uff0c\u5728\u547d\u4ee4\u884c\u7a97\u53e3\u4e2d\u8f93\u5165 scons --version \u548c python --version \u67e5\u770b\u7248\u672c\u662f\u5426\u6b63\u5e38\u3002\u5b8c\u6210\u4ee5\u4e0a\u6b65\u9aa4\u540e\uff0c\u53ef\u4ee5\u5f00\u59cb\u7f16\u8bd1FMT\u56fa\u4ef6\u3002 \u7f16\u8bd1 FMT FMU \u56fa\u4ef6 cd FMT_Firmware/fmt_fmu/target/pixhawk scons -j4 \u7f16\u8bd1\u5b8c\u6210\u540e\uff0c\u56fa\u4ef6 fmt_fmu.bin \u5c06\u751f\u6210\u5728 build \u76ee\u5f55\u4e0b\u3002 \u7f16\u8bd1 FMT IO \u56fa\u4ef6 cd FMT_Firmware/fmt_io/project scons -j4 \u7f16\u8bd1\u5b8c\u6210\u540e\uff0c\u56fa\u4ef6 fmt_io.bin \u5c06\u751f\u6210\u5728 build \u76ee\u5f55\u4e0b\u3002 \u56fa\u4ef6\u4e0b\u8f7d FMT\u5305\u542bFMU (Flight Management Uinit) \u56fa\u4ef6\u548cIO (Input/Output)\u56fa\u4ef6\uff0c\u9700\u8981\u5206\u522b\u8fdb\u884c\u4e0b\u8f7d\u3002FMT\u4f7f\u7528pixhawk\u5185\u7f6e\u7684bootloader\u8fdb\u884c\u56fa\u4ef6\u7684\u4e0b\u8f7d\uff0c\u6240\u4ee5\u5728\u4e0b\u8f7d\u4e86FMT\u7684\u56fa\u4ef6\u540e\uff0c\u4e5f\u80fd\u591f\u5f88\u65b9\u4fbf\u7684\u5237\u56dePX4\u6216\u8005APM\u7684\u56fa\u4ef6\u3002 \u4e0b\u8f7dFMT FMU\u56fa\u4ef6 \u76ee\u524d\u6709\u4e24\u79cd\u65b9\u5f0f\u4e0b\u8f7dFMU\u56fa\u4ef6: \u901a\u8fc7uploader.py\u811a\u672c\u4e0b\u8f7d\u6216\u8005\u901a\u8fc7QGroundControl (QGC)\u4e0b\u8f7d\u3002 uploader.py\u811a\u672c\uff1a \u5c06\u98de\u63a7\u8fde\u63a5usb\u7ebf\u63d2\u5165PC\uff0c\u7136\u540e\u5728 fmt_fmu/target/pixhawk \u76ee\u5f55\u4e2d\u6267\u884c python uploader.py \u3002\u811a\u672c\u5c06\u81ea\u52a8\u627e\u5230\u5bf9\u5e94\u7aef\u53e3\u5e76\u5f00\u59cb\u4e0b\u8f7d\u4f4d\u4e8e build \u76ee\u5f55\u4e0b\u7684 fmt_fmu.bin \u56fa\u4ef6\u3002 QGC\u5730\u9762\u7ad9\uff1a \u8fdb\u5165 Firmware Setup \u9875\u9762\uff0c\u7136\u540e\u4f7f\u7528usb\u7ebf\u8fde\u63a5\u98de\u63a7\u548cPC\u3002\u8fd9\u65f6\u4f1a\u5f39\u51fa\u9009\u62e9\u56fa\u4ef6\u7684\u754c\u9762\uff0c\u9009\u62e9 Advanced Settings \uff0c\u7136\u540e\u5728\u4e0b\u62c9\u6846\u4e2d\u9009\u62e9 Custom firmware file \uff0c\u7136\u540e\u9009\u62e9\u7f16\u8bd1\u7684 fmt_fmu.bin \u56fa\u4ef6\u5373\u53ef\u5f00\u59cb\u4e0b\u8f7d\u3002 \u56fa\u4ef6\u4e0b\u8f7d\u6210\u529f\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e32\u53e3( TELEM 2, baudrate: 57600 )\u6216\u8005QGC\u7684 Mavlink Console \u8fde\u63a5\u63a7\u5236\u53f0(console)\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u4e3a\u98de\u63a7\u5f00\u673a\u6253\u5370\u7684\u4fe1\u606f\uff1a \u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u5728VS Code\u4e2d\u8fd0\u884c fmt_fmu/target/pixhawk/mavlink_shell.py \u811a\u672c\u6765\u8fde\u63a5console\u3002 \u4e0b\u8f7dFMT IO\u56fa\u4ef6 \u534f\u5904\u7406\u5668IO\u7684\u56fa\u4ef6\u901a\u8fc7FMU\u7684\u6587\u4ef6\u7cfb\u7edf\u8fdb\u884c\u4e0b\u8f7d\u3002\u9996\u5148\u9700\u8981\u8fde\u63a5\u5c06\u7f16\u8bd1\u7684 fmt_io.bin \u56fa\u4ef6\u653e\u5230sd\u5361\u4e0a\uff0c\u53ef\u4ee5\u901a\u8fc7\u8bfb\u5361\u5668\u62f7\u8d1d\u3002\u800c\u66f4\u65b9\u4fbf\u7684\u65b9\u5f0f\u662f\u901a\u8fc7QGC\u7684FTP\u529f\u80fd\u8fdb\u884c\u6587\u4ef6\u4e0a\u4f20 ( Widget- Onboard Files )\u3002 \u6587\u4ef6\u4e0a\u4f20\u540e\uff0c\u8fdb\u5165\u63a7\u5236\u53f0(console)\uff0c\u8f93\u5165\u5982\u4e0b\u6307\u4ee4: fmtio upload $path/fmt_io.bin \u5176\u4e2d $path \u4e3a\u5b58\u653e fmt_io.bin \u7684\u8def\u5f84\uff0c\u5982\u679c\u662f\u653e\u5728\u6839\u76ee\u5f55\uff0c\u5219\u53ef\u4ee5\u7701\u7565\uff0c\u76f4\u63a5\u8f93\u5165 uploader \u5373\u53ef\u3002 \u6ce8\u610f\uff1a \u5982\u679c\u662f\u7b2c\u4e00\u6b21\u4e0b\u8f7dIO\u56fa\u4ef6\uff0c\u5728\u8f93\u5165 upload \u6307\u4ee4\u540e\uff0c\u9700\u8981\u624b\u52a8\u6309\u4e00\u4e0b\u4f4d\u4e8e Pixhawk \u53f3\u4fa7\u7684IO\u590d\u4f4d\u6309\u94ae\uff0c\u4f7f\u5f97IO\u8fdb\u5165bootloader\u7a0b\u5e8f\u3002 \u4e0b\u8f7d\u5b8c\u6210\u540e\uff0c\u5728\u63a7\u5236\u53f0\u8f93\u5165 fmtio hello \u6307\u4ee4\uff0c\u5982\u679cIO\u56fa\u4ef6\u66f4\u65b0\u6210\u529f\uff0c\u5e94\u8be5\u770b\u5230IO\u53d1\u6765\u7684\u5982\u4e0b\u6d88\u606f\uff1a msh / fmtio hello msh / [IO]:Hello, this is FMT IO! \u5237\u56dePX4\u56fa\u4ef6 \u9996\u5148\u540c\u6837\u5229\u7528 QGC \u5730\u9762\u7ad9\u4e0b\u8f7dPX4/APM\u7684\u56fa\u4ef6\u5230FMU\u3002 PX4\u5728\u4e0a\u7535\u4f1a\u68c0\u67e5IO\u7684\u56fa\u4ef6\u7248\u672c\u5e76\u8fdb\u884c\u66f4\u65b0\u3002\u4f46\u662f\u7531\u4e8e\u76ee\u524dFMT IO\u8fd8\u4e0d\u8bc6\u522bPX4\u7684\u91cd\u542f\u6307\u4ee4\uff0c\u6545\u65e0\u6cd5\u91cd\u542f\u8fdb\u5165bootloader\u6a21\u5f0f\uff0c\u6240\u4ee5\u9700\u8981\u624b\u52a8\u8fdb\u884cIO\u56fa\u4ef6\u7684\u4e0b\u8f7d\uff0c\u76ee\u524d\u6709\u4e24\u79cd\u65b9\u6cd5\uff1a \u6309\u4f4f\u5b89\u5168\u5f00\u5173 (safety switch)\uff0c \u7136\u540e\u7ed9\u98de\u63a7\u4e0a\u7535\uff0c\u8fd9\u65f6\u5019IO\u5c06\u4f1a\u505c\u7559\u5728bootloader\u4e2d\uff0c\u8fd9\u65f6\u5019\u518d\u6309\u7167\u4e4b\u524d\u7684\u6b65\u9aa4\u5237\u65b0PX4/APM\u7684\u56fa\u4ef6\u5230FMU\u3002\u5f53FMU\u56fa\u4ef6\u66f4\u65b0\u6210\u529f\u540e\uff0cIO\u56fa\u4ef6\u4e5f\u5c06\u81ea\u52a8\u8fdb\u884c\u66f4\u65b0\u3002 \u5728\u5237\u4e86FMU\u56fa\u4ef6\u540e\uff0c\u8fdb\u5165nsh\u7684\u63a7\u5236\u53f0\uff0c\u8f93\u5165\u6307\u4ee4 px4io forceupdate 14662 /etc/extras/px4_io-v2_default.bin \uff0c\u5728\u8f93\u5165\u5b8c\u6307\u4ee4\u540e\uff0c\u7acb\u9a6c\u6309\u4e0bIO\u7684\u590d\u4f4d\u952e\uff0c\u5219\u53ef\u4ee5\u5f00\u59cbIO\u56fa\u4ef6\u7684\u70e7\u5199\u3002 \u4ee3\u7801\u8c03\u8bd5 FMT\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u8c03\u8bd5\u624b\u6bb5\uff0c\u5e38\u7528\u7684\u6bd4\u5982\u901a\u8fc7console\u6253\u5370\uff0clog\u65e5\u5fd7\u8bb0\u5f55\u4ee5\u53cajtag\u8fde\u63a5\u8fdb\u884c\u5355\u72ec\u8c03\u8bd5\u3002 Console\u6253\u5370 \u5728FMU\u4e2d\u53ef\u4ee5\u8c03\u7528 console_printf() \u51fd\u6570\u8fdb\u884c\u6253\u5370\uff0c\u7528\u6cd5\u7c7b\u4f3c printf() \u3002\u4fe1\u606f\u5c06\u88ab\u6253\u5370\u663e\u793a\u5728 console \u8bbe\u5907\u4e0a\uff0c\u652f\u6301\u4e2d\u65ad\u4e0a\u4e0b\u6587\u4e2d\u6253\u5370\u3002 ULOG\u65e5\u5fd7 ULOG\u4e3art-thread\u63d0\u4f9b\u7684\u6587\u5b57\u65e5\u5fd7\u7cfb\u7edf\uff0c\u652f\u6301\u4e0d\u540clevel\u7b49\u7ea7\u7684\u65e5\u5fd7\u4fe1\u606f\u8f93\u51fa\uff0c\u6bd4\u5982 Error , Warning , Info , Debug \u7b49\uff0c\u5bf9\u5e94\u7684\u51fd\u6570\u63a5\u53e3\u4e3a\uff1a ulog_e(TAG, ...) // Error ulog_w(TAG, ...) // Warning ulog_i(TAG, ...) // Info ulog_d(TAG, ...) // Debug FMT\u652f\u6301\u5c06ulog\u65e5\u5fd7\u8f93\u51fa\u5230\u591a\u4e2a\u540e\u7aef\uff0c\u6bd4\u5982 console \u548c file system \u3002\u6bd4\u5982\u8fd9\u6761\u4ee3\u7801 ulog_e( Test , Hello, this is %s , FMT ); \u5c06\u5728 console \u6253\u5370\u5982\u4e0b\u4fe1\u606f\uff0c\u5e76\u4e14\u8fd9\u6761\u4fe1\u606f\u5c06\u88ab\u8bb0\u5f55\u5230 log/session_x/ulog.txt \u4e2d [1770] E/Test: Hello, this is FMT JTAG\u8c03\u8bd5 TO BE ADD","title":"\u5feb\u901f\u4e0a\u624b"},{"location":"getting_started/#_1","text":"","title":"\u5feb\u901f\u4e0a\u624b"},{"location":"getting_started/#_2","text":"\u786c\u4ef6\u8fde\u63a5\u5982\u56fe\u6240\u793a: TELEM 2 : \u9ed8\u8ba4\u4f5c\u4e3a\u63a7\u5236\u53f0 Console \u7684\u8f93\u51fa\uff0c\u9ed8\u8ba4\u6ce2\u7279\u7387 57600 \u3002\u5982\u679c\u5728 Mavlink Console \u4e2d\u8f93\u5165\u4efb\u610f\u5b57\u7b26\uff0c\u5219 Console \u5c06\u88ab\u81ea\u52a8\u6620\u5c04\u5230 Mavlink Console \u4e0a\u3002 TELEM 1 : \u9ed8\u8ba4\u4f5c\u4e3a Mavlink \u7684\u8f93\u51fa\u53e3\uff0c\u9ed8\u8ba4\u6ce2\u7279\u7387 57600 \u3002\u5982\u679c USB \u8fde\u63a5\u7684\u8bdd\uff0c\u5219 Mavlink \u5219\u81ea\u52a8\u6362\u5230\u5230 USB \u8bbe\u5907\u4e0a\u8f93\u51fa\u3002 GPS : \u8fde\u63a5GPS\u6a21\u5757\uff0c\u9ed8\u8ba4\u6ce2\u7279\u7387 9600 \u3002 RC : \u8fde\u63a5\u9065\u63a7\u5668\u7684 PPM \u4fe1\u53f7,\u76ee\u524d\u6700\u591a\u652f\u63018\u8defPPM\u4fe1\u53f7\u3002 SB : \u8fde\u63a5\u9065\u63a7\u5668\u7684 SBUS \u4fe1\u53f7\uff0c\u76ee\u524d\u8fd8\u672a\u652f\u6301\u3002 MAIN OUT : \u652f\u6301\u6700\u591a8\u8defPWM\u8f93\u51fa\u4fe1\u53f7 (\u4e5f\u53ef\u6539\u4e3a\u6355\u83b7\u8f93\u5165\u4fe1\u53f7)\u3002 AUX OUT : \u652f\u6301\u6700\u591a6\u8defPWM\u8f93\u51fa\u4fe1\u53f7 (\u4e5f\u53ef\u6539\u4e3a\u6355\u83b7\u8f93\u5165\u4fe1\u53f7)\u3002 \u5176\u5b83 \uff1a\u5176\u5b83\u63a5\u53e3\u6682\u65f6\u8fd8\u672a\u652f\u6301\u3002","title":"\u786c\u4ef6\u8fde\u63a5"},{"location":"getting_started/#_3","text":"\u652f\u6301\u5728Windows/Linux/Mac\u73af\u5883\u4e0b\u7f16\u8bd1\uff0c\u9700\u8981\u7528\u5230\u7684\u5de5\u5177\u94fe\u5982\u4e0b\uff1a \u7f16\u8bd1\u5668 : arm-none-eabi- toolchain (\u63a8\u8350\u7248\u672c: 7-2018-q2-update \uff0c\u5176\u5b83\u7248\u672c\u672a\u6d4b\u8bd5) \u7f16\u8bd1\u5de5\u5177 \uff1a Scons (\u63a8\u8350\u7248\u672c\uff1a v2.3.6 )\uff0c\u540c\u65f6 Scons \u9700\u8981\u7528\u5230 python2.7.x \u7f16\u8f91\u5668 \uff1a\u63a8\u8350 VS Code \u3002\u4f7f\u7528 VS Code \u6253\u5f00 FMT_Firmware/fmt_fmu \u6216\u8005 FMT_Firmware/fmt_io \u76ee\u5f55\u5373\u53ef\u6253\u5f00\u9879\u76ee\u5de5\u7a0b\u3002 USB\u9a71\u52a8 \uff1a\u4e0b\u8f7d STM32 USB\u9a71\u52a8 (For windows)","title":"\u7f16\u8bd1\u73af\u5883"},{"location":"getting_started/#_4","text":"\u5728\u914d\u7f6e\u597d\u4e86\u7f16\u8bd1\u73af\u5883\u540e\uff0c\u9996\u5148\u9700\u8981\u914d\u7f6e\u7cfb\u7edf\u7684\u73af\u5883\u53d8\u91cf\u3002\u4ee5Windows\u7cfb\u7edf\u4e3a\u4f8b\uff0c\u8fdb\u5165 Environment Variables \u754c\u9762\uff0c\u6dfb\u52a0\u4e00\u4e2a RTT_EXEC_PATH \u7684\u73af\u5883\u53d8\u91cf\uff0c\u5e76\u4e14\u5c06\u5176 Value \u8bbe\u7f6e\u4e3a arm-none-eabi- toolchain \u7684\u4e0b\u8f7d\u5730\u5740\uff0c\u6bd4\u5982 D:\\gcc-arm-none-eabi-7-2018-q2-update-win32\\bin \u3002 \u540c\u65f6\uff0c\u5728\u547d\u4ee4\u884c\u7a97\u53e3\u4e2d\u8f93\u5165 scons --version \u548c python --version \u67e5\u770b\u7248\u672c\u662f\u5426\u6b63\u5e38\u3002\u5b8c\u6210\u4ee5\u4e0a\u6b65\u9aa4\u540e\uff0c\u53ef\u4ee5\u5f00\u59cb\u7f16\u8bd1FMT\u56fa\u4ef6\u3002","title":"\u7f16\u8bd1\u56fa\u4ef6"},{"location":"getting_started/#fmt-fmu","text":"cd FMT_Firmware/fmt_fmu/target/pixhawk scons -j4 \u7f16\u8bd1\u5b8c\u6210\u540e\uff0c\u56fa\u4ef6 fmt_fmu.bin \u5c06\u751f\u6210\u5728 build \u76ee\u5f55\u4e0b\u3002","title":"\u7f16\u8bd1FMT FMU\u56fa\u4ef6"},{"location":"getting_started/#fmt-io","text":"cd FMT_Firmware/fmt_io/project scons -j4 \u7f16\u8bd1\u5b8c\u6210\u540e\uff0c\u56fa\u4ef6 fmt_io.bin \u5c06\u751f\u6210\u5728 build \u76ee\u5f55\u4e0b\u3002","title":"\u7f16\u8bd1FMT IO\u56fa\u4ef6"},{"location":"getting_started/#_5","text":"FMT\u5305\u542bFMU (Flight Management Uinit) \u56fa\u4ef6\u548cIO (Input/Output)\u56fa\u4ef6\uff0c\u9700\u8981\u5206\u522b\u8fdb\u884c\u4e0b\u8f7d\u3002FMT\u4f7f\u7528pixhawk\u5185\u7f6e\u7684bootloader\u8fdb\u884c\u56fa\u4ef6\u7684\u4e0b\u8f7d\uff0c\u6240\u4ee5\u5728\u4e0b\u8f7d\u4e86FMT\u7684\u56fa\u4ef6\u540e\uff0c\u4e5f\u80fd\u591f\u5f88\u65b9\u4fbf\u7684\u5237\u56dePX4\u6216\u8005APM\u7684\u56fa\u4ef6\u3002","title":"\u56fa\u4ef6\u4e0b\u8f7d"},{"location":"getting_started/#fmt-fmu_1","text":"\u76ee\u524d\u6709\u4e24\u79cd\u65b9\u5f0f\u4e0b\u8f7dFMU\u56fa\u4ef6: \u901a\u8fc7uploader.py\u811a\u672c\u4e0b\u8f7d\u6216\u8005\u901a\u8fc7QGroundControl (QGC)\u4e0b\u8f7d\u3002 uploader.py\u811a\u672c\uff1a \u5c06\u98de\u63a7\u8fde\u63a5usb\u7ebf\u63d2\u5165PC\uff0c\u7136\u540e\u5728 fmt_fmu/target/pixhawk \u76ee\u5f55\u4e2d\u6267\u884c python uploader.py \u3002\u811a\u672c\u5c06\u81ea\u52a8\u627e\u5230\u5bf9\u5e94\u7aef\u53e3\u5e76\u5f00\u59cb\u4e0b\u8f7d\u4f4d\u4e8e build \u76ee\u5f55\u4e0b\u7684 fmt_fmu.bin \u56fa\u4ef6\u3002 QGC\u5730\u9762\u7ad9\uff1a \u8fdb\u5165 Firmware Setup \u9875\u9762\uff0c\u7136\u540e\u4f7f\u7528usb\u7ebf\u8fde\u63a5\u98de\u63a7\u548cPC\u3002\u8fd9\u65f6\u4f1a\u5f39\u51fa\u9009\u62e9\u56fa\u4ef6\u7684\u754c\u9762\uff0c\u9009\u62e9 Advanced Settings \uff0c\u7136\u540e\u5728\u4e0b\u62c9\u6846\u4e2d\u9009\u62e9 Custom firmware file \uff0c\u7136\u540e\u9009\u62e9\u7f16\u8bd1\u7684 fmt_fmu.bin \u56fa\u4ef6\u5373\u53ef\u5f00\u59cb\u4e0b\u8f7d\u3002 \u56fa\u4ef6\u4e0b\u8f7d\u6210\u529f\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e32\u53e3( TELEM 2, baudrate: 57600 )\u6216\u8005QGC\u7684 Mavlink Console \u8fde\u63a5\u63a7\u5236\u53f0(console)\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u4e3a\u98de\u63a7\u5f00\u673a\u6253\u5370\u7684\u4fe1\u606f\uff1a \u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u5728VS Code\u4e2d\u8fd0\u884c fmt_fmu/target/pixhawk/mavlink_shell.py \u811a\u672c\u6765\u8fde\u63a5console\u3002","title":"\u4e0b\u8f7dFMT FMU\u56fa\u4ef6"},{"location":"getting_started/#fmt-io_1","text":"\u534f\u5904\u7406\u5668IO\u7684\u56fa\u4ef6\u901a\u8fc7FMU\u7684\u6587\u4ef6\u7cfb\u7edf\u8fdb\u884c\u4e0b\u8f7d\u3002\u9996\u5148\u9700\u8981\u8fde\u63a5\u5c06\u7f16\u8bd1\u7684 fmt_io.bin \u56fa\u4ef6\u653e\u5230sd\u5361\u4e0a\uff0c\u53ef\u4ee5\u901a\u8fc7\u8bfb\u5361\u5668\u62f7\u8d1d\u3002\u800c\u66f4\u65b9\u4fbf\u7684\u65b9\u5f0f\u662f\u901a\u8fc7QGC\u7684FTP\u529f\u80fd\u8fdb\u884c\u6587\u4ef6\u4e0a\u4f20 ( Widget- Onboard Files )\u3002 \u6587\u4ef6\u4e0a\u4f20\u540e\uff0c\u8fdb\u5165\u63a7\u5236\u53f0(console)\uff0c\u8f93\u5165\u5982\u4e0b\u6307\u4ee4: fmtio upload $path/fmt_io.bin \u5176\u4e2d $path \u4e3a\u5b58\u653e fmt_io.bin \u7684\u8def\u5f84\uff0c\u5982\u679c\u662f\u653e\u5728\u6839\u76ee\u5f55\uff0c\u5219\u53ef\u4ee5\u7701\u7565\uff0c\u76f4\u63a5\u8f93\u5165 uploader \u5373\u53ef\u3002 \u6ce8\u610f\uff1a \u5982\u679c\u662f\u7b2c\u4e00\u6b21\u4e0b\u8f7dIO\u56fa\u4ef6\uff0c\u5728\u8f93\u5165 upload \u6307\u4ee4\u540e\uff0c\u9700\u8981\u624b\u52a8\u6309\u4e00\u4e0b\u4f4d\u4e8e Pixhawk \u53f3\u4fa7\u7684IO\u590d\u4f4d\u6309\u94ae\uff0c\u4f7f\u5f97IO\u8fdb\u5165bootloader\u7a0b\u5e8f\u3002 \u4e0b\u8f7d\u5b8c\u6210\u540e\uff0c\u5728\u63a7\u5236\u53f0\u8f93\u5165 fmtio hello \u6307\u4ee4\uff0c\u5982\u679cIO\u56fa\u4ef6\u66f4\u65b0\u6210\u529f\uff0c\u5e94\u8be5\u770b\u5230IO\u53d1\u6765\u7684\u5982\u4e0b\u6d88\u606f\uff1a msh / fmtio hello msh / [IO]:Hello, this is FMT IO!","title":"\u4e0b\u8f7dFMT IO\u56fa\u4ef6"},{"location":"getting_started/#px4","text":"\u9996\u5148\u540c\u6837\u5229\u7528 QGC \u5730\u9762\u7ad9\u4e0b\u8f7dPX4/APM\u7684\u56fa\u4ef6\u5230FMU\u3002 PX4\u5728\u4e0a\u7535\u4f1a\u68c0\u67e5IO\u7684\u56fa\u4ef6\u7248\u672c\u5e76\u8fdb\u884c\u66f4\u65b0\u3002\u4f46\u662f\u7531\u4e8e\u76ee\u524dFMT IO\u8fd8\u4e0d\u8bc6\u522bPX4\u7684\u91cd\u542f\u6307\u4ee4\uff0c\u6545\u65e0\u6cd5\u91cd\u542f\u8fdb\u5165bootloader\u6a21\u5f0f\uff0c\u6240\u4ee5\u9700\u8981\u624b\u52a8\u8fdb\u884cIO\u56fa\u4ef6\u7684\u4e0b\u8f7d\uff0c\u76ee\u524d\u6709\u4e24\u79cd\u65b9\u6cd5\uff1a \u6309\u4f4f\u5b89\u5168\u5f00\u5173 (safety switch)\uff0c \u7136\u540e\u7ed9\u98de\u63a7\u4e0a\u7535\uff0c\u8fd9\u65f6\u5019IO\u5c06\u4f1a\u505c\u7559\u5728bootloader\u4e2d\uff0c\u8fd9\u65f6\u5019\u518d\u6309\u7167\u4e4b\u524d\u7684\u6b65\u9aa4\u5237\u65b0PX4/APM\u7684\u56fa\u4ef6\u5230FMU\u3002\u5f53FMU\u56fa\u4ef6\u66f4\u65b0\u6210\u529f\u540e\uff0cIO\u56fa\u4ef6\u4e5f\u5c06\u81ea\u52a8\u8fdb\u884c\u66f4\u65b0\u3002 \u5728\u5237\u4e86FMU\u56fa\u4ef6\u540e\uff0c\u8fdb\u5165nsh\u7684\u63a7\u5236\u53f0\uff0c\u8f93\u5165\u6307\u4ee4 px4io forceupdate 14662 /etc/extras/px4_io-v2_default.bin \uff0c\u5728\u8f93\u5165\u5b8c\u6307\u4ee4\u540e\uff0c\u7acb\u9a6c\u6309\u4e0bIO\u7684\u590d\u4f4d\u952e\uff0c\u5219\u53ef\u4ee5\u5f00\u59cbIO\u56fa\u4ef6\u7684\u70e7\u5199\u3002","title":"\u5237\u56dePX4\u56fa\u4ef6"},{"location":"getting_started/#_6","text":"FMT\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u8c03\u8bd5\u624b\u6bb5\uff0c\u5e38\u7528\u7684\u6bd4\u5982\u901a\u8fc7console\u6253\u5370\uff0clog\u65e5\u5fd7\u8bb0\u5f55\u4ee5\u53cajtag\u8fde\u63a5\u8fdb\u884c\u5355\u72ec\u8c03\u8bd5\u3002","title":"\u4ee3\u7801\u8c03\u8bd5"},{"location":"getting_started/#console","text":"\u5728FMU\u4e2d\u53ef\u4ee5\u8c03\u7528 console_printf() \u51fd\u6570\u8fdb\u884c\u6253\u5370\uff0c\u7528\u6cd5\u7c7b\u4f3c printf() \u3002\u4fe1\u606f\u5c06\u88ab\u6253\u5370\u663e\u793a\u5728 console \u8bbe\u5907\u4e0a\uff0c\u652f\u6301\u4e2d\u65ad\u4e0a\u4e0b\u6587\u4e2d\u6253\u5370\u3002","title":"Console\u6253\u5370"},{"location":"getting_started/#ulog","text":"ULOG\u4e3art-thread\u63d0\u4f9b\u7684\u6587\u5b57\u65e5\u5fd7\u7cfb\u7edf\uff0c\u652f\u6301\u4e0d\u540clevel\u7b49\u7ea7\u7684\u65e5\u5fd7\u4fe1\u606f\u8f93\u51fa\uff0c\u6bd4\u5982 Error , Warning , Info , Debug \u7b49\uff0c\u5bf9\u5e94\u7684\u51fd\u6570\u63a5\u53e3\u4e3a\uff1a ulog_e(TAG, ...) // Error ulog_w(TAG, ...) // Warning ulog_i(TAG, ...) // Info ulog_d(TAG, ...) // Debug FMT\u652f\u6301\u5c06ulog\u65e5\u5fd7\u8f93\u51fa\u5230\u591a\u4e2a\u540e\u7aef\uff0c\u6bd4\u5982 console \u548c file system \u3002\u6bd4\u5982\u8fd9\u6761\u4ee3\u7801 ulog_e( Test , Hello, this is %s , FMT ); \u5c06\u5728 console \u6253\u5370\u5982\u4e0b\u4fe1\u606f\uff0c\u5e76\u4e14\u8fd9\u6761\u4fe1\u606f\u5c06\u88ab\u8bb0\u5f55\u5230 log/session_x/ulog.txt \u4e2d [1770] E/Test: Hello, this is FMT","title":"ULOG\u65e5\u5fd7"},{"location":"getting_started/#jtag","text":"TO BE ADD","title":"JTAG\u8c03\u8bd5"},{"location":"mbd/","text":"","title":"\u6a21\u578b\u5408\u5165"},{"location":"module/","text":"\u7ec4\u4ef6 FMT\u63d0\u4f9b\u4e86\u529f\u80fd\u5f3a\u5927\u7684\u7cfb\u7edf\u7ec4\u4ef6\uff0c\u5404\u79cd\u7ec4\u4ef6\u63d0\u4f9b\u4e86\u7cfb\u7edf\u7684\u5927\u90e8\u5206\u529f\u80fd\u5b9e\u73b0\u3002\u7531\u4e8e\u786c\u4ef6\u865a\u62df\u5c42\uff08HAL\uff09\u7684\u5f15\u5165\uff0c\u5404\u4e2a\u7ec4\u4ef6\u6a21\u5757\u53ef\u4ee5\u505a\u5230\u8ddf\u786c\u4ef6\u5e73\u53f0\u65e0\u5173\uff0c\u652f\u6301\u5728\u5404\u4e2a\u4e0d\u7528\u7684\u786c\u4ef6\u5e73\u53f0\u4e0a\u4f7f\u7528\u3002\u7528\u6237\u53ea\u9700\u8981\u6839\u636e\u5f53\u524d\u7684\u786c\u4ef6\u5e73\u53f0\u8d44\u6e90\u548c\u9a71\u52a8\uff0c\u6765\u51b3\u5b9a\u8981\u4f7f\u7528\u54ea\u4e9b\u7ec4\u4ef6\u6a21\u5757\u3002 \u8fd9\u91cc\uff0c\u6211\u4eec\u5c06\u4ecb\u7ecdFMT\u4e2d\u5e38\u7528\u7684\u4e00\u4e9b\u7ec4\u4ef6\u3002 Console\u63a7\u5236\u53f0 \u63a7\u5236\u53f0\u7ec4\u4ef6\u4f9b\u4e86\u63a7\u5236\u53f0\u7684\u8f93\u5165/\u8f93\u51fa\u529f\u80fd\uff0c\u4e3b\u8981\u7528\u4e8e\u8c03\u8bd5\u4fe1\u606f\u7684\u6253\u5370\u4ee5\u53ca\u547d\u4ee4\u884c\u7684\u4ea4\u4e92\u529f\u80fd\u3002console\u53ef\u4ee5\u88ab\u6620\u5c04\u5230\u4e0d\u540c\u7684\u8bbe\u5907\u4e0a\uff0c\u5982\u4e32\u53e3\uff0cUSB\u7b49\u3002 \u8bbe\u7f6e\u63a7\u5236\u53f0\u8bbe\u5907 \u8c03\u7528\u5982\u4e0b\u51fd\u6570\u6765\u5c06console\u8bbe\u7f6e\u5230 dev_name \u5bf9\u5e94\u7684\u8bbe\u5907\u4e0a\u3002 fmt_err console_set_device(char* dev_name); console\u9ed8\u8ba4\u4f7f\u7528 serial1 \u8bbe\u5907 (TELEM2\u63a5\u53e3)\u3002\u5f53\u8fde\u63a5QGC\u5730\u9762\u7ad9\uff0c\u5e76\u5728 Mavlink Console \u8f93\u5165\u4efb\u610f\u5b57\u7b26\uff0cconsole\u5c06\u88ab\u81ea\u52a8\u5207\u6362\u5230 mav_console \u8bbe\u5907\u4e0a\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002 \u5f53\u524dconsole\u652f\u6301\u7684\u8bbe\u5907\u540d\u79f0\u5982\u4e0b\uff1a - serialx \uff1a \u6807\u51c6\u4e32\u53e3\u8bbe\u5907\uff0c\u9ed8\u8ba4\u4f7f\u7528 serial1 - mav_console : \u57fa\u4e8emavlink\u534f\u8bae\u7684\u865a\u62df\u63a7\u5236\u53f0\u8bbe\u5907\u3002\u5b83\u5c06console\u7684\u8f93\u5165/\u8f93\u51fa\u6570\u636e\u5c01\u88c5\u4e3a MAVLINK_MSG_ID_SERIAL_CONTROL \u7684\u5305\uff0c\u518d\u901a\u8fc7\u4e32\u53e3\u6216\u8005USB\u8fdb\u884c\u53d1\u9001\uff0c\u4ee5\u652f\u6301QGC\u7684 Mavlink Console \u529f\u80fd\u3002 \u7ed1\u5b9aShell\u8bbe\u5907 \u8c03\u7528\u5982\u4e0b\u51fd\u6570\u5c06\u8bbe\u5907\u7ed1\u5b9a\u5230shell\u3002\u7ed1\u5b9a\u540e\uff0c\u5bf9\u5e94\u8bbe\u5907\u7684\u8f93\u5165\u5c06\u9001\u7ed9shell\u8fdb\u884c\u547d\u4ee4\u89e3\u6790\u3002\u82e5\u4f20\u5165\u7684 dev=NULL \uff0c\u5219\u9ed8\u8ba4\u5c06\u5f53\u524d console \u7684\u8bbe\u5907\u7ed1\u5b9a\u5230shell\u3002 fmt_err console_mount_shell(rt_device_t dev); \u63a7\u5236\u53f0\u6253\u5370 \u63a7\u5236\u53f0\u63d0\u4f9b\u4e86\u5982\u4e0b\u4e24\u4e2a\u51fd\u6570\u6765\u6253\u5370\u4fe1\u606f\u5230\u63a7\u5236\u53f0\u8bbe\u5907\u3002 uint32_t console_printf(const char* fmt, ...); uint32_t console_write(const char* content, uint32_t len); \u5e38\u7528\u7684 console_printf() \u7528\u6cd5\u7c7b\u4f3c printf() \uff0c\u652f\u6301\u5404\u79cd\u683c\u5f0f\u5316\u6253\u5370\uff0c\u4e14\u652f\u6301\u4e2d\u65ad\u51fd\u6570\u4e2d\u6253\u5370\uff0c\u5982\uff1a console_printf( %f %d %x\\n , 0.2, 33, 0xFF); console_write() \u51fd\u6570\u5219\u63d0\u4f9b\u4e86\u63a7\u5236\u53f0\u6570\u636e\u76f4\u63a5\u5199\u5165\u7684\u529f\u80fd\uff0c\u5982: console_write(buffer, sizeof(buffer)); uMCN\u6d88\u606f\u8ba2\u9605/\u53d1\u5e03\u6a21\u5757 uMCN (Micro Multi-Communication Node) \u63d0\u4f9b\u57fa\u4e8e\u8ba2\u9605/\u53d1\u5e03\u6a21\u5f0f\u7684\u5b89\u5168\u8de8\u8fdb\u7a0b\u901a\u4fe1\u65b9\u5f0f\uff0c\u4e3aFMT\u5404\u4e2a\u4efb\u52a1\uff0c\u6a21\u5757\u4e4b\u95f4\u8fdb\u884c\u4fe1\u606f\u4ea4\u6362\u7684\u4e3b\u8981\u65b9\u5f0f\u3002 \u5b9a\u4e49\u6d88\u606f \u5b9a\u4e49\u4e00\u6761\u65b0\u7684uMCN\u53ea\u9700\u7b80\u5355\u51e0\u6b65\u3002\u8fd9\u91cc\u4e3e\u4f8b\u8bf4\u660e\u5b9a\u4e49\u4e00\u6761\u65b0\u7684\u6d88\u606f\uff0c\u6d88\u606f\u540d\u79f0\u4e3a my_mcn_topic \uff0c\u6d88\u606f\u5185\u5bb9(topic)\u4e3a\uff1a typedef struct { uint32_t a; float b; int8_t c[4]; } test_data; \u5b9a\u4e49\u6d88\u606f\uff1a\u5728\u6e90\u6587\u4ef6\u5934\u90e8\uff08\u901a\u5e38\u4e3a\u53d1\u5e03\u8be5\u6d88\u606f\u7684\u6e90\u6587\u4ef6\uff09\u6dfb\u52a0\u5982\u4e0b\u5b9a\u4e49\uff1a MCN_DEFINE(my_mcn_topic, sizeof(test_data)); \u8fd9\u91cc my_mcn_topic \u4e3a\u8be5\u6d88\u606f\u7684\u540d\u5b57\uff0c sizeof(test_data) \u4e3a\u6d88\u606f\u5185\u5bb9\u7684\u957f\u5ea6\u3002uMCN\u5bf9\u6d88\u606f\u7684\u957f\u5ea6\u548c\u7c7b\u578b\u6ca1\u6709\u9650\u5236\uff0c\u6240\u4ee5\u7406\u8bba\u4e0a\u53ef\u4ee5\u7528uMCN\u4f20\u9012\u4efb\u610f\u6d88\u606f\u7c7b\u578b\u3002\u540c\u65f6uMCN\u652f\u6301\u4e00\u4e2a\u6d88\u606f\u540c\u65f6\u6709\u591a\u4e2a\u53d1\u5e03\u8005 (publisher) \u548c\u8ba2\u9605\u8005 (subscriber)\u3002\u4f46\u662f\u6ce8\u610f\uff0c\u540c\u4e00\u4e2a\u6d88\u606f(\u540d\u79f0)\u4e0d\u53ef\u88ab\u91cd\u590d\u5b9a\u4e49\uff0c\u4e0d\u7136\u7f16\u8bd1\u65f6\u4f1a\u62a5\u91cd\u590d\u5b9a\u4e49\u7684\u9519\u8bef\u3002 \u6ce8\u518c\u6d88\u606f\uff1a\u8c03\u7528 mcn_advertise \u51fd\u6570\u6ce8\u518c\u8be5\u6761\u6d88\u606f\uff1a mcn_advertise(MCN_ID(my_mcn_topic), _my_mcn_topic_echo); \u8fd9\u91cc my_mcn_topic \u540c\u6837\u4e3a\u8be5\u6d88\u606f\u7684\u540d\u5b57\uff0c MCN_ID \u662f\u4e00\u4e2a\u5b8f\uff0c\u7528\u6765\u6839\u636e\u6d88\u606f\u540d\u79f0\u5f97\u5230 McnHub \u8282\u70b9\u3002 _my_mcn_topic_echo \u4e3a\u8be5\u6761\u6d88\u606f\u7684\u6253\u5370\u51fd\u6570\u3002\u5f53\u5728\u63a7\u5236\u53f0\u8f93\u5165\u6307\u4ee4 mcn echo my_mcn_topic \uff0c\u5c06\u8c03\u7528\u8be5\u6761\u6d88\u606f\u7684\u6253\u5370\u51fd\u6570\u6765\u6253\u5370\u6d88\u606f\u5185\u5bb9\u3002\u7528\u6237\u53ef\u4ee5\u81ea\u5b9a\u4e49\u6253\u5370\u51fd\u6570\u6765\u8f93\u51fa\u60f3\u8981\u6570\u636e\u683c\u5f0f\u3002\u6bd4\u5982 my_mcn_topic \u7684\u6253\u5370\u51fd\u6570\u5982\u4e0b\u8fd9\u6837\u5b9a\u4e49\uff1a static int _my_mcn_topic_echo(void* param) { test_data data; if(mcn_copy_from_hub((McnHub*)param, data) == FMT_EOK){ console_printf( a:%d b:%f c:%c %c %c %c\\n , data.a, data.b, data.c[0], data.c[1], data.c[2], data.c[3]); } return 0; } \u8ba2\u9605\u6d88\u606f \u8ba2\u9605\u8005\u8981\u83b7\u53d6\u6d88\u606f\u7684\u6570\u636e\uff0c\u9996\u5148\u9700\u8981\u5148\u8ba2\u9605\u6d88\u606f\uff0c\u901a\u8fc7 mcn_subscribe \u51fd\u6570\u5b9e\u73b0\u6d88\u606f\u7684\u8ba2\u9605\u3002uMCN\u652f\u6301\u540c\u6b65/\u5f02\u6b65\u6d88\u606f\u8ba2\u9605\uff0c\u540c\u6b65\u65b9\u5f0f\u9700\u8981\u5728\u8ba2\u9605\u6d88\u606f\u7684\u65f6\u5019\u4f20\u5165\u4e00\u4e2a\u6d88\u606f\u53e5\u67c4 event_t \u7528\u4e8e\u7ebf\u7a0b\u540c\u6b65\u3002\u8ba2\u9605\u6d88\u606f\u9075\u5faa\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a \u58f0\u660e\u6d88\u606f\uff1a\u5982\u679c\u662f\u5728\u975e\u5b9a\u4e49\u8be5\u6761\u6d88\u606f\u7684\u6e90\u6587\u4ef6\u4e2d\uff0c\u5219\u9700\u8981\u5148\u7533\u660e\u8be5\u6761\u6d88\u606f\u3002\u6bd4\u5982\u5bf9\u4e8e\u6211\u4eec\u521a\u521a\u5efa\u7acb\u7684 my_mcn_topic \uff0c\u9700\u8981\u5728\u8ba2\u9605\u6d88\u606f\u7684\u6e90\u6587\u4ef6\u5934\u90e8\u6dfb\u52a0 MCN_DECLARE(my_mcn_topic); \u8ba2\u9605\u6d88\u606f\uff1a\u8c03\u7528 mcn_subscribe(McnHub* hub, MCN_EVENT_HANDLE event_t, void (*cb)(void* parameter)) \u51fd\u6570\u6765\u8ba2\u9605\u6d88\u606f\u3002 \u5176\u4e2d cb \u4e3a\u6d88\u606f\u53d1\u5e03\u7684\u56de\u8c03\u51fd\u6570\uff0c\u5728\u6bcf\u6b21\u53d1\u5e03\u6d88\u606f\u65f6\uff0c\u56de\u8c03\u51fd\u6570\u5c06\u88ab\u8c03\u7528 (\u6ce8\u610f: \u56de\u8c03\u51fd\u6570\u5c06\u5728\u53d1\u5e03\u6d88\u606f\u7684\u7ebf\u7a0b\u4e2d\u88ab\u8c03\u7528)\u3002 event_t \u4e3a\u7528\u4e8e\u6d88\u606f\u540c\u6b65\u7684\u4e8b\u4ef6\u53e5\u67c4\uff0c\u8fd9\u91cc\u4e00\u822c\u7528\u7cfb\u7edf\u7684\u4fe1\u53f7\u91cf(semaphore)\u5b9e\u73b0\u3002\u5f53\u8ba2\u9605\u6210\u529f\u540e\uff0c\u51fd\u6570\u5c06\u8fd4\u56de\u6d88\u606f\u8282\u70b9\u53e5\u67c4 McnNode_t \u3002 \u8fd9\u91cc\u5206\u522b\u5bf9\u540c\u6b65/\u5f02\u6b65\u7684\u6d88\u606f\u8ba2\u9605\u4e3e\u4f8b\uff1a \u540c\u6b65\u8ba2\u9605 rt_sem_t event = rt_sem_create( my_event , 0, RT_IPC_FLAG_FIFO); McnNode_t my_nod = mcn_subscribe(MCN_ID(my_mcn_topic), event, NULL); \u5f02\u6b65\u8ba2\u9605 McnNode_t my_nod = mcn_subscribe(MCN_ID(my_mcn_topic), NULL, NULL); \u53d1\u5e03\u6d88\u606f \u53d1\u5e03\u6d88\u606f\u6570\u636e\u4f7f\u7528 mcn_publish \u51fd\u6570\u3002\u6bd4\u5982 mcn_publish(MCN_ID(my_mcn_topic), my_data); \u8fd9\u91cc my_data \u4e3a\u8981\u53d1\u5e03\u7684\u6570\u636e\uff0c\u5176\u7c7b\u578b\u4e3a test_data \u3002\u6ce8\u610f\u8fd9\u91cc\u53d1\u5e03\u6d88\u606f\u7684\u7c7b\u578b\u9700\u8ddf MCN_DEFINE() \u5b9a\u4e49\u7684\u6d88\u606f\u6570\u636e\u7c7b\u578b\u4e00\u81f4\uff0c\u5426\u5219\u5c06\u53d1\u751f\u975e\u9884\u671f\u7684\u540e\u679c\u3002 \u8bfb\u53d6\u6d88\u606f \u5bf9\u4e8e\u540c\u6b65/\u5f02\u6b65\u7684\u6d88\u606f\u8ba2\u9605\u65b9\u5f0f\uff0c\u8bfb\u53d6\u6d88\u606f\u65f6\u4e5f\u5206\u4e3a\u540c\u6b65\u548c\u5f02\u6b65\u65b9\u5f0f\u3002 \u5bf9\u4e8e\u540c\u6b65\u8ba2\u9605\u65b9\u5f0f\uff0c\u8c03\u7528 mcn_poll_sync \u51fd\u6570\u67e5\u8be2\u662f\u5426\u6536\u5230\u65b0\u7684\u6570\u636e\u3002\u5982\u679c\u6ca1\u6709\u65b0\u7684\u6570\u636e\uff0c\u5219\u5c06\u5f53\u524d\u7ebf\u7a0b\u6302\u8d77\uff0c\u76f4\u5230\u6536\u5230\u6570\u636e\u6216\u8005\u7b49\u5f85\u8d85\u65f6\u8fd4\u56de\u3002\u5f53\u6709\u65b0\u7684\u6570\u636e\u5230\u6765\u540e\uff0c\u8c03\u7528 mcn_copy \u51fd\u6570\u8bfb\u53d6\u6570\u636e\u3002\u4f8b\u5982\uff1a test_data read_data; if(mcn_poll_sync(my_nod, RT_WAIT_FOREVER)){ mcn_copy(MCN_ID(my_mcn_topic), my_nod, read_data); } \u8fd9\u91cc my_nod \u4e3a\u6d88\u606f\u8ba2\u9605\u65f6\u8fd4\u56de\u7684\u6d88\u606f\u8282\u70b9\u53e5\u67c4\u3002 \u5982\u679c\u662f\u91c7\u7528\u5f02\u6b65\u8ba2\u9605\u65b9\u5f0f\uff0c\u4f7f\u7528 mcn_poll \u51fd\u6570\u67e5\u8be2\u662f\u5426\u6709\u65b0\u7684\u6570\u636e\uff0c\u8be5\u51fd\u6570\u4f1a\u7acb\u9a6c\u8fd4\u56de\u3002 test_data read_data; if(mcn_poll(my_nod){ mcn_copy(MCN_ID(my_mcn_topic), my_nod, read_data); } uMCN\u6307\u4ee4 FMT\u63d0\u4f9b\u4e86 mcn \u7684\u6307\u4ee4\u6765\u65b9\u4fbf\u67e5\u770b\u5f53\u524d\u7cfb\u7edf\u4e2d\u7684uMCN\u6d88\u606f\uff0c\u6307\u4ee4\u7528\u6cd5\u5982\u4e0b\uff1a msh / mcn --help usage: mcn [OPTION] ACTION [ARGS] Action: list List all uMCN topics. echo Echo a uMCN topic. Option: -c, --cnt Set topic echo count, e.g, -c=10 will echo 10 times. -p, --period Set topic echo period(ms), -p=0 inherits topic period. The default period is 500ms. \u8f93\u5165 mcn list \u5c06\u663e\u793a\u5f53\u524d\u7cfb\u7edf\u6240\u6709\u7684topic msh / mcn list Topic #SUB Freq(Hz) Echo ---------------- ------ ---------- ------ usb_status 1 21.7 true sensor_imu 1 500.0 true sensor_mag 1 100.0 true sensor_baro 1 100.0 true sensor_gps 1 10.0 true ins_output 3 500.0 true fms_output 2 125.0 false control_output 2 250.0 false pilot_cmd 1 0.0 true \u5176\u4e2dTopic\u4e3a\u6d88\u606f\u540d\u79f0\uff0c#SUB\u4e3a\u6d88\u606f\u8ba2\u9605\u8005\u6570\u91cf\uff0cFreq\u4e3a\u6d88\u606f\u53d1\u5e03\u9891\u7387\uff0cEcho\u8868\u793a\u8be5\u6761\u6d88\u606f\u662f\u5426\u63d0\u4f9b\u4e86\u6253\u5370\u51fd\u6570\u3002 \u5bf9\u4e8e\u63d0\u4f9b\u4e86\u6253\u5370\u51fd\u6570\u7684\u6d88\u606f\uff0c\u53ef\u4ee5\u8f93\u5165 mcn echo [topic_name] \u6765\u6253\u5370\u6d88\u606f\u3002\u6bd4\u5982\u8f93\u5165 mcn echo sensor_imu \u5c06\u6253\u5370IMU\u7684\u6570\u636e\uff0c\u6309\u4efb\u610f\u952e\u7ed3\u675f\u3002 msh / mcn echo sensor_imu gyr:-0.000870 -0.002555 -0.003110 acc:0.011333 0.083641 -9.862786 gyr:-0.001118 -0.001791 0.001414 acc:-0.067505 -0.048334 -9.854862 gyr:0.002485 0.005287 0.005572 acc:-0.040842 -0.008587 -9.773908 gyr:-0.000103 -0.001102 0.003385 acc:-0.092554 -0.013108 -9.854832 gyr:-0.001078 0.002592 -0.003151 acc:-0.040336 0.019121 -9.748902 ...... mcn echo \u6307\u4ee4\u652f\u6301 -c \u548c -p \u7684Option\u6765\u8bbe\u7f6e\u6d88\u606f\u6253\u5370\u7684 \u6761\u6570 \u548c \u9891\u7387 \uff0c\u9ed8\u8ba4\u6253\u5370\u9891\u7387500ms\u3002 \u5982\u679c\u8981\u6253\u537010\u6761\u6d88\u606f\uff0c\u6253\u5370\u9891\u7387\u4e3a100ms\uff0c\u53ef\u4ee5\u8f93\u5165 mcn echo -c=10 -p=100 sensor_mag \u3002 Param\u53c2\u6570\u6a21\u5757 param\u6a21\u5757\u4e3a\u7cfb\u7edf\u63d0\u4f9b\u53c2\u6570\u529f\u80fd\uff0c\u5305\u62ec\u53c2\u6570\u7684\u5b9a\u4e49\uff0c\u8bfb\u53d6\uff0c\u5b58\u50a8\u548c\u4fee\u6539\u7b49\u3002\u53c2\u6570\u4ee5\u6587\u4ef6\u5f62\u5f0f\u5b58\u50a8\u5728\u5b58\u50a8\u8bbe\u5907\u4e0a\uff0c\u5982SD\u5361\u3002\u5b58\u50a8\u8def\u5f84\u9ed8\u8ba4\u4e3a /sys/param.xml \u6216\u8005 /sys/hil_param.xml (HIL\u6a21\u5f0f)\u3002 \u7cfb\u7edf\u4e0a\u7535\u4f1a\u81ea\u52a8\u8bfb\u53d6\u9ed8\u8ba4\u8def\u5f84\u4e0b\u7684\u53c2\u6570\u6587\u4ef6\u3002\u82e5\u53c2\u6570\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u5219\u4f7f\u7528\u9ed8\u8ba4\u7684\u53c2\u6570\u503c\u3002\u5982\u679c\u5f00\u542f\u4e86 blog \u65e5\u5fd7\u8bb0\u5f55\uff0c\u53c2\u6570\u4e5f\u4f1a\u88ab\u8bb0\u5f55\u5230\u65e5\u5fd7\u4e2d\uff0c\u4f9b\u4eff\u771f\u6a21\u578b\u8bfb\u53d6\u3002\u76ee\u524d\u652f\u6301\u7684\u53c2\u6570\u7c7b\u578b\u5305\u62ec enum param_type_t { PARAM_TYPE_INT8 = 0, PARAM_TYPE_UINT8, PARAM_TYPE_INT16, PARAM_TYPE_UINT16, PARAM_TYPE_INT32, PARAM_TYPE_UINT32, PARAM_TYPE_FLOAT, PARAM_TYPE_DOUBLE, PARAM_TYPE_UNKNOWN = 0xFF }; \u5b9a\u4e49\u53c2\u6570 \u5728\u5b9a\u4e49\u53c2\u6570\u4e4b\u524d\uff0c\u6709\u5fc5\u8981\u5148\u4e86\u89e3\u4e00\u4e0bFMT\u4e2d\u53c2\u6570\u7684\u7ec4\u7ec7\u65b9\u5f0f\u3002FMT\u7684\u53c2\u6570\u4ee5\u7ec4(Group)\u4e3a\u5355\u4f4d\u5bf9\u53c2\u6570\u8fdb\u884c\u7ec4\u7ec7\uff0c\u6bcf\u4e2a\u7ec4\u53ef\u4ee5\u5305\u542b\u4e00\u5230\u4efb\u610f\u591a\u4e2a\u53c2\u6570\u3002 \u4e3e\u4f8b\u8bf4\u660e\uff0c\u5b9a\u4e49\u4e00\u4e2a\u65b0\u7684 float \u7c7b\u578b\u7684\u53c2\u6570 my_param1 \u548c uint32 \u7c7b\u578b\u7684\u53c2\u6570 my_param2 \uff0c\u5b83\u4eec\u90fd\u5c5e\u4e8e\u540c\u4e00\u4e2a\u7ec4 my_group \uff0c\u5219\u53ef\u4ee5\u6309\u7167\u5982\u4e0b\u6b65\u9aa4\u5b9a\u4e49\uff1a \u7533\u660eGroup\uff1a \u5728 param.h \u4e2d\u7533\u660e\u65b0\u7684\u7ec4 my_group typedef struct { ...... param_group_t PARAM_GROUP(my_group); } param_list_t; \u5b9a\u4e49Group\uff1a\u5728 param.c \u4e2d\u5b9a\u4e49\u65b0\u7684Group param_list_t param_list = { ...... PARAM_DEFINE_GROUP(my_group), }; \u7533\u660eParameter\uff1a\u5728 param.h \u4e2d\u6dfb\u52a0\u65b0\u7684\u53c2\u6570\u7533\u660e typedef struct { PARAM_DECLARE(my_param1); PARAM_DECLARE(my_param2); } PARAM_GROUP(my_group); \u5b9a\u4e49Parameter\uff1a\u5728 param.c \u4e2d\u5b9a\u4e49\u65b0\u7684\u53c2\u6570 PARAM_GROUP(my_group) PARAM_DECLARE_GROUP(my_group) = \\ { PARAM_DEFINE_FLOAT(my_param1, 0.5), PARAM_DEFINE_UINT32(my_param2, 1), }; \u8fd9\u91cc\u5b9a\u4e49\u4e86\u4e24\u4e2a\u65b0\u7684\u53c2\u6570 my_param1 \uff08\u9ed8\u8ba4\u503c0.5\uff09\u548c my_param2 \uff08\u9ed8\u8ba4\u503c1\uff09\u3002 \u5982\u679c\u662f\u5728\u5df2\u6709Group\u4e2d\u6dfb\u52a0\u65b0\u7684\u53c2\u6570\uff0c\u90a3\u4e48\u5219\u53ef\u4ee5\u7701\u53bb\u6b65\u9aa41\u548c\u6b65\u9aa42 . \u8bfb\u53d6\u53c2\u6570 Param\u6a21\u5757\u63d0\u4f9b\u4e86\u5982\u4e0b\u5b8f\u5b9a\u4e49\u6765\u5feb\u901f\u83b7\u53d6\u53c2\u6570\u7684\u503c (\u975e\u67e5\u8be2\u6a21\u5f0f)\u3002\u7528\u6237\u9700\u8981\u9009\u62e9\u5339\u914d\u53c2\u6570\u7c7b\u578b\u7684\u5b8f\u5e76\u4f20\u5165\u53c2\u6570\u7684\u7ec4\u540d\u79f0\u548c\u53c2\u6570\u540d\u79f0. #define PARAM_GET_INT8(_group, _name) #define PARAM_GET_UINT8(_group, _name) #define PARAM_GET_INT16(_group, _name) #define PARAM_GET_UINT16(_group, _name) #define PARAM_GET_INT32(_group, _name) #define PARAM_GET_UINT32(_group, _name) #define PARAM_GET_FLOAT(_group, _name) #define PARAM_GET_DOUBLE(_group, _name) \u9664\u6b64\u4e4b\u5916,\u8fd8\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u51fd\u6570\u6765\u83b7\u53d6\u53c2\u6570: param_t* param_get(char* group_name, char* param_name); param_t* param_get_by_name(const char* param_name); param_t* param_get_by_full_name(const char* group_name, const char* param_name); \u8fd9\u4e9b\u51fd\u6570\u4f7f\u7528\u67e5\u8be2\u7684\u65b9\u5f0f\u67e5\u627e\u4e0e group_name \u548c param_name \u5339\u914d\u7684\u53c2\u6570\u3002\u5f53\u53c2\u6570\u8f83\u591a\u65f6,\u67e5\u627e\u901f\u5ea6\u8f83\u6162,\u6240\u4ee5\u4e0d\u5efa\u8bae\u5728\u7b97\u6cd5\u6a21\u5757\u4e2d\u4f7f\u7528\uff0c,\u4ec5\u4f9b\u7cfb\u7edf\u6307\u4ee4(syscmd)\u6a21\u5757\u4f7f\u7528. \u8bbe\u7f6e\u53c2\u6570 \u7c7b\u4f3c\u53c2\u6570\u8bfb\u53d6, param\u6a21\u5757\u4e5f\u63d0\u4f9b\u4e86\u5bf9\u5e94\u7684\u5b8f\u6765\u5feb\u901f\u8bbe\u7f6e\u53c2\u6570\u7684\u503c: #define PARAM_SET_INT8(_group, _name, _val) #define PARAM_SET_UINT8(_group, _name, _val) #define PARAM_SET_INT16(_group, _name, _val) #define PARAM_SET_UINT16(_group, _name, _val) #define PARAM_SET_INT32(_group, _name, _val) #define PARAM_SET_UINT32(_group, _name, _val) #define PARAM_SET_FLOAT(_group, _name, _val) #define PARAM_SET_DOUBLE(_group, _name, _val) \u540c\u6837\u7684,\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u51fd\u6570\u6765\u8bbe\u7f6e\u4e0e group_name \u548c param_name \u5339\u914d\u7684\u53c2\u6570\u6307\uff1a fmt_err param_set_val(param_t* param, void* val); fmt_err param_set_val_by_name(char* param_name, void* val); fmt_err param_set_val_by_full_name(char* group_name, char* param_name, void* val); fmt_err param_set_string_val(param_t* param, char* val); fmt_err param_set_string_val_by_name(char* param_name, char* val); fmt_err param_set_string_val_by_full_name(char* group_name, char* param_name, char* val); \u8c03\u7528\u4e0a\u9762\u7684\u5b8f/\u51fd\u6570\u8bbe\u7f6e\u5b8c\u53c2\u6570\u540e\uff0c\u9ed8\u8ba4\u4e0d\u4f1a\u4fdd\u5b58\u5230\u53c2\u6570\u6587\u4ef6\uff0c\u6240\u4ee5\u5f53\u7cfb\u7edf\u91cd\u542f\u4e4b\u540e\u5c06\u6062\u590d\u4e4b\u524d\u7684\u503c\u3002.\u5982\u9700\u5c06\u5f53\u524d\u53c2\u6570\u4fdd\u5b58,\u9700\u8981\u8c03\u7528 param_save(char* path) \u51fd\u6570\u6765\u4fdd\u5b58\u5f53\u524d\u4fee\u6539\u3002\u5176\u4e2d path \u4e3a\u53c2\u6570\u6587\u4ef6\u7684\u8def\u5f84\u540d\u79f0\uff0c\u82e5\u4f20\u5165 NULL \u5219\u4f7f\u7528\u9ed8\u8ba4\u8def\u5f84. \u53c2\u6570\u6307\u4ee4 FMT\u5185\u7f6e\u4e86 param \u6307\u4ee4\u6765\u5bf9\u53c2\u6570\u8fdb\u884c\u64cd\u4f5c\uff0c\u5176\u57fa\u672c\u7528\u6cd5\u5982\u4e0b\u6240\u793a: msh / param --help usage: param [OPTION] ACTION [ARGS] Action: list List group(s) parameters. group List all parameter groups. set Set parameter. get Get parameter. save Save parameters to file. load Load parameters from file. Option: -s, --save Save parameter value. param list : \u663e\u793a\u6240\u6709\u7684\u7ec4\u548c\u53c2\u6570: msh / param list SYSTEM: BLOG_MODE: 0 CALIB: GYRO0_XOFF: 0.000000 GYRO0_YOFF: 0.000000 GYRO0_ZOFF: 0.000000 ...... \u5982\u679c\u5728list\u540e\u52a0\u4e0a\u7ec4\u7684\u540d\u79f0,\u5219\u53ea\u663e\u793a\u5bf9\u5e94\u7ec4\u7684\u53c2\u6570: msh / param list SYSTEM SYSTEM: BLOG_MODE: 0 param group : \u663e\u793a\u6240\u6709\u7684\u7ec4: msh / param group Parameter Groups -------------------- SYSTEM CALIB param set : \u8bbe\u7f6e\u53c2\u6570\u7684\u503c\uff0c\u5176\u7528\u6cd5\u5982\u4e0b (\u65b9\u62ec\u53f7\u8868\u793a\u53ef\u9009\u9879,\u5c16\u62ec\u53f7\u4e3a\u5fc5\u586b\u9879): param set [group] parameter value \u6bd4\u5982\u8981\u5c06 BLOG_MODE \u53c2\u6570\u8bbe\u7f6e\u4e3a2,\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u6307\u4ee4: param set SYSTEM BLOG_MODE 2 \u4e0a\u8ff0\u6307\u4ee4\u4e5f\u53ef\u4ee5\u7b80\u5199\u4e3a param set BLOG_MODE 2 \u3002\u4f46\u662f\u8bf7\u6ce8\u610f\uff0c\u7531\u4e8e\u8fd9\u91cc\u6ca1\u6709\u6307\u5b9a\u7ec4\u540d\uff0c\u5982\u679c\u7cfb\u7edf\u4e2d\u5b58\u5728\u4e24\u4e2a\u76f8\u540c\u540d\u5b57\u7684\u53c2\u6570,\u5219\u4f1a\u9ed8\u8ba4\u5199\u5165\u7b2c\u4e00\u4e2a\u627e\u5230\u7684\u53c2\u6570. param get : \u83b7\u53d6\u53c2\u6570\u7684\u503c, \u7528\u6cd5\u5982\u4e0b\uff1a param get [group] parameter param save : \u5b58\u50a8\u5f53\u524d\u53c2\u6570\u3002\u53ef\u4ee5\u8f93\u5165 param save $path \u7684\u65b9\u5f0f\u6765\u6307\u5b9a\u5b58\u50a8\u8def\u5f84\uff0c\u5426\u5219\u5c06\u5b58\u50a8\u5230\u9ed8\u8ba4\u8def\u5f84\u3002 param load : \u52a0\u8f7d\u53c2\u6570\u6587\u4ef6\u3002\u53ef\u4ee5\u8f93\u5165 param load $path \u7684\u65b9\u5f0f\u6765\u6307\u5b9a\u52a0\u8f7d\u6587\u4ef6\uff0c\u5426\u5219\u5c06\u4ece\u9ed8\u8ba4\u8def\u5f84\u8fdb\u884c\u52a0\u8f7d\u3002 Log\u65e5\u5fd7\u6a21\u5757 \u65e5\u5fd7\u529f\u80fd\u5bf9\u4e8eMBD\u7684\u5f00\u53d1\u6a21\u5f0f\u800c\u8a00\u5341\u5206\u91cd\u8981\u3002\u56e0\u4e3aMBD\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u4eff\u771f\u624b\u6bb5\u65f6\u5f00\u73af\u4eff\u771f (Open Loop Simulation)\uff0c\u5176\u9ad8\u5ea6\u4f9d\u8d56\u4e8e\u65e5\u5fd7\u8bb0\u5f55\u7684\u6a21\u578b\u8f93\u5165/\u8f93\u51fa\u6570\u636e\uff0c\u4ece\u800c\u5f97\u5230\u548c\u5728\u786c\u4ef6\u4e0a\u8fd0\u884c\u5b8c\u5168\u4e00\u81f4\u7684\u4eff\u771f\u6570\u636e\u3002\u5f00\u73af\u4eff\u771f\u8981\u6c42\u8bb0\u5f55\u7684\u65e5\u5fd7\u6570\u636e\u9700\u8981\u540c\u65f6\u517c\u987e\u9ad8\u541e\u5410\u91cf\uff0c\u4f4e\u5ef6\u65f6\u548c\u9ad8\u5b9e\u65f6\u6027\u7684\u8981\u6c42\u3002 FMS\u65e5\u5fd7\u6a21\u5757\u63d0\u4f9b\u4e86\u4e24\u79cd\u7c7b\u578b\u7684\u65e5\u5fd7, BLog (Binary Log) \u548c ULog (Micro Log) , \u5206\u522b\u63d0\u4f9b \u4e8c\u8fdb\u5236\u65e5\u5fd7 \u6570\u636e\u8bb0\u5f55\u548c \u6587\u5b57\u65e5\u5fd7 \u6570\u636e\u8bb0\u5f55\u7684\u529f\u80fd\u3002 BLog\u65e5\u5fd7 \u9996\u5148\u6709\u5fc5\u8981\u4e86\u89e3\u4e00\u4e0bBLog\u8bb0\u5f55\u65e5\u5fd7\u7684\u7ed3\u6784\u3002BLog\u8bb0\u5f55\u7684\u65e5\u5fd7\u4ee5 Bus (\u7c7b\u4f3cSimulink\u4e2dBus\u7684\u6982\u5ff5)\u4e3a\u5355\u4f4d\uff0c\u5176\u4e2d\u6bcf\u4e2aBus\u53c8\u5305\u542b\u4e00\u4e2a\u6216\u8005\u591a\u4e2a Element (\u7c7b\u4f3cSimulink\u4e2dElement\u7684\u6982\u5ff5)\u3002\u6240\u4ee5BLog\u65e5\u5fd7\u6587\u4ef6\u53ef\u4ee5\u76f4\u63a5\u89e3\u6790\u4e3aSimulink\u53ef\u4ee5\u4f7f\u7528\u7684Bus\u6570\u636e\uff0c\u4f9b\u6a21\u578b\u8fdb\u884c\u4eff\u771f\u3002\u4e0b\u9762\u540c\u6837\u4e3e\u4f8b\u8bf4\u660eBLog\u65e5\u5fd7\u7684\u7528\u6cd5\u3002 \u6dfb\u52a0\u65e5\u5fd7\u6570\u636e \u8fd9\u91cc\u4ee5 IMU \u65e5\u5fd7\u6570\u636e\u4e3a\u4f8b, \u6f14\u793a\u5982\u4f55\u6dfb\u52a0\u65b0\u7684\u65e5\u5fd7\u6570\u636e. \u5b9a\u4e49Element\uff1a\u4f7f\u7528\u5b8f BLOG_ELEMENT(_name, _type) \u6765\u5b9a\u4e49\u4e00\u4e2aElement\uff0c\u5176\u4e2d _name \u4e3aElement\u540d\u79f0\uff0c _type \u4e3aElement\u7c7b\u578b\uff0c\u76ee\u524d\u652f\u6301\u7684\u7c7b\u578b\u5982\u4e0b\uff1a enum { BLOG_INT8 = 0, BLOG_UINT8, BLOG_INT16, BLOG_UINT16, BLOG_INT32, BLOG_UINT32, BLOG_FLOAT, BLOG_DOUBLE, BLOG_BOOLEAN, }; \u6211\u4eec\u6784\u5efa\u7684IMU\u8f93\u5165\u5982\u4e0b\u6240\u793a\uff1a blog_elem_t IMU_elems[] = { BLOG_ELEMENT( timestamp_ms , BLOG_UINT32), BLOG_ELEMENT( gyr_x_radPs_B , BLOG_FLOAT), BLOG_ELEMENT( gyr_y_radPs_B , BLOG_FLOAT), BLOG_ELEMENT( gyr_z_radPs_B , BLOG_FLOAT), BLOG_ELEMENT( acc_x_mPs2_B , BLOG_FLOAT), BLOG_ELEMENT( acc_y_mPs2_B , BLOG_FLOAT), BLOG_ELEMENT( acc_z_mPs2_B , BLOG_FLOAT), }; \u5982\u679c\u8981\u5b9a\u4e49\u77e9\u9635\u6216\u8005\u5411\u91cf\u7c7b\u578b\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u4f7f\u7528\u5b8f BLOG_ELEMENT_VEC(_name, _type, _num) \u3002\u5176\u4e2d _num \u4e3a\u5411\u91cf\u7684\u957f\u5ea6\u3002 blog_elem_t IMU_elems[] = { BLOG_ELEMENT( timestamp_ms , BLOG_UINT32), BLOG_ELEMENT_VEC( gyr_radPs_B , BLOG_FLOAT, 3), BLOG_ELEMENT_VEC( acc_mPs2_B , BLOG_FLOAT, 3), }; \u5b9a\u4e49Bus\uff1a\u4f7f\u7528\u5b8f BLOG_BUS(_name, _id, _elem_list) \u5c06\u65b0\u7684Bus\u6dfb\u52a0\u5230 _blog_bus \u5217\u8868\u4e2d\u3002\u5176\u4e2d _name \u4e3aBus\u540d\u79f0\uff1b _id \u4e3a\u8be5\u6761Bus\u7684ID\uff0c\u7528\u6765\u552f\u4e00\u6307\u4ee3\u8fd9\u6761Bus\u6570\u636e\uff1bIMU_elems\u4e3aBus\u7684Element\u6570\u636e\u3002\u6bd4\u5982\uff1a blog_bus_t _blog_bus[] = { BLOG_BUS( IMU , BLOG_IMU_ID, IMU_elems), ...... }; \u8bb0\u5f55\u65e5\u5fd7\u6570\u636e \u65e5\u5fd7\u6dfb\u52a0\u5b8c\u6210\u540e\u5c31\u53ef\u4ee5\u5f00\u59cb\u8bb0\u5f55\u65e5\u5fd7\u6570\u636e\u3002\u540c\u6837\uff0cBLog\u65e5\u5fd7\u8bb0\u5f55\u4ee5Bus\u4e3a\u5355\u4f4d\uff0c\u6bcf\u6761Bus\u6570\u636e\u53ef\u4ee5\u4ee5\u5404\u81ea\u7684\u9891\u7387\u8fdb\u884c\u8bb0\u5f55\u3002\u4f7f\u7528 blog_push_msg \u51fd\u6570\u8bb0\u5f55\u4e00\u6761Bus\u6570\u636e\u3002 \u6bd4\u5982\u5982\u4e0b\u4ee3\u7801\u5c06\u5728IMU\u6570\u636e\u66f4\u65b0\u4e4b\u540e\u8bb0\u5f55IMU\u7684\u6570\u636e\uff1a /* record INS input bus data if updated */ if (ins_handle.imu_updated) { ins_handle.imu_updated = 0; /* Log IMU data if IMU updated */ blog_push_msg((uint8_t*) INS_U.IMU1, BLOG_IMU_ID, sizeof(INS_U.IMU1)); } \u5176\u4e2d INS_U.IMU1 \u4e3a\u5b58\u653e\u6570\u636e\u7684\u53d8\u91cf, BLOG_IMU_ID \u4e3a\u8be5\u6761Bus\u7684ID, sizeof(INS_U.IMU1) \u8868\u793a\u8be5\u6761Bus\u6570\u636e\u7684\u957f\u5ea6\u3002 \u5f00\u542f/\u5173\u95ed\u65e5\u5fd7\u8bb0\u5f55 \u53ef\u4ee5\u4f7f\u7528 blog start/stop \u6307\u4ee4\u6765\u5f00\u542f/\u5173\u95ed\u65e5\u5fd7\u8bb0\u5f55\u3002\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e BLOG_MODE \u53c2\u6570\u7684\u503c\u6765\u81ea\u52a8\u5f00\u542f/\u5173\u95edBLog\u65e5\u5fd7\u7684\u8bb0\u5f55\uff1a /* Determines when to start and stop logging (Blog). 0: disabled 1: when armed until disarm 2: from boot until disarm 3: from boot until shutdown */ PARAM_DEFINE_INT32(BLOG_MODE, 0), \u65e5\u5fd7\u89e3\u6790 TO BE ADDED BLog\u6307\u4ee4 TO BE ADDED ULog\u65e5\u5fd7 ULog \u4e3aRT-Thread\u63d0\u4f9b\u7684\u7cfb\u7edf\u7ec4\u4ef6\uff0c\u63d0\u4f9b\u6587\u5b57\u65e5\u5fd7\u8bb0\u5f55\u7684\u529f\u80fd\u3002\u6587\u5b57\u65e5\u5fd7\u53ef\u4ee5\u7528\u6765\u8f93\u51fa\u7cfb\u7edf\u7684\u4e00\u4e9b\u8c03\u8bd5\u4fe1\u606f\uff0c\u4ece\u800c\u4f9b\u5f00\u53d1\u8005\u8fdb\u884c\u95ee\u9898\u5b9a\u4f4d\u3002FMT\u652f\u6301\u5c06ULog\u8f93\u51fa\u5230\u63a7\u5236\u53f0\u548c\u6587\u4ef6\u7cfb\u7edf\u3002 \u4f7f\u7528\u5982\u4e0b\u63a5\u53e3\u8f93\u51faULog\u65e5\u5fd7\u4fe1\u606f\uff1a ulog_e(TAG, ...) // Error ulog_w(TAG, ...) // Warning ulog_i(TAG, ...) // Info ulog_d(TAG, ...) // Debug ULog\u65e5\u5fd7\u4fe1\u606f\u5c06\u88ab\u6253\u5370\u5728\u63a7\u5236\u53f0\uff0c\u5e76\u4e14\u540c\u65f6\u88ab\u5b58\u50a8\u5728 /log/$session_id/ulog.txt \u4e2d\u3002 [1708] W/Status: FMS Unknown Mode [1714] I/Status: FMS Status Disarm [5479] I/Status: FMS Position Mode [8268] I/Status: FMS Altitude Hold Mode [9104] I/Status: FMS Manual Mode [13034] I/Status: FMS Status Standby [15005] I/Status: FMS Status Arm [21673] I/Status: FMS Status Disarm","title":"\u7ec4\u4ef6"},{"location":"module/#_1","text":"FMT\u63d0\u4f9b\u4e86\u529f\u80fd\u5f3a\u5927\u7684\u7cfb\u7edf\u7ec4\u4ef6\uff0c\u5404\u79cd\u7ec4\u4ef6\u63d0\u4f9b\u4e86\u7cfb\u7edf\u7684\u5927\u90e8\u5206\u529f\u80fd\u5b9e\u73b0\u3002\u7531\u4e8e\u786c\u4ef6\u865a\u62df\u5c42\uff08HAL\uff09\u7684\u5f15\u5165\uff0c\u5404\u4e2a\u7ec4\u4ef6\u6a21\u5757\u53ef\u4ee5\u505a\u5230\u8ddf\u786c\u4ef6\u5e73\u53f0\u65e0\u5173\uff0c\u652f\u6301\u5728\u5404\u4e2a\u4e0d\u7528\u7684\u786c\u4ef6\u5e73\u53f0\u4e0a\u4f7f\u7528\u3002\u7528\u6237\u53ea\u9700\u8981\u6839\u636e\u5f53\u524d\u7684\u786c\u4ef6\u5e73\u53f0\u8d44\u6e90\u548c\u9a71\u52a8\uff0c\u6765\u51b3\u5b9a\u8981\u4f7f\u7528\u54ea\u4e9b\u7ec4\u4ef6\u6a21\u5757\u3002 \u8fd9\u91cc\uff0c\u6211\u4eec\u5c06\u4ecb\u7ecdFMT\u4e2d\u5e38\u7528\u7684\u4e00\u4e9b\u7ec4\u4ef6\u3002","title":"\u7ec4\u4ef6"},{"location":"module/#console","text":"\u63a7\u5236\u53f0\u7ec4\u4ef6\u4f9b\u4e86\u63a7\u5236\u53f0\u7684\u8f93\u5165/\u8f93\u51fa\u529f\u80fd\uff0c\u4e3b\u8981\u7528\u4e8e\u8c03\u8bd5\u4fe1\u606f\u7684\u6253\u5370\u4ee5\u53ca\u547d\u4ee4\u884c\u7684\u4ea4\u4e92\u529f\u80fd\u3002console\u53ef\u4ee5\u88ab\u6620\u5c04\u5230\u4e0d\u540c\u7684\u8bbe\u5907\u4e0a\uff0c\u5982\u4e32\u53e3\uff0cUSB\u7b49\u3002","title":"Console\u63a7\u5236\u53f0"},{"location":"module/#_2","text":"\u8c03\u7528\u5982\u4e0b\u51fd\u6570\u6765\u5c06console\u8bbe\u7f6e\u5230 dev_name \u5bf9\u5e94\u7684\u8bbe\u5907\u4e0a\u3002 fmt_err console_set_device(char* dev_name); console\u9ed8\u8ba4\u4f7f\u7528 serial1 \u8bbe\u5907 (TELEM2\u63a5\u53e3)\u3002\u5f53\u8fde\u63a5QGC\u5730\u9762\u7ad9\uff0c\u5e76\u5728 Mavlink Console \u8f93\u5165\u4efb\u610f\u5b57\u7b26\uff0cconsole\u5c06\u88ab\u81ea\u52a8\u5207\u6362\u5230 mav_console \u8bbe\u5907\u4e0a\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002 \u5f53\u524dconsole\u652f\u6301\u7684\u8bbe\u5907\u540d\u79f0\u5982\u4e0b\uff1a - serialx \uff1a \u6807\u51c6\u4e32\u53e3\u8bbe\u5907\uff0c\u9ed8\u8ba4\u4f7f\u7528 serial1 - mav_console : \u57fa\u4e8emavlink\u534f\u8bae\u7684\u865a\u62df\u63a7\u5236\u53f0\u8bbe\u5907\u3002\u5b83\u5c06console\u7684\u8f93\u5165/\u8f93\u51fa\u6570\u636e\u5c01\u88c5\u4e3a MAVLINK_MSG_ID_SERIAL_CONTROL \u7684\u5305\uff0c\u518d\u901a\u8fc7\u4e32\u53e3\u6216\u8005USB\u8fdb\u884c\u53d1\u9001\uff0c\u4ee5\u652f\u6301QGC\u7684 Mavlink Console \u529f\u80fd\u3002","title":"\u8bbe\u7f6e\u63a7\u5236\u53f0\u8bbe\u5907"},{"location":"module/#shell","text":"\u8c03\u7528\u5982\u4e0b\u51fd\u6570\u5c06\u8bbe\u5907\u7ed1\u5b9a\u5230shell\u3002\u7ed1\u5b9a\u540e\uff0c\u5bf9\u5e94\u8bbe\u5907\u7684\u8f93\u5165\u5c06\u9001\u7ed9shell\u8fdb\u884c\u547d\u4ee4\u89e3\u6790\u3002\u82e5\u4f20\u5165\u7684 dev=NULL \uff0c\u5219\u9ed8\u8ba4\u5c06\u5f53\u524d console \u7684\u8bbe\u5907\u7ed1\u5b9a\u5230shell\u3002 fmt_err console_mount_shell(rt_device_t dev);","title":"\u7ed1\u5b9aShell\u8bbe\u5907"},{"location":"module/#_3","text":"\u63a7\u5236\u53f0\u63d0\u4f9b\u4e86\u5982\u4e0b\u4e24\u4e2a\u51fd\u6570\u6765\u6253\u5370\u4fe1\u606f\u5230\u63a7\u5236\u53f0\u8bbe\u5907\u3002 uint32_t console_printf(const char* fmt, ...); uint32_t console_write(const char* content, uint32_t len); \u5e38\u7528\u7684 console_printf() \u7528\u6cd5\u7c7b\u4f3c printf() \uff0c\u652f\u6301\u5404\u79cd\u683c\u5f0f\u5316\u6253\u5370\uff0c\u4e14\u652f\u6301\u4e2d\u65ad\u51fd\u6570\u4e2d\u6253\u5370\uff0c\u5982\uff1a console_printf( %f %d %x\\n , 0.2, 33, 0xFF); console_write() \u51fd\u6570\u5219\u63d0\u4f9b\u4e86\u63a7\u5236\u53f0\u6570\u636e\u76f4\u63a5\u5199\u5165\u7684\u529f\u80fd\uff0c\u5982: console_write(buffer, sizeof(buffer));","title":"\u63a7\u5236\u53f0\u6253\u5370"},{"location":"module/#umcn","text":"uMCN (Micro Multi-Communication Node) \u63d0\u4f9b\u57fa\u4e8e\u8ba2\u9605/\u53d1\u5e03\u6a21\u5f0f\u7684\u5b89\u5168\u8de8\u8fdb\u7a0b\u901a\u4fe1\u65b9\u5f0f\uff0c\u4e3aFMT\u5404\u4e2a\u4efb\u52a1\uff0c\u6a21\u5757\u4e4b\u95f4\u8fdb\u884c\u4fe1\u606f\u4ea4\u6362\u7684\u4e3b\u8981\u65b9\u5f0f\u3002","title":"uMCN\u6d88\u606f\u8ba2\u9605/\u53d1\u5e03\u6a21\u5757"},{"location":"module/#_4","text":"\u5b9a\u4e49\u4e00\u6761\u65b0\u7684uMCN\u53ea\u9700\u7b80\u5355\u51e0\u6b65\u3002\u8fd9\u91cc\u4e3e\u4f8b\u8bf4\u660e\u5b9a\u4e49\u4e00\u6761\u65b0\u7684\u6d88\u606f\uff0c\u6d88\u606f\u540d\u79f0\u4e3a my_mcn_topic \uff0c\u6d88\u606f\u5185\u5bb9(topic)\u4e3a\uff1a typedef struct { uint32_t a; float b; int8_t c[4]; } test_data; \u5b9a\u4e49\u6d88\u606f\uff1a\u5728\u6e90\u6587\u4ef6\u5934\u90e8\uff08\u901a\u5e38\u4e3a\u53d1\u5e03\u8be5\u6d88\u606f\u7684\u6e90\u6587\u4ef6\uff09\u6dfb\u52a0\u5982\u4e0b\u5b9a\u4e49\uff1a MCN_DEFINE(my_mcn_topic, sizeof(test_data)); \u8fd9\u91cc my_mcn_topic \u4e3a\u8be5\u6d88\u606f\u7684\u540d\u5b57\uff0c sizeof(test_data) \u4e3a\u6d88\u606f\u5185\u5bb9\u7684\u957f\u5ea6\u3002uMCN\u5bf9\u6d88\u606f\u7684\u957f\u5ea6\u548c\u7c7b\u578b\u6ca1\u6709\u9650\u5236\uff0c\u6240\u4ee5\u7406\u8bba\u4e0a\u53ef\u4ee5\u7528uMCN\u4f20\u9012\u4efb\u610f\u6d88\u606f\u7c7b\u578b\u3002\u540c\u65f6uMCN\u652f\u6301\u4e00\u4e2a\u6d88\u606f\u540c\u65f6\u6709\u591a\u4e2a\u53d1\u5e03\u8005 (publisher) \u548c\u8ba2\u9605\u8005 (subscriber)\u3002\u4f46\u662f\u6ce8\u610f\uff0c\u540c\u4e00\u4e2a\u6d88\u606f(\u540d\u79f0)\u4e0d\u53ef\u88ab\u91cd\u590d\u5b9a\u4e49\uff0c\u4e0d\u7136\u7f16\u8bd1\u65f6\u4f1a\u62a5\u91cd\u590d\u5b9a\u4e49\u7684\u9519\u8bef\u3002 \u6ce8\u518c\u6d88\u606f\uff1a\u8c03\u7528 mcn_advertise \u51fd\u6570\u6ce8\u518c\u8be5\u6761\u6d88\u606f\uff1a mcn_advertise(MCN_ID(my_mcn_topic), _my_mcn_topic_echo); \u8fd9\u91cc my_mcn_topic \u540c\u6837\u4e3a\u8be5\u6d88\u606f\u7684\u540d\u5b57\uff0c MCN_ID \u662f\u4e00\u4e2a\u5b8f\uff0c\u7528\u6765\u6839\u636e\u6d88\u606f\u540d\u79f0\u5f97\u5230 McnHub \u8282\u70b9\u3002 _my_mcn_topic_echo \u4e3a\u8be5\u6761\u6d88\u606f\u7684\u6253\u5370\u51fd\u6570\u3002\u5f53\u5728\u63a7\u5236\u53f0\u8f93\u5165\u6307\u4ee4 mcn echo my_mcn_topic \uff0c\u5c06\u8c03\u7528\u8be5\u6761\u6d88\u606f\u7684\u6253\u5370\u51fd\u6570\u6765\u6253\u5370\u6d88\u606f\u5185\u5bb9\u3002\u7528\u6237\u53ef\u4ee5\u81ea\u5b9a\u4e49\u6253\u5370\u51fd\u6570\u6765\u8f93\u51fa\u60f3\u8981\u6570\u636e\u683c\u5f0f\u3002\u6bd4\u5982 my_mcn_topic \u7684\u6253\u5370\u51fd\u6570\u5982\u4e0b\u8fd9\u6837\u5b9a\u4e49\uff1a static int _my_mcn_topic_echo(void* param) { test_data data; if(mcn_copy_from_hub((McnHub*)param, data) == FMT_EOK){ console_printf( a:%d b:%f c:%c %c %c %c\\n , data.a, data.b, data.c[0], data.c[1], data.c[2], data.c[3]); } return 0; }","title":"\u5b9a\u4e49\u6d88\u606f"},{"location":"module/#_5","text":"\u8ba2\u9605\u8005\u8981\u83b7\u53d6\u6d88\u606f\u7684\u6570\u636e\uff0c\u9996\u5148\u9700\u8981\u5148\u8ba2\u9605\u6d88\u606f\uff0c\u901a\u8fc7 mcn_subscribe \u51fd\u6570\u5b9e\u73b0\u6d88\u606f\u7684\u8ba2\u9605\u3002uMCN\u652f\u6301\u540c\u6b65/\u5f02\u6b65\u6d88\u606f\u8ba2\u9605\uff0c\u540c\u6b65\u65b9\u5f0f\u9700\u8981\u5728\u8ba2\u9605\u6d88\u606f\u7684\u65f6\u5019\u4f20\u5165\u4e00\u4e2a\u6d88\u606f\u53e5\u67c4 event_t \u7528\u4e8e\u7ebf\u7a0b\u540c\u6b65\u3002\u8ba2\u9605\u6d88\u606f\u9075\u5faa\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a \u58f0\u660e\u6d88\u606f\uff1a\u5982\u679c\u662f\u5728\u975e\u5b9a\u4e49\u8be5\u6761\u6d88\u606f\u7684\u6e90\u6587\u4ef6\u4e2d\uff0c\u5219\u9700\u8981\u5148\u7533\u660e\u8be5\u6761\u6d88\u606f\u3002\u6bd4\u5982\u5bf9\u4e8e\u6211\u4eec\u521a\u521a\u5efa\u7acb\u7684 my_mcn_topic \uff0c\u9700\u8981\u5728\u8ba2\u9605\u6d88\u606f\u7684\u6e90\u6587\u4ef6\u5934\u90e8\u6dfb\u52a0 MCN_DECLARE(my_mcn_topic); \u8ba2\u9605\u6d88\u606f\uff1a\u8c03\u7528 mcn_subscribe(McnHub* hub, MCN_EVENT_HANDLE event_t, void (*cb)(void* parameter)) \u51fd\u6570\u6765\u8ba2\u9605\u6d88\u606f\u3002 \u5176\u4e2d cb \u4e3a\u6d88\u606f\u53d1\u5e03\u7684\u56de\u8c03\u51fd\u6570\uff0c\u5728\u6bcf\u6b21\u53d1\u5e03\u6d88\u606f\u65f6\uff0c\u56de\u8c03\u51fd\u6570\u5c06\u88ab\u8c03\u7528 (\u6ce8\u610f: \u56de\u8c03\u51fd\u6570\u5c06\u5728\u53d1\u5e03\u6d88\u606f\u7684\u7ebf\u7a0b\u4e2d\u88ab\u8c03\u7528)\u3002 event_t \u4e3a\u7528\u4e8e\u6d88\u606f\u540c\u6b65\u7684\u4e8b\u4ef6\u53e5\u67c4\uff0c\u8fd9\u91cc\u4e00\u822c\u7528\u7cfb\u7edf\u7684\u4fe1\u53f7\u91cf(semaphore)\u5b9e\u73b0\u3002\u5f53\u8ba2\u9605\u6210\u529f\u540e\uff0c\u51fd\u6570\u5c06\u8fd4\u56de\u6d88\u606f\u8282\u70b9\u53e5\u67c4 McnNode_t \u3002 \u8fd9\u91cc\u5206\u522b\u5bf9\u540c\u6b65/\u5f02\u6b65\u7684\u6d88\u606f\u8ba2\u9605\u4e3e\u4f8b\uff1a \u540c\u6b65\u8ba2\u9605 rt_sem_t event = rt_sem_create( my_event , 0, RT_IPC_FLAG_FIFO); McnNode_t my_nod = mcn_subscribe(MCN_ID(my_mcn_topic), event, NULL); \u5f02\u6b65\u8ba2\u9605 McnNode_t my_nod = mcn_subscribe(MCN_ID(my_mcn_topic), NULL, NULL);","title":"\u8ba2\u9605\u6d88\u606f"},{"location":"module/#_6","text":"\u53d1\u5e03\u6d88\u606f\u6570\u636e\u4f7f\u7528 mcn_publish \u51fd\u6570\u3002\u6bd4\u5982 mcn_publish(MCN_ID(my_mcn_topic), my_data); \u8fd9\u91cc my_data \u4e3a\u8981\u53d1\u5e03\u7684\u6570\u636e\uff0c\u5176\u7c7b\u578b\u4e3a test_data \u3002\u6ce8\u610f\u8fd9\u91cc\u53d1\u5e03\u6d88\u606f\u7684\u7c7b\u578b\u9700\u8ddf MCN_DEFINE() \u5b9a\u4e49\u7684\u6d88\u606f\u6570\u636e\u7c7b\u578b\u4e00\u81f4\uff0c\u5426\u5219\u5c06\u53d1\u751f\u975e\u9884\u671f\u7684\u540e\u679c\u3002","title":"\u53d1\u5e03\u6d88\u606f"},{"location":"module/#_7","text":"\u5bf9\u4e8e\u540c\u6b65/\u5f02\u6b65\u7684\u6d88\u606f\u8ba2\u9605\u65b9\u5f0f\uff0c\u8bfb\u53d6\u6d88\u606f\u65f6\u4e5f\u5206\u4e3a\u540c\u6b65\u548c\u5f02\u6b65\u65b9\u5f0f\u3002 \u5bf9\u4e8e\u540c\u6b65\u8ba2\u9605\u65b9\u5f0f\uff0c\u8c03\u7528 mcn_poll_sync \u51fd\u6570\u67e5\u8be2\u662f\u5426\u6536\u5230\u65b0\u7684\u6570\u636e\u3002\u5982\u679c\u6ca1\u6709\u65b0\u7684\u6570\u636e\uff0c\u5219\u5c06\u5f53\u524d\u7ebf\u7a0b\u6302\u8d77\uff0c\u76f4\u5230\u6536\u5230\u6570\u636e\u6216\u8005\u7b49\u5f85\u8d85\u65f6\u8fd4\u56de\u3002\u5f53\u6709\u65b0\u7684\u6570\u636e\u5230\u6765\u540e\uff0c\u8c03\u7528 mcn_copy \u51fd\u6570\u8bfb\u53d6\u6570\u636e\u3002\u4f8b\u5982\uff1a test_data read_data; if(mcn_poll_sync(my_nod, RT_WAIT_FOREVER)){ mcn_copy(MCN_ID(my_mcn_topic), my_nod, read_data); } \u8fd9\u91cc my_nod \u4e3a\u6d88\u606f\u8ba2\u9605\u65f6\u8fd4\u56de\u7684\u6d88\u606f\u8282\u70b9\u53e5\u67c4\u3002 \u5982\u679c\u662f\u91c7\u7528\u5f02\u6b65\u8ba2\u9605\u65b9\u5f0f\uff0c\u4f7f\u7528 mcn_poll \u51fd\u6570\u67e5\u8be2\u662f\u5426\u6709\u65b0\u7684\u6570\u636e\uff0c\u8be5\u51fd\u6570\u4f1a\u7acb\u9a6c\u8fd4\u56de\u3002 test_data read_data; if(mcn_poll(my_nod){ mcn_copy(MCN_ID(my_mcn_topic), my_nod, read_data); }","title":"\u8bfb\u53d6\u6d88\u606f"},{"location":"module/#umcn_1","text":"FMT\u63d0\u4f9b\u4e86 mcn \u7684\u6307\u4ee4\u6765\u65b9\u4fbf\u67e5\u770b\u5f53\u524d\u7cfb\u7edf\u4e2d\u7684uMCN\u6d88\u606f\uff0c\u6307\u4ee4\u7528\u6cd5\u5982\u4e0b\uff1a msh / mcn --help usage: mcn [OPTION] ACTION [ARGS] Action: list List all uMCN topics. echo Echo a uMCN topic. Option: -c, --cnt Set topic echo count, e.g, -c=10 will echo 10 times. -p, --period Set topic echo period(ms), -p=0 inherits topic period. The default period is 500ms. \u8f93\u5165 mcn list \u5c06\u663e\u793a\u5f53\u524d\u7cfb\u7edf\u6240\u6709\u7684topic msh / mcn list Topic #SUB Freq(Hz) Echo ---------------- ------ ---------- ------ usb_status 1 21.7 true sensor_imu 1 500.0 true sensor_mag 1 100.0 true sensor_baro 1 100.0 true sensor_gps 1 10.0 true ins_output 3 500.0 true fms_output 2 125.0 false control_output 2 250.0 false pilot_cmd 1 0.0 true \u5176\u4e2dTopic\u4e3a\u6d88\u606f\u540d\u79f0\uff0c#SUB\u4e3a\u6d88\u606f\u8ba2\u9605\u8005\u6570\u91cf\uff0cFreq\u4e3a\u6d88\u606f\u53d1\u5e03\u9891\u7387\uff0cEcho\u8868\u793a\u8be5\u6761\u6d88\u606f\u662f\u5426\u63d0\u4f9b\u4e86\u6253\u5370\u51fd\u6570\u3002 \u5bf9\u4e8e\u63d0\u4f9b\u4e86\u6253\u5370\u51fd\u6570\u7684\u6d88\u606f\uff0c\u53ef\u4ee5\u8f93\u5165 mcn echo [topic_name] \u6765\u6253\u5370\u6d88\u606f\u3002\u6bd4\u5982\u8f93\u5165 mcn echo sensor_imu \u5c06\u6253\u5370IMU\u7684\u6570\u636e\uff0c\u6309\u4efb\u610f\u952e\u7ed3\u675f\u3002 msh / mcn echo sensor_imu gyr:-0.000870 -0.002555 -0.003110 acc:0.011333 0.083641 -9.862786 gyr:-0.001118 -0.001791 0.001414 acc:-0.067505 -0.048334 -9.854862 gyr:0.002485 0.005287 0.005572 acc:-0.040842 -0.008587 -9.773908 gyr:-0.000103 -0.001102 0.003385 acc:-0.092554 -0.013108 -9.854832 gyr:-0.001078 0.002592 -0.003151 acc:-0.040336 0.019121 -9.748902 ...... mcn echo \u6307\u4ee4\u652f\u6301 -c \u548c -p \u7684Option\u6765\u8bbe\u7f6e\u6d88\u606f\u6253\u5370\u7684 \u6761\u6570 \u548c \u9891\u7387 \uff0c\u9ed8\u8ba4\u6253\u5370\u9891\u7387500ms\u3002 \u5982\u679c\u8981\u6253\u537010\u6761\u6d88\u606f\uff0c\u6253\u5370\u9891\u7387\u4e3a100ms\uff0c\u53ef\u4ee5\u8f93\u5165 mcn echo -c=10 -p=100 sensor_mag \u3002","title":"uMCN\u6307\u4ee4"},{"location":"module/#param","text":"param\u6a21\u5757\u4e3a\u7cfb\u7edf\u63d0\u4f9b\u53c2\u6570\u529f\u80fd\uff0c\u5305\u62ec\u53c2\u6570\u7684\u5b9a\u4e49\uff0c\u8bfb\u53d6\uff0c\u5b58\u50a8\u548c\u4fee\u6539\u7b49\u3002\u53c2\u6570\u4ee5\u6587\u4ef6\u5f62\u5f0f\u5b58\u50a8\u5728\u5b58\u50a8\u8bbe\u5907\u4e0a\uff0c\u5982SD\u5361\u3002\u5b58\u50a8\u8def\u5f84\u9ed8\u8ba4\u4e3a /sys/param.xml \u6216\u8005 /sys/hil_param.xml (HIL\u6a21\u5f0f)\u3002 \u7cfb\u7edf\u4e0a\u7535\u4f1a\u81ea\u52a8\u8bfb\u53d6\u9ed8\u8ba4\u8def\u5f84\u4e0b\u7684\u53c2\u6570\u6587\u4ef6\u3002\u82e5\u53c2\u6570\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u5219\u4f7f\u7528\u9ed8\u8ba4\u7684\u53c2\u6570\u503c\u3002\u5982\u679c\u5f00\u542f\u4e86 blog \u65e5\u5fd7\u8bb0\u5f55\uff0c\u53c2\u6570\u4e5f\u4f1a\u88ab\u8bb0\u5f55\u5230\u65e5\u5fd7\u4e2d\uff0c\u4f9b\u4eff\u771f\u6a21\u578b\u8bfb\u53d6\u3002\u76ee\u524d\u652f\u6301\u7684\u53c2\u6570\u7c7b\u578b\u5305\u62ec enum param_type_t { PARAM_TYPE_INT8 = 0, PARAM_TYPE_UINT8, PARAM_TYPE_INT16, PARAM_TYPE_UINT16, PARAM_TYPE_INT32, PARAM_TYPE_UINT32, PARAM_TYPE_FLOAT, PARAM_TYPE_DOUBLE, PARAM_TYPE_UNKNOWN = 0xFF };","title":"Param\u53c2\u6570\u6a21\u5757"},{"location":"module/#_8","text":"\u5728\u5b9a\u4e49\u53c2\u6570\u4e4b\u524d\uff0c\u6709\u5fc5\u8981\u5148\u4e86\u89e3\u4e00\u4e0bFMT\u4e2d\u53c2\u6570\u7684\u7ec4\u7ec7\u65b9\u5f0f\u3002FMT\u7684\u53c2\u6570\u4ee5\u7ec4(Group)\u4e3a\u5355\u4f4d\u5bf9\u53c2\u6570\u8fdb\u884c\u7ec4\u7ec7\uff0c\u6bcf\u4e2a\u7ec4\u53ef\u4ee5\u5305\u542b\u4e00\u5230\u4efb\u610f\u591a\u4e2a\u53c2\u6570\u3002 \u4e3e\u4f8b\u8bf4\u660e\uff0c\u5b9a\u4e49\u4e00\u4e2a\u65b0\u7684 float \u7c7b\u578b\u7684\u53c2\u6570 my_param1 \u548c uint32 \u7c7b\u578b\u7684\u53c2\u6570 my_param2 \uff0c\u5b83\u4eec\u90fd\u5c5e\u4e8e\u540c\u4e00\u4e2a\u7ec4 my_group \uff0c\u5219\u53ef\u4ee5\u6309\u7167\u5982\u4e0b\u6b65\u9aa4\u5b9a\u4e49\uff1a \u7533\u660eGroup\uff1a \u5728 param.h \u4e2d\u7533\u660e\u65b0\u7684\u7ec4 my_group typedef struct { ...... param_group_t PARAM_GROUP(my_group); } param_list_t; \u5b9a\u4e49Group\uff1a\u5728 param.c \u4e2d\u5b9a\u4e49\u65b0\u7684Group param_list_t param_list = { ...... PARAM_DEFINE_GROUP(my_group), }; \u7533\u660eParameter\uff1a\u5728 param.h \u4e2d\u6dfb\u52a0\u65b0\u7684\u53c2\u6570\u7533\u660e typedef struct { PARAM_DECLARE(my_param1); PARAM_DECLARE(my_param2); } PARAM_GROUP(my_group); \u5b9a\u4e49Parameter\uff1a\u5728 param.c \u4e2d\u5b9a\u4e49\u65b0\u7684\u53c2\u6570 PARAM_GROUP(my_group) PARAM_DECLARE_GROUP(my_group) = \\ { PARAM_DEFINE_FLOAT(my_param1, 0.5), PARAM_DEFINE_UINT32(my_param2, 1), }; \u8fd9\u91cc\u5b9a\u4e49\u4e86\u4e24\u4e2a\u65b0\u7684\u53c2\u6570 my_param1 \uff08\u9ed8\u8ba4\u503c0.5\uff09\u548c my_param2 \uff08\u9ed8\u8ba4\u503c1\uff09\u3002 \u5982\u679c\u662f\u5728\u5df2\u6709Group\u4e2d\u6dfb\u52a0\u65b0\u7684\u53c2\u6570\uff0c\u90a3\u4e48\u5219\u53ef\u4ee5\u7701\u53bb\u6b65\u9aa41\u548c\u6b65\u9aa42 .","title":"\u5b9a\u4e49\u53c2\u6570"},{"location":"module/#_9","text":"Param\u6a21\u5757\u63d0\u4f9b\u4e86\u5982\u4e0b\u5b8f\u5b9a\u4e49\u6765\u5feb\u901f\u83b7\u53d6\u53c2\u6570\u7684\u503c (\u975e\u67e5\u8be2\u6a21\u5f0f)\u3002\u7528\u6237\u9700\u8981\u9009\u62e9\u5339\u914d\u53c2\u6570\u7c7b\u578b\u7684\u5b8f\u5e76\u4f20\u5165\u53c2\u6570\u7684\u7ec4\u540d\u79f0\u548c\u53c2\u6570\u540d\u79f0. #define PARAM_GET_INT8(_group, _name) #define PARAM_GET_UINT8(_group, _name) #define PARAM_GET_INT16(_group, _name) #define PARAM_GET_UINT16(_group, _name) #define PARAM_GET_INT32(_group, _name) #define PARAM_GET_UINT32(_group, _name) #define PARAM_GET_FLOAT(_group, _name) #define PARAM_GET_DOUBLE(_group, _name) \u9664\u6b64\u4e4b\u5916,\u8fd8\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u51fd\u6570\u6765\u83b7\u53d6\u53c2\u6570: param_t* param_get(char* group_name, char* param_name); param_t* param_get_by_name(const char* param_name); param_t* param_get_by_full_name(const char* group_name, const char* param_name); \u8fd9\u4e9b\u51fd\u6570\u4f7f\u7528\u67e5\u8be2\u7684\u65b9\u5f0f\u67e5\u627e\u4e0e group_name \u548c param_name \u5339\u914d\u7684\u53c2\u6570\u3002\u5f53\u53c2\u6570\u8f83\u591a\u65f6,\u67e5\u627e\u901f\u5ea6\u8f83\u6162,\u6240\u4ee5\u4e0d\u5efa\u8bae\u5728\u7b97\u6cd5\u6a21\u5757\u4e2d\u4f7f\u7528\uff0c,\u4ec5\u4f9b\u7cfb\u7edf\u6307\u4ee4(syscmd)\u6a21\u5757\u4f7f\u7528.","title":"\u8bfb\u53d6\u53c2\u6570"},{"location":"module/#_10","text":"\u7c7b\u4f3c\u53c2\u6570\u8bfb\u53d6, param\u6a21\u5757\u4e5f\u63d0\u4f9b\u4e86\u5bf9\u5e94\u7684\u5b8f\u6765\u5feb\u901f\u8bbe\u7f6e\u53c2\u6570\u7684\u503c: #define PARAM_SET_INT8(_group, _name, _val) #define PARAM_SET_UINT8(_group, _name, _val) #define PARAM_SET_INT16(_group, _name, _val) #define PARAM_SET_UINT16(_group, _name, _val) #define PARAM_SET_INT32(_group, _name, _val) #define PARAM_SET_UINT32(_group, _name, _val) #define PARAM_SET_FLOAT(_group, _name, _val) #define PARAM_SET_DOUBLE(_group, _name, _val) \u540c\u6837\u7684,\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u51fd\u6570\u6765\u8bbe\u7f6e\u4e0e group_name \u548c param_name \u5339\u914d\u7684\u53c2\u6570\u6307\uff1a fmt_err param_set_val(param_t* param, void* val); fmt_err param_set_val_by_name(char* param_name, void* val); fmt_err param_set_val_by_full_name(char* group_name, char* param_name, void* val); fmt_err param_set_string_val(param_t* param, char* val); fmt_err param_set_string_val_by_name(char* param_name, char* val); fmt_err param_set_string_val_by_full_name(char* group_name, char* param_name, char* val); \u8c03\u7528\u4e0a\u9762\u7684\u5b8f/\u51fd\u6570\u8bbe\u7f6e\u5b8c\u53c2\u6570\u540e\uff0c\u9ed8\u8ba4\u4e0d\u4f1a\u4fdd\u5b58\u5230\u53c2\u6570\u6587\u4ef6\uff0c\u6240\u4ee5\u5f53\u7cfb\u7edf\u91cd\u542f\u4e4b\u540e\u5c06\u6062\u590d\u4e4b\u524d\u7684\u503c\u3002.\u5982\u9700\u5c06\u5f53\u524d\u53c2\u6570\u4fdd\u5b58,\u9700\u8981\u8c03\u7528 param_save(char* path) \u51fd\u6570\u6765\u4fdd\u5b58\u5f53\u524d\u4fee\u6539\u3002\u5176\u4e2d path \u4e3a\u53c2\u6570\u6587\u4ef6\u7684\u8def\u5f84\u540d\u79f0\uff0c\u82e5\u4f20\u5165 NULL \u5219\u4f7f\u7528\u9ed8\u8ba4\u8def\u5f84.","title":"\u8bbe\u7f6e\u53c2\u6570"},{"location":"module/#_11","text":"FMT\u5185\u7f6e\u4e86 param \u6307\u4ee4\u6765\u5bf9\u53c2\u6570\u8fdb\u884c\u64cd\u4f5c\uff0c\u5176\u57fa\u672c\u7528\u6cd5\u5982\u4e0b\u6240\u793a: msh / param --help usage: param [OPTION] ACTION [ARGS] Action: list List group(s) parameters. group List all parameter groups. set Set parameter. get Get parameter. save Save parameters to file. load Load parameters from file. Option: -s, --save Save parameter value. param list : \u663e\u793a\u6240\u6709\u7684\u7ec4\u548c\u53c2\u6570: msh / param list SYSTEM: BLOG_MODE: 0 CALIB: GYRO0_XOFF: 0.000000 GYRO0_YOFF: 0.000000 GYRO0_ZOFF: 0.000000 ...... \u5982\u679c\u5728list\u540e\u52a0\u4e0a\u7ec4\u7684\u540d\u79f0,\u5219\u53ea\u663e\u793a\u5bf9\u5e94\u7ec4\u7684\u53c2\u6570: msh / param list SYSTEM SYSTEM: BLOG_MODE: 0 param group : \u663e\u793a\u6240\u6709\u7684\u7ec4: msh / param group Parameter Groups -------------------- SYSTEM CALIB param set : \u8bbe\u7f6e\u53c2\u6570\u7684\u503c\uff0c\u5176\u7528\u6cd5\u5982\u4e0b (\u65b9\u62ec\u53f7\u8868\u793a\u53ef\u9009\u9879,\u5c16\u62ec\u53f7\u4e3a\u5fc5\u586b\u9879): param set [group] parameter value \u6bd4\u5982\u8981\u5c06 BLOG_MODE \u53c2\u6570\u8bbe\u7f6e\u4e3a2,\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u6307\u4ee4: param set SYSTEM BLOG_MODE 2 \u4e0a\u8ff0\u6307\u4ee4\u4e5f\u53ef\u4ee5\u7b80\u5199\u4e3a param set BLOG_MODE 2 \u3002\u4f46\u662f\u8bf7\u6ce8\u610f\uff0c\u7531\u4e8e\u8fd9\u91cc\u6ca1\u6709\u6307\u5b9a\u7ec4\u540d\uff0c\u5982\u679c\u7cfb\u7edf\u4e2d\u5b58\u5728\u4e24\u4e2a\u76f8\u540c\u540d\u5b57\u7684\u53c2\u6570,\u5219\u4f1a\u9ed8\u8ba4\u5199\u5165\u7b2c\u4e00\u4e2a\u627e\u5230\u7684\u53c2\u6570. param get : \u83b7\u53d6\u53c2\u6570\u7684\u503c, \u7528\u6cd5\u5982\u4e0b\uff1a param get [group] parameter param save : \u5b58\u50a8\u5f53\u524d\u53c2\u6570\u3002\u53ef\u4ee5\u8f93\u5165 param save $path \u7684\u65b9\u5f0f\u6765\u6307\u5b9a\u5b58\u50a8\u8def\u5f84\uff0c\u5426\u5219\u5c06\u5b58\u50a8\u5230\u9ed8\u8ba4\u8def\u5f84\u3002 param load : \u52a0\u8f7d\u53c2\u6570\u6587\u4ef6\u3002\u53ef\u4ee5\u8f93\u5165 param load $path \u7684\u65b9\u5f0f\u6765\u6307\u5b9a\u52a0\u8f7d\u6587\u4ef6\uff0c\u5426\u5219\u5c06\u4ece\u9ed8\u8ba4\u8def\u5f84\u8fdb\u884c\u52a0\u8f7d\u3002","title":"\u53c2\u6570\u6307\u4ee4"},{"location":"module/#log","text":"\u65e5\u5fd7\u529f\u80fd\u5bf9\u4e8eMBD\u7684\u5f00\u53d1\u6a21\u5f0f\u800c\u8a00\u5341\u5206\u91cd\u8981\u3002\u56e0\u4e3aMBD\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u4eff\u771f\u624b\u6bb5\u65f6\u5f00\u73af\u4eff\u771f (Open Loop Simulation)\uff0c\u5176\u9ad8\u5ea6\u4f9d\u8d56\u4e8e\u65e5\u5fd7\u8bb0\u5f55\u7684\u6a21\u578b\u8f93\u5165/\u8f93\u51fa\u6570\u636e\uff0c\u4ece\u800c\u5f97\u5230\u548c\u5728\u786c\u4ef6\u4e0a\u8fd0\u884c\u5b8c\u5168\u4e00\u81f4\u7684\u4eff\u771f\u6570\u636e\u3002\u5f00\u73af\u4eff\u771f\u8981\u6c42\u8bb0\u5f55\u7684\u65e5\u5fd7\u6570\u636e\u9700\u8981\u540c\u65f6\u517c\u987e\u9ad8\u541e\u5410\u91cf\uff0c\u4f4e\u5ef6\u65f6\u548c\u9ad8\u5b9e\u65f6\u6027\u7684\u8981\u6c42\u3002 FMS\u65e5\u5fd7\u6a21\u5757\u63d0\u4f9b\u4e86\u4e24\u79cd\u7c7b\u578b\u7684\u65e5\u5fd7, BLog (Binary Log) \u548c ULog (Micro Log) , \u5206\u522b\u63d0\u4f9b \u4e8c\u8fdb\u5236\u65e5\u5fd7 \u6570\u636e\u8bb0\u5f55\u548c \u6587\u5b57\u65e5\u5fd7 \u6570\u636e\u8bb0\u5f55\u7684\u529f\u80fd\u3002","title":"Log\u65e5\u5fd7\u6a21\u5757"},{"location":"module/#blog","text":"\u9996\u5148\u6709\u5fc5\u8981\u4e86\u89e3\u4e00\u4e0bBLog\u8bb0\u5f55\u65e5\u5fd7\u7684\u7ed3\u6784\u3002BLog\u8bb0\u5f55\u7684\u65e5\u5fd7\u4ee5 Bus (\u7c7b\u4f3cSimulink\u4e2dBus\u7684\u6982\u5ff5)\u4e3a\u5355\u4f4d\uff0c\u5176\u4e2d\u6bcf\u4e2aBus\u53c8\u5305\u542b\u4e00\u4e2a\u6216\u8005\u591a\u4e2a Element (\u7c7b\u4f3cSimulink\u4e2dElement\u7684\u6982\u5ff5)\u3002\u6240\u4ee5BLog\u65e5\u5fd7\u6587\u4ef6\u53ef\u4ee5\u76f4\u63a5\u89e3\u6790\u4e3aSimulink\u53ef\u4ee5\u4f7f\u7528\u7684Bus\u6570\u636e\uff0c\u4f9b\u6a21\u578b\u8fdb\u884c\u4eff\u771f\u3002\u4e0b\u9762\u540c\u6837\u4e3e\u4f8b\u8bf4\u660eBLog\u65e5\u5fd7\u7684\u7528\u6cd5\u3002","title":"BLog\u65e5\u5fd7"},{"location":"module/#_12","text":"\u8fd9\u91cc\u4ee5 IMU \u65e5\u5fd7\u6570\u636e\u4e3a\u4f8b, \u6f14\u793a\u5982\u4f55\u6dfb\u52a0\u65b0\u7684\u65e5\u5fd7\u6570\u636e. \u5b9a\u4e49Element\uff1a\u4f7f\u7528\u5b8f BLOG_ELEMENT(_name, _type) \u6765\u5b9a\u4e49\u4e00\u4e2aElement\uff0c\u5176\u4e2d _name \u4e3aElement\u540d\u79f0\uff0c _type \u4e3aElement\u7c7b\u578b\uff0c\u76ee\u524d\u652f\u6301\u7684\u7c7b\u578b\u5982\u4e0b\uff1a enum { BLOG_INT8 = 0, BLOG_UINT8, BLOG_INT16, BLOG_UINT16, BLOG_INT32, BLOG_UINT32, BLOG_FLOAT, BLOG_DOUBLE, BLOG_BOOLEAN, }; \u6211\u4eec\u6784\u5efa\u7684IMU\u8f93\u5165\u5982\u4e0b\u6240\u793a\uff1a blog_elem_t IMU_elems[] = { BLOG_ELEMENT( timestamp_ms , BLOG_UINT32), BLOG_ELEMENT( gyr_x_radPs_B , BLOG_FLOAT), BLOG_ELEMENT( gyr_y_radPs_B , BLOG_FLOAT), BLOG_ELEMENT( gyr_z_radPs_B , BLOG_FLOAT), BLOG_ELEMENT( acc_x_mPs2_B , BLOG_FLOAT), BLOG_ELEMENT( acc_y_mPs2_B , BLOG_FLOAT), BLOG_ELEMENT( acc_z_mPs2_B , BLOG_FLOAT), }; \u5982\u679c\u8981\u5b9a\u4e49\u77e9\u9635\u6216\u8005\u5411\u91cf\u7c7b\u578b\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u4f7f\u7528\u5b8f BLOG_ELEMENT_VEC(_name, _type, _num) \u3002\u5176\u4e2d _num \u4e3a\u5411\u91cf\u7684\u957f\u5ea6\u3002 blog_elem_t IMU_elems[] = { BLOG_ELEMENT( timestamp_ms , BLOG_UINT32), BLOG_ELEMENT_VEC( gyr_radPs_B , BLOG_FLOAT, 3), BLOG_ELEMENT_VEC( acc_mPs2_B , BLOG_FLOAT, 3), }; \u5b9a\u4e49Bus\uff1a\u4f7f\u7528\u5b8f BLOG_BUS(_name, _id, _elem_list) \u5c06\u65b0\u7684Bus\u6dfb\u52a0\u5230 _blog_bus \u5217\u8868\u4e2d\u3002\u5176\u4e2d _name \u4e3aBus\u540d\u79f0\uff1b _id \u4e3a\u8be5\u6761Bus\u7684ID\uff0c\u7528\u6765\u552f\u4e00\u6307\u4ee3\u8fd9\u6761Bus\u6570\u636e\uff1bIMU_elems\u4e3aBus\u7684Element\u6570\u636e\u3002\u6bd4\u5982\uff1a blog_bus_t _blog_bus[] = { BLOG_BUS( IMU , BLOG_IMU_ID, IMU_elems), ...... };","title":"\u6dfb\u52a0\u65e5\u5fd7\u6570\u636e"},{"location":"module/#_13","text":"\u65e5\u5fd7\u6dfb\u52a0\u5b8c\u6210\u540e\u5c31\u53ef\u4ee5\u5f00\u59cb\u8bb0\u5f55\u65e5\u5fd7\u6570\u636e\u3002\u540c\u6837\uff0cBLog\u65e5\u5fd7\u8bb0\u5f55\u4ee5Bus\u4e3a\u5355\u4f4d\uff0c\u6bcf\u6761Bus\u6570\u636e\u53ef\u4ee5\u4ee5\u5404\u81ea\u7684\u9891\u7387\u8fdb\u884c\u8bb0\u5f55\u3002\u4f7f\u7528 blog_push_msg \u51fd\u6570\u8bb0\u5f55\u4e00\u6761Bus\u6570\u636e\u3002 \u6bd4\u5982\u5982\u4e0b\u4ee3\u7801\u5c06\u5728IMU\u6570\u636e\u66f4\u65b0\u4e4b\u540e\u8bb0\u5f55IMU\u7684\u6570\u636e\uff1a /* record INS input bus data if updated */ if (ins_handle.imu_updated) { ins_handle.imu_updated = 0; /* Log IMU data if IMU updated */ blog_push_msg((uint8_t*) INS_U.IMU1, BLOG_IMU_ID, sizeof(INS_U.IMU1)); } \u5176\u4e2d INS_U.IMU1 \u4e3a\u5b58\u653e\u6570\u636e\u7684\u53d8\u91cf, BLOG_IMU_ID \u4e3a\u8be5\u6761Bus\u7684ID, sizeof(INS_U.IMU1) \u8868\u793a\u8be5\u6761Bus\u6570\u636e\u7684\u957f\u5ea6\u3002","title":"\u8bb0\u5f55\u65e5\u5fd7\u6570\u636e"},{"location":"module/#_14","text":"\u53ef\u4ee5\u4f7f\u7528 blog start/stop \u6307\u4ee4\u6765\u5f00\u542f/\u5173\u95ed\u65e5\u5fd7\u8bb0\u5f55\u3002\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e BLOG_MODE \u53c2\u6570\u7684\u503c\u6765\u81ea\u52a8\u5f00\u542f/\u5173\u95edBLog\u65e5\u5fd7\u7684\u8bb0\u5f55\uff1a /* Determines when to start and stop logging (Blog). 0: disabled 1: when armed until disarm 2: from boot until disarm 3: from boot until shutdown */ PARAM_DEFINE_INT32(BLOG_MODE, 0),","title":"\u5f00\u542f/\u5173\u95ed\u65e5\u5fd7\u8bb0\u5f55"},{"location":"module/#_15","text":"TO BE ADDED","title":"\u65e5\u5fd7\u89e3\u6790"},{"location":"module/#blog_1","text":"TO BE ADDED","title":"BLog\u6307\u4ee4"},{"location":"module/#ulog","text":"ULog \u4e3aRT-Thread\u63d0\u4f9b\u7684\u7cfb\u7edf\u7ec4\u4ef6\uff0c\u63d0\u4f9b\u6587\u5b57\u65e5\u5fd7\u8bb0\u5f55\u7684\u529f\u80fd\u3002\u6587\u5b57\u65e5\u5fd7\u53ef\u4ee5\u7528\u6765\u8f93\u51fa\u7cfb\u7edf\u7684\u4e00\u4e9b\u8c03\u8bd5\u4fe1\u606f\uff0c\u4ece\u800c\u4f9b\u5f00\u53d1\u8005\u8fdb\u884c\u95ee\u9898\u5b9a\u4f4d\u3002FMT\u652f\u6301\u5c06ULog\u8f93\u51fa\u5230\u63a7\u5236\u53f0\u548c\u6587\u4ef6\u7cfb\u7edf\u3002 \u4f7f\u7528\u5982\u4e0b\u63a5\u53e3\u8f93\u51faULog\u65e5\u5fd7\u4fe1\u606f\uff1a ulog_e(TAG, ...) // Error ulog_w(TAG, ...) // Warning ulog_i(TAG, ...) // Info ulog_d(TAG, ...) // Debug ULog\u65e5\u5fd7\u4fe1\u606f\u5c06\u88ab\u6253\u5370\u5728\u63a7\u5236\u53f0\uff0c\u5e76\u4e14\u540c\u65f6\u88ab\u5b58\u50a8\u5728 /log/$session_id/ulog.txt \u4e2d\u3002 [1708] W/Status: FMS Unknown Mode [1714] I/Status: FMS Status Disarm [5479] I/Status: FMS Position Mode [8268] I/Status: FMS Altitude Hold Mode [9104] I/Status: FMS Manual Mode [13034] I/Status: FMS Status Standby [15005] I/Status: FMS Status Arm [21673] I/Status: FMS Status Disarm","title":"ULog\u65e5\u5fd7"},{"location":"simulation/","text":"","title":"\u4eff\u771f"}]}